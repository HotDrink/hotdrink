<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Basic HotDrink Usage</title>
<!-- 2015-10-29 Thu 10:13 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript" src="hotdrink.min.js"></script>
<script type="text/javascript" src="collapse.js"></script>
<link rel="stylesheet" type="text/css" href="style.css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript" src="http://orgmode.org/mathjax/MathJax.js"></script>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
        //  config: ["MMLorHTML.js"], jax: ["input/TeX"],
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Basic HotDrink Usage</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Introduction</a></li>
<li><a href="#sec-2">2. Creating a constraint system</a>
<ul>
<li><a href="#sec-2-1">2.1. The example</a></li>
<li><a href="#sec-2-2">2.2. Working with the component builder</a></li>
<li><a href="#sec-2-3">2.3. Interacting with variables</a></li>
<li><a href="#sec-2-4">2.4. Updating the property model</a></li>
</ul>
</li>
<li><a href="#sec-3">3. Simplified binding</a>
<ul>
<li><a href="#sec-3-1">3.1. The example</a></li>
<li><a href="#sec-3-2">3.2. Introduction to binding</a></li>
<li><a href="#sec-3-3">3.3. The importance of binding</a></li>
</ul>
</li>
<li><a href="#sec-4">4. HotDrink binding</a>
<ul>
<li><a href="#sec-4-1">4.1. The example</a></li>
<li><a href="#sec-4-2">4.2. Embedding binding instructions within the View</a></li>
<li><a href="#sec-4-3">4.3. Binding specifications</a></li>
<li><a href="#sec-4-4">4.4. Three common bindings</a></li>
</ul>
</li>
<li><a href="#sec-5">5. Multi-way constraints</a>
<ul>
<li><a href="#sec-5-1">5.1. The example</a></li>
<li><a href="#sec-5-2">5.2. Updating the constraint system</a></li>
<li><a href="#sec-5-3">5.3. Declaring multiple variables at once</a></li>
<li><a href="#sec-5-4">5.4. Reusing functions</a></li>
</ul>
</li>
<li><a href="#sec-6">6. Input/output variables</a>
<ul>
<li><a href="#sec-6-1">6.1. The example</a></li>
<li><a href="#sec-6-2">6.2. Previous variable values</a></li>
<li><a href="#sec-6-3">6.3. Caveat</a></li>
</ul>
</li>
<li><a href="#sec-7">7. Multiple output variables</a>
<ul>
<li><a href="#sec-7-1">7.1. The example</a></li>
<li><a href="#sec-7-2">7.2. Multiple return values</a></li>
</ul>
</li>
<li><a href="#sec-8">8. Shortcut: equations</a>
<ul>
<li><a href="#sec-8-1">8.1. The example</a></li>
<li><a href="#sec-8-2">8.2. Allowable equations</a></li>
<li><a href="#sec-8-3">8.3. Implementation</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
This document describes the basics of how to create a property model, and how
that property model operates and interacts with the rest of your web
application.  We feel that you should not have to use a library without
understanding exactly how it is working and what it is doing for you.
Therefore, in this document we initially set aside the shortcuts and
convenience functions of HotDrink and work with it at the lowest level so that
it will be clear exactly how a property model works.  Then we slowly lay the
groundwork for the shortcuts, making it clear what they are doing for you.
After reading this document, you should have a foundation for understanding
what HotDrink is doing without feeling like it is &ldquo;magic&rdquo;.
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Creating a constraint system</h2>
<div class="outline-text-2" id="text-2">
<p>
The most fundamental part of a GUI written with HotDrink is the constraint
system which represents data dependencies in your GUI.  This first example
shows how to create variables and constraints for that system, and how you can
directly interact with variables.
</p>

<p>
We assume here that you have read the document <a href="intro.html">Introduction to HotDrink</a> and
are therefore familiar with the basic concept of a constraint system.
</p>
</div>

<div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> The example</h3>
<div class="outline-text-3" id="text-2-1">
<p>
This example shows a single constraint of three variables: <i>emails</i>, <i>filter</i>,
and <i>result</i>.  Each of these variables holds a string.  The value of <i>emails</i>
is a comma-delimited list of email addresses.  The value of <i>filter</i> is any
string.  The value of <i>result</i> is the comma-delimited list of just those
addresses in <i>emails</i> which contain <i>filter</i> as a substring.
</p>

<p>
You can use the &ldquo;Set&rdquo; buttons to set the values of the <i>emails</i> and <i>filter</i>
variables.  Then click the &ldquo;Get&rdquo; button to see the value of the <i>result</i>
variable.
</p>

<div class="results">
<table>
  <style type="text/css" scoped>
    td { padding-right: 1ex; }
    th { padding-right: 1ex; text-align: left; font-weight: bold; }
  </style>
  <tr>
    <th>Emails:</th>
    <td><input type="button" value="Set" onclick="setEmails()"/></td>
  </tr>
  <tr>
    <th>Filter:</th>
    <td><input type="button" value="Set" onclick="setFilter()"/></td>
  </tr>
  <tr>
    <th>Result:</th>
    <td><input type="button" value="Get" onclick="getResult()"/></td>
  </tr>
</table>
</div>
<script type="text/javascript">
(function() {
// Define root component
var model = new hd.ComponentBuilder()
    // Define variables
    .variable( 'emails', 'joe@foo.com, sue@fum.edu, eve@foo.com, bob@baz.org' )
    .variable( 'filter', 'foo.com' )
    .variable( 'result' )

    // Define a constraint
    .constraint( 'emails, filter, result' )
    .method( 'emails, filter -> result',
             function( emails, filter ) {
               var words = emails.trim().split( /\s*,\s*/ );
               var filteredWords = words.filter( function( word ) {
                 return word.indexOf( filter ) > -1;
               } );
               return filteredWords.join( ', ' );
             } )

    // Get resulting component
    .component();

// Create the property model
var pm = new hd.PropertyModel();
pm.addComponent( model );
pm.update();
// Allow user to set emails variable
setEmails = function setEmails() {
  var emails = window.prompt( 'Emails:', model.emails.get() );
  if (emails !== null) {
    model.emails.set( emails );
    pm.update();
  }
}

// Allow user to set filter variable
setFilter = function setFilter() {
  var filter = window.prompt( 'Filter:', model.filter.get() );
  if (filter !== null) {
    model.filter.set( filter );
    pm.update();
  }
}

// Present result to user
getResult = function getResult() {
  alert( 'Result: ' + model.result.get() );
}
})();
</script>

<p>
<b>Source Code</b>
</p>

<p>
The entire source code for this example is shown in its entirety below.
(Click the &ldquo;show&rdquo; links to view the code.)  To clarify, we have broken code
into three sections: the HTML that defines the View, the JavaScript that
defines the View-Model, and the JavaScript that binds the View to the
View-Model.  In the remainder of this section we will reproduce and examine
snippets of this code.
</p>

<p>
Note that, in this example, we deliberately avoid using any sort of binding
mechanisms and interact directly with the property model.  This makes the
example a little awkward, but also makes clear how the property model works.
</p>

<div class="org-src-container">
<label class="org-src-name"><i>View</i> (show/hide)</label>
<pre class="src src-html"><span class="linenr"> 1: </span>&lt;<span style="color: #006699;">table</span>&gt;
<span class="linenr"> 2: </span>  &lt;<span style="color: #006699;">style</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text/css"</span> scoped&gt;
<span class="linenr"> 3: </span>    td { padding-right: 1ex; }
<span class="linenr"> 4: </span>    th { padding-right: 1ex; text-align: left; font-weight: bold; }
<span class="linenr"> 5: </span>  &lt;/<span style="color: #006699;">style</span>&gt;
<span class="linenr"> 6: </span>  &lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr"> 7: </span>    &lt;<span style="color: #006699;">th</span>&gt;Emails:&lt;/<span style="color: #006699;">th</span>&gt;
<span class="linenr"> 8: </span>    &lt;<span style="color: #006699;">td</span>&gt;&lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"button"</span> <span style="color: #BA36A5;">value</span>=<span style="color: #008000;">"Set"</span> <span style="color: #BA36A5;">onclick</span>=<span style="color: #008000;">"setEmails()"</span>/&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr"> 9: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;
<span class="linenr">10: </span>  &lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">11: </span>    &lt;<span style="color: #006699;">th</span>&gt;Filter:&lt;/<span style="color: #006699;">th</span>&gt;
<span class="linenr">12: </span>    &lt;<span style="color: #006699;">td</span>&gt;&lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"button"</span> <span style="color: #BA36A5;">value</span>=<span style="color: #008000;">"Set"</span> <span style="color: #BA36A5;">onclick</span>=<span style="color: #008000;">"setFilter()"</span>/&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">13: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;
<span class="linenr">14: </span>  &lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">15: </span>    &lt;<span style="color: #006699;">th</span>&gt;Result:&lt;/<span style="color: #006699;">th</span>&gt;
<span class="linenr">16: </span>    &lt;<span style="color: #006699;">td</span>&gt;&lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"button"</span> <span style="color: #BA36A5;">value</span>=<span style="color: #008000;">"Get"</span> <span style="color: #BA36A5;">onclick</span>=<span style="color: #008000;">"getResult()"</span>/&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">17: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;
<span class="linenr">18: </span>&lt;/<span style="color: #006699;">table</span>&gt;
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><i>View-Model</i> (show/hide)</label>
<pre class="src src-js"><span class="linenr"> 1: </span><span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Define root component</span>
<span class="linenr"> 2: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">model</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.ComponentBuilder</span>()
<span class="linenr"> 3: </span>    <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Define variables</span>
<span class="linenr"> 4: </span>    .variable( <span style="color: #008000;">'emails'</span>, <span style="color: #008000;">'joe@foo.com, sue@fum.edu, eve@foo.com, bob@baz.org'</span> )
<span class="linenr"> 5: </span>    .variable( <span style="color: #008000;">'filter'</span>, <span style="color: #008000;">'foo.com'</span> )
<span class="linenr"> 6: </span>    .variable( <span style="color: #008000;">'result'</span> )
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span>    <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Define a constraint</span>
<span class="linenr"> 9: </span>    .constraint( <span style="color: #008000;">'emails, filter, result'</span> )
<span class="linenr">10: </span>    .method( <span style="color: #008000;">'emails, filter -&gt; result'</span>,
<span class="linenr">11: </span>             <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">emails</span>, <span style="color: #BA36A5;">filter</span> ) {
<span class="linenr">12: </span>               <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">words</span> = emails.trim().split( <span style="color: #008000;">/\s*,\s*/</span> );
<span class="linenr">13: </span>               <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">filteredWords</span> = words.filter( <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">word</span> ) {
<span class="linenr">14: </span>                 <span style="color: #0000FF;">return</span> word.indexOf( filter ) &gt; -1;
<span class="linenr">15: </span>               } );
<span class="linenr">16: </span>               <span style="color: #0000FF;">return</span> filteredWords.join( <span style="color: #008000;">', '</span> );
<span class="linenr">17: </span>             } )
<span class="linenr">18: </span>
<span class="linenr">19: </span>    <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Get resulting component</span>
<span class="linenr">20: </span>    .component();
<span class="linenr">21: </span>
<span class="linenr">22: </span><span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Create the property model</span>
<span class="linenr">23: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">pm</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.PropertyModel</span>();
<span class="linenr">24: </span>pm.addComponent( model );
<span class="linenr">25: </span>pm.update();
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><i>Binding</i> (show/hide)</label>
<pre class="src src-js"><span class="linenr"> 1: </span><span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Allow user to set emails variable</span>
<span class="linenr"> 2: </span>setEmails = <span style="color: #0000FF;">function</span> setEmails() {
<span class="linenr"> 3: </span>  <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">emails</span> = window.prompt( <span style="color: #008000;">'Emails:'</span>, model.emails.get() );
<span class="linenr"> 4: </span>  <span style="color: #0000FF;">if</span> (emails !== <span style="color: #8b1a1a;">null</span>) {
<span class="linenr"> 5: </span>    model.emails.set( emails );
<span class="linenr"> 6: </span>    pm.update();
<span class="linenr"> 7: </span>  }
<span class="linenr"> 8: </span>}
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Allow user to set filter variable</span>
<span class="linenr">11: </span>setFilter = <span style="color: #0000FF;">function</span> setFilter() {
<span class="linenr">12: </span>  <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">filter</span> = window.prompt( <span style="color: #008000;">'Filter:'</span>, model.filter.get() );
<span class="linenr">13: </span>  <span style="color: #0000FF;">if</span> (filter !== <span style="color: #8b1a1a;">null</span>) {
<span class="linenr">14: </span>    model.filter.set( filter );
<span class="linenr">15: </span>    pm.update();
<span class="linenr">16: </span>  }
<span class="linenr">17: </span>}
<span class="linenr">18: </span>
<span class="linenr">19: </span><span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Present result to user</span>
<span class="linenr">20: </span>getResult = <span style="color: #0000FF;">function</span> getResult() {
<span class="linenr">21: </span>  alert( <span style="color: #008000;">'Result: '</span> + model.result.get() );
<span class="linenr">22: </span>}
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> Working with the component builder</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Recall from <a href="intro.html">the introduction</a> that the best way to create variables and
constraints is in a component, and the best way to create a component is with
the component builder.  The general strategy for constructing a component is:
(1.)  create a new builder object, (2.) use the builder member functions to
construct the component, (3.) call the <code>component</code> builder member function to
retrieve the completed component.
</p>

<p>
To create variables and constraints, you will use the following builder member
functions.
</p>
</div>

<ol class="org-ol"><li><a id="sec-2-2-1"></a>Creating variables<br  /><div class="outline-text-4" id="text-2-2-1">
<p>
Just as in a programming language, values in HotDrink are stored in variables.
Note, however, that HotDrink variables are <i>not</i> the same as JavaScript
variables; HotDrink variables are actually JavaScript objects.  Variables are
created with the model builder using the <code>variable</code> member function and then
stored in the model.  To create a variable you must specify a name; you may
optionally specify an initial value.  As with JavaScript variables,
uninitialized variables are given the value <code>undefined</code>.  For example, the
line below creates a variable named <code>emails</code> which is initialized with a list
of email addresses.
</p>

<div class="org-src-container">

<pre class="src src-js" id="emailvar">    .variable( <span style="color: #008000;">'emails'</span>, <span style="color: #008000;">'joe@foo.com, sue@fum.edu, eve@foo.com, bob@baz.org'</span> )
</pre>
</div>

<p>
As mentioned previously, the return value of the <code>variable</code> function is the
builder object itself in order to facilitate chaining.
</p>

<p>
Builder member functions such as <code>variable</code> are used frequently when declaring
a property model.  To make them easier to use, the model builder provides
abbreviated names for many of them.  For example, you may refer to the
<code>variable</code> member function simply as <code>v</code>.  This is perhaps slightly less
readable, but much easier to type; we will use the abbreviated name <code>v</code> in the
remainder of the examples.
</p>
</div>
</li>

<li><a id="sec-2-2-2"></a>Creating constraints<br  /><div class="outline-text-4" id="text-2-2-2">
<p>
Recall from <a href="intro.html">the introduction</a> that a constraint is something that should always
be true concerning some of your variables&#x2014;i.e., a <i>relation</i> over the
variables.  In the example above, the relation is that <code>result</code> should contain
just those addresses in <code>emails</code> for which <code>filter</code> is a substring.
</p>

<p>
To define a constraint, you must specify the variables involved.  To make this
simple, the <code>constraint</code> member function of the model builder takes a string
containing all of the variables' names in a comma delimited list.  In this
example we define a single constraint for the variables <code>emails</code>, <code>filter</code>, and
<code>result</code>, as shown on the line below.
</p>

<div class="org-src-container">

<pre class="src src-js" id="emailcon">    .constraint( <span style="color: #008000;">'emails, filter, result'</span> )
</pre>
</div>

<p>
The return value of the <code>constraint</code> member function is the builder. The
<code>constraint</code> member function may be abbreviated as <code>c</code>; we will use this
abbreviation in the remainder of the examples.
</p>
</div>
</li>

<li><a id="sec-2-2-3"></a>Creating methods<br  /><div class="outline-text-4" id="text-2-2-3">
<p>
Notice that, when you create a constraint, you do <i>not</i> tell HotDrink what
relation the constraint represents.  Instead, you define a constraint by
providing a set of <i>constraint satisfaction methods</i>, or just <i>methods</i> for
short.  A method is a function whose parameters are <i>some</i> variables of the
constraint, and which returns new values for <i>other</i> variables of the
constraint.  The purpose of a method is to provide new values for its output
variables that will satisfy the constraint.
</p>

<p>
The method creation function of the model builder, named <code>method</code>, takes a
signature and a function.  The signature is a string defining which variables
are inputs and which are outputs; it has the form &ldquo;/inputs/ <code>-&gt;</code> <i>outputs</i>&rdquo;,
where both <i>inputs</i> and <i>outputs</i> are comma-delimited lists of variables.  For
this example we provide only a single method, shown below.  This method takes
<code>emails</code> and <code>filter</code> and uses them to calculate <code>result</code>.  You can have more
than one method per constraint; we'll discuss this further in later examples.
</p>

<div class="org-src-container">

<pre class="src src-js" id="emailmth">    .method( <span style="color: #008000;">'emails, filter -&gt; result'</span>,
             <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">emails</span>, <span style="color: #BA36A5;">filter</span> ) {
               <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">words</span> = emails.trim().split( <span style="color: #008000;">/\s*,\s*/</span> );
               <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">filteredWords</span> = words.filter( <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">word</span> ) {
                 <span style="color: #0000FF;">return</span> word.indexOf( filter ) &gt; -1;
               } );
               <span style="color: #0000FF;">return</span> filteredWords.join( <span style="color: #008000;">', '</span> );
             } )
</pre>
</div>

<p>
Note that in this example we provide an anonymous function as our method, but
this is not a requirement; methods can be named functions defined elsewhere.
Also note that it is not a requirement for function parameter names to match
the variables which should be passed to them; in fact, HotDrink has no way of
knowing what you named your parameters.  HotDrink will use the signature you
provided to decide what variables to pass to the function.
</p>

<p>
Whenever you call <code>method</code>, the builder assumes you are adding a method to the
most recently defined constraint.  As with the other builder member functions,
the return value of <code>method</code> is the builder to facilitate chaining, and it may
be abbreviated as <code>m</code>; we will use this abbreviation in the remainder of the
examples.
</p>
</div>
</li></ol>
</div>

<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> Interacting with variables</h3>
<div class="outline-text-3" id="text-2-3">
<p>
Variables are stored as fields in the component to which they belong.  For
example, in the example we store our component in a variable named <code>model</code>;
thus, the <code>emails</code> variable of that component is accessed as <code>model.emails</code>.
The value of variables can be retrieved using the <code>get</code> member function and
modified using the <code>set</code> member function.  If a variable is registered with a
property model (e.g., the variable is in a component that has been added to
the constraint system), then changes to the variable's value will be noticed
by the property model.
</p>

<p>
In the example above, the following function is called every time the user
clicks the &ldquo;Get&rdquo; button.  The function calls <code>model.result.get</code> to retrieve
the current value of the <code>result</code> variable; it then displays this value using
the standard JavaScript <code>alert</code> function.
</p>


<div class="org-src-container">

<pre class="src src-js" id="getresult">getResult = <span style="color: #0000FF;">function</span> getResult() {
  alert( <span style="color: #008000;">'Result: '</span> + model.result.get() );
}
</pre>
</div>

<p>
The following function is called every time the user clicks the &ldquo;Set&rdquo; button
for the email address list.  The function calls <code>model.emails.get()</code> to
retrieve the current value of the <code>emails</code> variable; this is used to
initialize the prompt.  Once the user enters a new value, it is stored in the
variable using <code>model.emails.set()</code>.
</p>

<div class="org-src-container">

<pre class="src src-js" id="setemails">setEmails = <span style="color: #0000FF;">function</span> setEmails() {
  <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">emails</span> = window.prompt( <span style="color: #008000;">'Emails:'</span>, model.emails.get() );
  <span style="color: #0000FF;">if</span> (emails !== <span style="color: #8b1a1a;">null</span>) {
    model.emails.set( emails );
    pm.update();
  }
}
</pre>
</div>

<p>
Note that in the next section we will introduce binding, which is a better way
to set and get variable values.
</p>
</div>
</div>

<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4"><span class="section-number-3">2.4</span> Updating the property model</h3>
<div class="outline-text-3" id="text-2-4">
<p>
To <i>update</i> the property model means to respond to changes that have been
made&#x2014;such as new constraints or modified variables&#x2014;by enforcing any
constraints which may no longer be satisfied.  The constraint system notices,
and remembers, when changes occur.  However, the constraint system does not
actually update until its <code>update</code> member function is called, as shown below.
This allows you to package several changes into a single update.  In the
example above, we call <code>update</code> after adding our component to the property
model, as well as after setting a variable.
</p>

<div class="org-src-container">

<pre class="src src-js" id="update">pm.update();
</pre>
</div>

<p>
A more common way of updating the property model is by executing a <i>command</i>.
We will discuss commands a little later.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Simplified binding</h2>
<div class="outline-text-2" id="text-3">
<p>
The previous example illustrates the simplest possible interaction with the
property model: getting and setting a variable's value, and updating the
property model.  However, more commonly we do not get and set variable value's
directly; instead we rely on <i>bindings</i> to get and set them for us.  In this
example, we'll write our own very simple bindings to illustrate how this
process works.
</p>
</div>

<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> The example</h3>
<div class="outline-text-3" id="text-3-1">
<p>
This example is very similar to the previous:  a list of email addresses which
is filtered by a string.  The difference is in the way we interact with the
property model.  In this example, the <code>emails</code> and <code>filter</code> variables are
represented by text boxes: editing the text boxes changes the variables.
Also, the value of the <code>result</code> variable is shown in the web page and updated
automatically.
</p>

<div class="results">
<table>
  <style type="text/css" scoped>
    th { padding-right: 1ex; text-align: left; font-weight: bold; }
    input.long { width: 100ex; }
  </style>
  <tr>
    <th>Emails:</th>
    <td><input type="text" id="emailsEdit" class="long"/></td>
  </tr>
  <tr>
    <th>Filter:</th>
    <td><input type="text" id="filterEdit" class="long"/></td>
  </tr>
  <tr>
    <th>Result:</th>
    <td><span id="resultSpan"></span></td>
  </tr>
</table>
</div>
<script type="text/javascript">
(function() {
// Define root component
var model = new hd.ComponentBuilder()
    .v( 'emails', 'joe@foo.com, sue@fum.edu, eve@foo.com, bob@baz.org' )
    .v( 'filter', 'foo.com' )
    .v( 'result' )

    .c( 'emails, filter, result' )
    .m( 'emails, filter -> result',
        function( emails, filter ) {
          var words = emails.trim().split( /\s*,\s*/ );
          var filteredWords = words.filter( function( word ) {
            return word.indexOf( filter ) > -1;
          } );
          return filteredWords.join( ', ' );
        } )

    .component();

// Create the property model
var pm = new hd.PropertyModel();
pm.addComponent( model );
// To be done when the document has loaded...
window.addEventListener( 'load', function() {

  // When emails edit-box changed, update variable
  var emailsEdit = document.getElementById( 'emailsEdit' );
  emailsEdit.value = model.emails.get();
  emailsEdit.addEventListener( 'input', function() {
    model.emails.set( emailsEdit.value );
    pm.update()
  } );

  // When filter edit-box changed, update variable
  var filterEdit = document.getElementById( 'filterEdit' );
  filterEdit.value = model.filter.get();
  filterEdit.addEventListener( 'input', function() {
    model.filter.set( filterEdit.value );
    pm.update()
  } );

  // When result variable changed, update span
  var resultSpan = document.getElementById( 'resultSpan' );
  resultSpan.appendChild( document.createTextNode( model.result.get() ) );
  model.result.addObserver( { onNext: function() {
    resultSpan.removeChild( resultSpan.lastChild );
    resultSpan.appendChild( document.createTextNode( model.result.get() ) );
  } } );

} )
})();
</script>

<p>
<b>Source Code</b>
</p>

<p>
Again, in this example we forgo using HotDrink's binding mechanisms and write
our own binding mechanisms instead.  The purpose of this is to illustrate the
work involved in binding.
</p>

<p>
Note that the View-Model of this example is identical to the previous example;
only the View and Binding have changed.
</p>

<div class="org-src-container">
<label class="org-src-name"><i>View</i> (show/hide)</label>
<pre class="src src-html"><span class="linenr"> 1: </span>&lt;<span style="color: #006699;">table</span>&gt;
<span class="linenr"> 2: </span>  &lt;<span style="color: #006699;">style</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text/css"</span> scoped&gt;
<span class="linenr"> 3: </span>    th { padding-right: 1ex; text-align: left; font-weight: bold; }
<span class="linenr"> 4: </span>    input.long { width: 100ex; }
<span class="linenr"> 5: </span>  &lt;/<span style="color: #006699;">style</span>&gt;
<span class="linenr"> 6: </span>  &lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr"> 7: </span>    &lt;<span style="color: #006699;">th</span>&gt;Emails:&lt;/<span style="color: #006699;">th</span>&gt;
<span class="linenr"> 8: </span>    &lt;<span style="color: #006699;">td</span>&gt;&lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"emailsEdit"</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"long"</span>/&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr"> 9: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;
<span class="linenr">10: </span>  &lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">11: </span>    &lt;<span style="color: #006699;">th</span>&gt;Filter:&lt;/<span style="color: #006699;">th</span>&gt;
<span class="linenr">12: </span>    &lt;<span style="color: #006699;">td</span>&gt;&lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"filterEdit"</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"long"</span>/&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">13: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;
<span class="linenr">14: </span>  &lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">15: </span>    &lt;<span style="color: #006699;">th</span>&gt;Result:&lt;/<span style="color: #006699;">th</span>&gt;
<span class="linenr">16: </span>    &lt;<span style="color: #006699;">td</span>&gt;&lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"resultSpan"</span>&gt;&lt;/<span style="color: #006699;">span</span>&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">17: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;
<span class="linenr">18: </span>&lt;/<span style="color: #006699;">table</span>&gt;
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><i>View-Model</i> (show/hide)</label>
<pre class="src src-js"><span class="linenr"> 1: </span><span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Define root component</span>
<span class="linenr"> 2: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">model</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.ComponentBuilder</span>()
<span class="linenr"> 3: </span>    .v( <span style="color: #008000;">'emails'</span>, <span style="color: #008000;">'joe@foo.com, sue@fum.edu, eve@foo.com, bob@baz.org'</span> )
<span class="linenr"> 4: </span>    .v( <span style="color: #008000;">'filter'</span>, <span style="color: #008000;">'foo.com'</span> )
<span class="linenr"> 5: </span>    .v( <span style="color: #008000;">'result'</span> )
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span>    .c( <span style="color: #008000;">'emails, filter, result'</span> )
<span class="linenr"> 8: </span>    .m( <span style="color: #008000;">'emails, filter -&gt; result'</span>,
<span class="linenr"> 9: </span>        <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">emails</span>, <span style="color: #BA36A5;">filter</span> ) {
<span class="linenr">10: </span>          <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">words</span> = emails.trim().split( <span style="color: #008000;">/\s*,\s*/</span> );
<span class="linenr">11: </span>          <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">filteredWords</span> = words.filter( <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">word</span> ) {
<span class="linenr">12: </span>            <span style="color: #0000FF;">return</span> word.indexOf( filter ) &gt; -1;
<span class="linenr">13: </span>          } );
<span class="linenr">14: </span>          <span style="color: #0000FF;">return</span> filteredWords.join( <span style="color: #008000;">', '</span> );
<span class="linenr">15: </span>        } )
<span class="linenr">16: </span>
<span class="linenr">17: </span>    .component();
<span class="linenr">18: </span>
<span class="linenr">19: </span><span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Create the property model</span>
<span class="linenr">20: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">pm</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.PropertyModel</span>();
<span class="linenr">21: </span>pm.addComponent( model );
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><i>Binding</i> (show/hide)</label>
<pre class="src src-js"><span class="linenr"> 1: </span><span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">To be done when the document has loaded...</span>
<span class="linenr"> 2: </span>window.addEventListener( <span style="color: #008000;">'load'</span>, <span style="color: #0000FF;">function</span>() {
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span>  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">When emails edit-box changed, update variable</span>
<span class="linenr"> 5: </span>  <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">emailsEdit</span> = document.getElementById( <span style="color: #008000;">'emailsEdit'</span> );
<span class="linenr"> 6: </span>  emailsEdit.value = model.emails.get();
<span class="linenr"> 7: </span>  emailsEdit.addEventListener( <span style="color: #008000;">'input'</span>, <span style="color: #0000FF;">function</span>() {
<span class="linenr"> 8: </span>    model.emails.set( emailsEdit.value );
<span class="linenr"> 9: </span>    pm.update()
<span class="linenr">10: </span>  } );
<span class="linenr">11: </span>
<span class="linenr">12: </span>  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">When filter edit-box changed, update variable</span>
<span class="linenr">13: </span>  <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">filterEdit</span> = document.getElementById( <span style="color: #008000;">'filterEdit'</span> );
<span class="linenr">14: </span>  filterEdit.value = model.filter.get();
<span class="linenr">15: </span>  filterEdit.addEventListener( <span style="color: #008000;">'input'</span>, <span style="color: #0000FF;">function</span>() {
<span class="linenr">16: </span>    model.filter.set( filterEdit.value );
<span class="linenr">17: </span>    pm.update()
<span class="linenr">18: </span>  } );
<span class="linenr">19: </span>
<span class="linenr">20: </span>  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">When result variable changed, update span</span>
<span class="linenr">21: </span>  <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">resultSpan</span> = document.getElementById( <span style="color: #008000;">'resultSpan'</span> );
<span class="linenr">22: </span>  resultSpan.appendChild( document.createTextNode( model.result.get() ) );
<span class="linenr">23: </span>  model.result.addObserver( { onNext: <span style="color: #0000FF;">function</span>() {
<span class="linenr">24: </span>    resultSpan.removeChild( resultSpan.lastChild );
<span class="linenr">25: </span>    resultSpan.appendChild( document.createTextNode( model.result.get() ) );
<span class="linenr">26: </span>  } } );
<span class="linenr">27: </span>
<span class="linenr">28: </span>} )
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> Introduction to binding</h3>
<div class="outline-text-3" id="text-3-2">
<p>
The purpose of binding is to keep a value used by the View and a value used by
the View-Model &ldquo;in sync.&rdquo; Thus, every time one value is changed, the change is
propagated by the binding to the other value.  Generally speaking, this simply
requires registering a callback function to be called any time one changes so
that it can update the other.  We can classify bindings based on the direction
this update occurs.
</p>
</div>

<ol class="org-ol"><li><a id="sec-3-2-1"></a>A model-to-view binding<br  /><div class="outline-text-4" id="text-3-2-1">
<p>
A model-to-view binding requires registering a callback function with a
variable so that every time the variable is changed by the View-Model the View
will be updated.  The interface for this callback is discussed in depth in the
<a href="binding.html">Advanced Binding Concepts</a> how-to; the brief version, however, is that we must
create an object whose <code>onNext</code> property is a callback function, then pass
that object to the <code>addObserver</code> function of the variable.
</p>

<div class="org-src-container">

<pre class="src src-js" id="resultSpan">  model.result.addObserver( { onNext: <span style="color: #0000FF;">function</span>() {
    resultSpan.removeChild( resultSpan.lastChild );
    resultSpan.appendChild( document.createTextNode( model.result.get() ) );
  } } );
</pre>
</div>

<p>
The callback function we register here simply deletes the old contents of the
<code>&lt;span&gt;</code> tag and then adds the value of the variable as the new contents.
Now, every time the variable is modified, the span tag will be updated to
reflect the same value.
</p>
</div>
</li>

<li><a id="sec-3-2-2"></a>A view-to-model binding<br  /><div class="outline-text-4" id="text-3-2-2">
<p>
A view-to-model requires registering a callback function with the View so that
every time it changes we can update the View-Model.  The specific event for
which the callback is registered varies depending on what type of View element
it is; in some cases, there may be multiple events that must be subscribed to
in order to ensure that every time the value changes the View-Model is updated
as well.  In the example, we register for the <code>input</code> event of text-edit box,
as follows.  Here, we make sure every time the value of the text-edit box is
changed by the user, the value is used to update the corresponding View-Model.
</p>

<div class="org-src-container">

<pre class="src src-js" id="emailsEdit">  emailsEdit.addEventListener( <span style="color: #008000;">'input'</span>, <span style="color: #0000FF;">function</span>() {
    model.emails.set( emailsEdit.value );
    pm.update()
  } );
</pre>
</div>
</div>
</li>


<li><a id="sec-3-2-3"></a>A bi-directional binding<br  /><div class="outline-text-4" id="text-3-2-3">
<p>
This example does not use any bi-directional bindings, but it should be clear
what such a binding would look like.  A bi-directional binding is simply a pair
of bindings: one from view-to-model, and one from model-to-view.  Together,
these bindings ensure that any changes in the View are propagated to the
property model, and any changes in the property model are propagated to the
view.
</p>
</div>
</li></ol>
</div>

<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> The importance of binding</h3>
<div class="outline-text-3" id="text-3-3">
<p>
Binding code tends to be highly reusable.  For example, we might write code to
bind a variable to a text-edit input or a span tag, then reuse that code any
time we wish to bind to such elements.  This can often make binding a simple
matter of a few lines of code.
</p>

<p>
There is another important reason why we should use binding instead of simply
using the <code>get</code> and <code>set</code> methods of a variable directly.  Property models
update <i>asynchronously</i>.  This is discussed in depth in the <a href="async.html">Asynchronous
Methods</a>, but the important detail for now is that calling <code>update</code> on the
property model does <i>not</i> execute any methods of the property model.  Instead,
it <i>schedules</i> them to be run as soon as their inputs are available.
</p>

<p>
For example, consider the following code segment.
</p>

<div class="org-src-container">

<pre class="src src-js">model.filter.set( <span style="color: #008000;">'.edu'</span> );
pm.update();
alert( model.result.get() );
</pre>
</div>

<p>
In this segment we set the value of a variable, update the property model,
then read the value of a different variable.  If you were to execute this
code, you would find the value of <code>result</code> that you read is <i>not</i> the updated
value of <code>result</code>; it is still the old value.  The new value won't be ready
until your method has a chance to execute.
</p>

<p>
This is why it is so important that we register a callback to run when the
variable changes.  As a general rule, we cannot be sure when the new value of
a variable will be ready.  By registering a callback, we allow the property
model to tell us when a new value of the variable is available.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> HotDrink binding</h2>
<div class="outline-text-2" id="text-4">
<p>
The previous example illustrated the basic principle of binding: register a
callback function to be called when the View (or View-Model) changes so that
we can update the View-Model (or View).  Now that you understand the basic
principles, we would like to shift focus of this document away from binding.
To that end, we introduce here a few of HotDrink's built-in bindings.
</p>

<p>
HotDrink includes bindings for a few common HTML elements, such as edit boxes
and tags which can contain text.  These bindings are slightly more complex
than the bindings of the previous example, but that's primarily because we
establish some conventions to promote ease-of-use, interoperability, and
reuse; the bindings themselves follow the same basic principle.
</p>
</div>

<div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> The example</h3>
<div class="outline-text-3" id="text-4-1">
<p>
This example is similar to the previous two, but with one change: instead of
filtering the email addresses in the list, we simply return
one&#x2014;specifically, we return the one indicated by the <code>index</code> variable.
Thus, if index is 1, we return the first email address, and so on.
</p>

<div class="results">
<table id="ex4">
  <style type="text/css" scoped>
    th { padding-right: 1ex; text-align: left; font-weight: bold; }
    input.long { width: 100ex; }
  </style>
  <tr>
    <th>Emails:</th>
    <td><input type="text" data-bind="bd.edit( emails )" class="long"/></td>
  </tr>
  <tr>
    <th>Index:</th>
    <td><input type="text" data-bind="bd.num( index, 0 )"/></td>
  </tr>
  <tr>
    <th>Result:</th>
    <td><span data-bind="bd.text( result )"></span></td>
  </tr>
</table>
</div>
<script type="text/javascript">
(function() {
// Define root component
var model = new hd.ComponentBuilder()
    .v( 'emails', 'joe@foo.com, sue@fum.edu, eve@foo.com, bob@baz.org' )
    .v( 'index', 2 )
    .v( 'result' )

    .c( 'emails, index, result' )
    .m( 'emails, index -> result',
        function( emails, index ) {
          var words = emails.trim().split( /\s*,\s*/ );
          return words[index - 1];
        } )

    .component();

// Create the property model
var pm = new hd.PropertyModel();
pm.addComponent( model );
window.addEventListener( 'load', function() {
  hd.createDeclaredBindings( model, document.getElementById( 'ex4' ) );
} );
})();
</script>

<p>
<b>Source Code</b>
</p>

<div class="org-src-container">
<label class="org-src-name"><i>View</i> (show/hide)</label>
<pre class="src src-html"><span class="linenr"> 1: </span>&lt;<span style="color: #006699;">table</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"ex4"</span>&gt;
<span class="linenr"> 2: </span>  &lt;<span style="color: #006699;">style</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text/css"</span> scoped&gt;
<span class="linenr"> 3: </span>    th { padding-right: 1ex; text-align: left; font-weight: bold; }
<span class="linenr"> 4: </span>    input.long { width: 100ex; }
<span class="linenr"> 5: </span>  &lt;/<span style="color: #006699;">style</span>&gt;
<span class="linenr"> 6: </span>  &lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr"> 7: </span>    &lt;<span style="color: #006699;">th</span>&gt;Emails:&lt;/<span style="color: #006699;">th</span>&gt;
<span class="linenr"> 8: </span>    &lt;<span style="color: #006699;">td</span>&gt;&lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.edit( emails )"</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"long"</span>/&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr"> 9: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;
<span class="linenr">10: </span>  &lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">11: </span>    &lt;<span style="color: #006699;">th</span>&gt;Index:&lt;/<span style="color: #006699;">th</span>&gt;
<span class="linenr">12: </span>    &lt;<span style="color: #006699;">td</span>&gt;&lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.num( index, 0 )"</span>/&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">13: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;
<span class="linenr">14: </span>  &lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">15: </span>    &lt;<span style="color: #006699;">th</span>&gt;Result:&lt;/<span style="color: #006699;">th</span>&gt;
<span class="linenr">16: </span>    &lt;<span style="color: #006699;">td</span>&gt;&lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.text( result )"</span>&gt;&lt;/<span style="color: #006699;">span</span>&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">17: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;
<span class="linenr">18: </span>&lt;/<span style="color: #006699;">table</span>&gt;
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><i>View-Model</i> (show/hide)</label>
<pre class="src src-js"><span class="linenr"> 1: </span><span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Define root component</span>
<span class="linenr"> 2: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">model</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.ComponentBuilder</span>()
<span class="linenr"> 3: </span>    .v( <span style="color: #008000;">'emails'</span>, <span style="color: #008000;">'joe@foo.com, sue@fum.edu, eve@foo.com, bob@baz.org'</span> )
<span class="linenr"> 4: </span>    .v( <span style="color: #008000;">'index'</span>, 2 )
<span class="linenr"> 5: </span>    .v( <span style="color: #008000;">'result'</span> )
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span>    .c( <span style="color: #008000;">'emails, index, result'</span> )
<span class="linenr"> 8: </span>    .m( <span style="color: #008000;">'emails, index -&gt; result'</span>,
<span class="linenr"> 9: </span>        <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">emails</span>, <span style="color: #BA36A5;">index</span> ) {
<span class="linenr">10: </span>          <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">words</span> = emails.trim().split( <span style="color: #008000;">/\s*,\s*/</span> );
<span class="linenr">11: </span>          <span style="color: #0000FF;">return</span> words[index - 1];
<span class="linenr">12: </span>        } )
<span class="linenr">13: </span>
<span class="linenr">14: </span>    .component();
<span class="linenr">15: </span>
<span class="linenr">16: </span><span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Create the property model</span>
<span class="linenr">17: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">pm</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.PropertyModel</span>();
<span class="linenr">18: </span>pm.addComponent( model );
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><i>Binding</i> (show/hide)</label>
<pre class="src src-js"><span class="linenr">1: </span>window.addEventListener( <span style="color: #008000;">'load'</span>, <span style="color: #0000FF;">function</span>() {
<span class="linenr">2: </span>  hd.createDeclaredBindings( model, document.getElementById( <span style="color: #008000;">'ex4'</span> ) );
<span class="linenr">3: </span>} );
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> Embedding binding instructions within the View</h3>
<div class="outline-text-3" id="text-4-2">
<p>
HotDrink bindings can be created using only JavaScript code, much as we did in
the previous example.  However, HotDrink also allows you to embed JavaScript
code in the <code>data-bind</code> attribute of an HTML tag; it uses this JavaScript code
to create a binding.  This has the advantage of placing binding code as close
as possible to the View element which is being bound.
</p>

<p>
To create the bindings you have specified in your HTML, call the
<code>hd.createDeclaredBindings</code> function.  This function takes two parameters.
The first is a property model component; the second is a DOM node.  We say this
function binds the component to the DOM sub-tree rooted at the DOM node.  In
the binding section of this example, we do this as follows.  Note that this
function is called when the document loads so that we may be sure the entire
DOM is available.
</p>

<div class="org-src-container">

<pre class="src src-js" id="createBindings">hd.createDeclaredBindings( model, document.getElementById( <span style="color: #008000;">'ex4'</span> ) );
</pre>
</div>

<p>
This function performs a recursive search of the DOM tree beginning at the
specified DOM node&#x2014;i.e., the node itself and everything contained by it.  It
attempts to create a binding for any tags it finds with a <code>data-bind</code>
attribute.
</p>

<p>
When calling this function, the second parameter is optional; it defaults to
<code>document.body</code>, meaning the entire document body is searched.
</p>
</div>
</div>

<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> Binding specifications</h3>
<div class="outline-text-3" id="text-4-3">
<p>
The exact process through which the binding is created is described in detail
in the <a href="binding.html">Advanced Binding Concepts</a> document.  However, you should already have
an idea of what that code does:  create event handlers for either the View or
View-Model (or both) that update one every time the other is changed.
</p>

<p>
To create a binding, we generally require the following information.
</p>

<ol class="org-ol">
<li>What element of the view are we binding to?
</li>
<li>What kind of element is it?  Or, more importantly, what is the interface
for interacting with it?  For example, you set the contents of a text-edit
box by assigning to its <code>value</code> field; you set the contents of a container
tag by using its <code>appendChild</code> function.
</li>
<li>What element of the property model are we binding to?
</li>
<li>Do we need to do any conversion between the View and the property model?
</li>
</ol>

<p>
Taken together, we call this information a <i>binding specification</i>.  HotDrink
allows you to place binding specifications inside the <code>data-bind</code> attribute of
HTML tags.  This implies item #1 in the list above; it is the tag in which the
specification is found.  Generally, #2 is represented by a function written to
create a certain kind of binding, and #3 is the parameter to that function.
Item #4 may be implied by the function, or may be passed as an additional
parameter to the function.
</p>

<p>
Generally speaking, the code inside the <code>data-bind</code> tag is just arbitrary
JavaScript code.  However, there are a couple of peculiarities.  First, inside
the <code>data-bind</code> attribute, the variable <code>bd</code> holds a special object called the
<i>binding environment</i>.  This object contains several member functions which
can be used to create HotDrink's built-in bindings.  We discuss three of these
functions below.
</p>

<p>
The second peculiarity is that you may refer to properties of the component to
which you are binding directly by name.  Or, to put this another way, any
unqualified names in the JavaScript code are first treated as properties of
the component to which you are binding.  If they are not found in that
component, then they are treated as global names.  This convenience feature
means that we can simply write, e.g., <code>filter</code> instead of <code>model.filter</code>.
</p>
</div>
</div>

<div id="outline-container-sec-4-4" class="outline-3">
<h3 id="sec-4-4"><span class="section-number-3">4.4</span> Three common bindings</h3>
<div class="outline-text-3" id="text-4-4">
<p>
Here we give three common bindings which we will use in the remainder of this
document.
</p>
</div>


<ol class="org-ol"><li><a id="sec-4-4-1"></a>The edit binding<br  /><div class="outline-text-4" id="text-4-4-1">
<p>
The edit binding applies specifically to a text-edit box.  The value entered
by the user is used to set the variable, and the value of the variable is used
to set the value of the text box.  This binding is specified using the
<code>bd.edit</code> function.  The required parameter of this function is the variable
to bind to.
</p>

<div class="org-src-container">

<pre class="src src-html" id="editbind">&lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.edit( emails )"</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"long"</span>/&gt;
</pre>
</div>
</div>
</li>

<li><a id="sec-4-4-2"></a>The number binding<br  /><div class="outline-text-4" id="text-4-4-2">
<p>
The number binding is a variant of the edit binding in which the value of the
text box is converted to a number before being assigned to the variable.  This
binding is specified using the <code>bd.edit</code> function.  The required parameter of
this function is the variable to bind to.  The first optional parameter is the
number of digits to keep after decimal point.  Note that numbers are always
represented as floating point values, and that precision is achieved through
rounding; we can <i>not</i> guarantee precision.p
</p>

<div class="org-src-container">

<pre class="src src-html" id="numbind">&lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.num( index, 0 )"</span>/&gt;
</pre>
</div>
</div>
</li>

<li><a id="sec-4-4-3"></a>The text binding<br  /><div class="outline-text-4" id="text-4-4-3">
<p>
The text binding is suitable for any tag that can contain text.  Note that
this binding replaces the <i>entire</i> contents of the tag with the value of the
variable.  This binding is specified using the <code>bd.text</code> function.  The
required parameter of this function is the variable to bind to.
</p>

<div class="org-src-container">

<pre class="src src-html" id="textbind">&lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.text( result )"</span>&gt;&lt;/<span style="color: #006699;">span</span>&gt;
</pre>
</div>
</div>
</li></ol>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Multi-way constraints</h2>
<div class="outline-text-2" id="text-5">
<p>
Constraints in HotDrink can be solved in multiple directions.  For example,
given the constraint \(width=right-left\), we could solve for any one of the
three variables using the values of the other two.  To create a multi-way
constraint, we simply provide one method for each way the constraint can be
solved.
</p>

<p>
In general, HotDrink tries to preserve the values the user has entered most
recently.  Thus, when given a choice of how to solve a constraint, HotDrink
will look for the method which updates the <i>least</i> recently edited variable.
</p>
</div>

<div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> The example</h3>
<div class="outline-text-3" id="text-5-1">
<p>
This example defines a rectangular region of an image.  There are several
interrelated values reflected by this region, such as its boundaries, its
dimensions, and its aspect ratio (ration of wight to height).  Editing any of
these values will update others so that they are all consistent.
</p>

<div class="results">
<table id="ex5" style="text-align: right">
  <tr>
    <td>
      Left:  <input type="text" data-bind="bd.num( left )"/><br/>
      Right: <input type="text" data-bind="bd.num( right )"/><br/>
      Width: <input type="text" data-bind="bd.num( width )"/><br/>
    </td>
    <td>
      Top:    <input type="text" data-bind="bd.num( top )"/><br/>
      Bottom: <input type="text" data-bind="bd.num( bottom )"/><br/>
      Height: <input type="text" data-bind="bd.num( height )"/><br/>
    </td>
  </tr>
  <tr>
    <td colspan="2" style="text-align:center">
      Aspect Ratio: <input type="text" data-bind="bd.num( aspect )"/>
    </td>
  </tr>
</table>
</div>
<script type="text/javascript">
(function() {
// Helper functions
function sum ( x, y ) { return x + y; }
function diff( x, y ) { return x - y; }
function prod( x, y ) { return x * y; }
function quot( x, y ) { return x / y; }

var model = new hd.ComponentBuilder()
  .variables( 'left, right, width, top, bottom, height, aspect',
              {left: 0, right: 100, top: 60, bottom: 140}
  )

  // Constraint: width == right - left
  .c( 'left, right, width' )
  .m( 'left, width -> right', sum  )
  .m( 'right, left -> width', diff )
  .m( 'right, width -> left', diff )

  // Constraint: height == bottom - top
  .c( 'top, bottom, height' )
  .m( 'top, height -> bottom', sum  )
  .m( 'bottom, top -> height', diff )
  .m( 'bottom, height -> top', diff )

  // Constraint: aspect == width / height
  .c( 'width, height, aspect' )
  .m( 'height, aspect -> width', prod )
  .m( 'width, height -> aspect', quot )
  .m( 'width, aspect -> height', quot )

  .component();

var pm = new hd.PropertyModel();
pm.addComponent( model );
window.addEventListener( 'load', function() {
  hd.createDeclaredBindings( model, document.getElementById( 'ex5' ) );
} );
})();
</script>

<p>
<b>Source Code</b>
</p>

<div class="org-src-container">
<label class="org-src-name"><i>View</i> (show/hide)</label>
<pre class="src src-html"><span class="linenr"> 1: </span>&lt;<span style="color: #006699;">table</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"ex5"</span> <span style="color: #BA36A5;">style</span>=<span style="color: #008000;">"text-align: right"</span>&gt;
<span class="linenr"> 2: </span>  &lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr"> 3: </span>    &lt;<span style="color: #006699;">td</span>&gt;
<span class="linenr"> 4: </span>      Left:  &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.num( left )"</span>/&gt;&lt;<span style="color: #006699;">br</span>/&gt;
<span class="linenr"> 5: </span>      Right: &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.num( right )"</span>/&gt;&lt;<span style="color: #006699;">br</span>/&gt;
<span class="linenr"> 6: </span>      Width: &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.num( width )"</span>/&gt;&lt;<span style="color: #006699;">br</span>/&gt;
<span class="linenr"> 7: </span>    &lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr"> 8: </span>    &lt;<span style="color: #006699;">td</span>&gt;
<span class="linenr"> 9: </span>      Top:    &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.num( top )"</span>/&gt;&lt;<span style="color: #006699;">br</span>/&gt;
<span class="linenr">10: </span>      Bottom: &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.num( bottom )"</span>/&gt;&lt;<span style="color: #006699;">br</span>/&gt;
<span class="linenr">11: </span>      Height: &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.num( height )"</span>/&gt;&lt;<span style="color: #006699;">br</span>/&gt;
<span class="linenr">12: </span>    &lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">13: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;
<span class="linenr">14: </span>  &lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">15: </span>    &lt;<span style="color: #006699;">td</span> <span style="color: #BA36A5;">colspan</span>=<span style="color: #008000;">"2"</span> <span style="color: #BA36A5;">style</span>=<span style="color: #008000;">"text-align:center"</span>&gt;
<span class="linenr">16: </span>      Aspect Ratio: &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.num( aspect )"</span>/&gt;
<span class="linenr">17: </span>    &lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">18: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;
<span class="linenr">19: </span>&lt;/<span style="color: #006699;">table</span>&gt;
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><i>View-Model</i> (show/hide)</label>
<pre class="src src-js"><span class="linenr"> 1: </span><span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Helper functions</span>
<span class="linenr"> 2: </span><span style="color: #0000FF;">function</span> <span style="color: #006699;">sum</span> ( <span style="color: #BA36A5;">x</span>, <span style="color: #BA36A5;">y</span> ) { <span style="color: #0000FF;">return</span> x + y; }
<span class="linenr"> 3: </span><span style="color: #0000FF;">function</span> <span style="color: #006699;">diff</span>( <span style="color: #BA36A5;">x</span>, <span style="color: #BA36A5;">y</span> ) { <span style="color: #0000FF;">return</span> x - y; }
<span class="linenr"> 4: </span><span style="color: #0000FF;">function</span> <span style="color: #006699;">prod</span>( <span style="color: #BA36A5;">x</span>, <span style="color: #BA36A5;">y</span> ) { <span style="color: #0000FF;">return</span> x * y; }
<span class="linenr"> 5: </span><span style="color: #0000FF;">function</span> <span style="color: #006699;">quot</span>( <span style="color: #BA36A5;">x</span>, <span style="color: #BA36A5;">y</span> ) { <span style="color: #0000FF;">return</span> x / y; }
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">model</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.ComponentBuilder</span>()
<span class="linenr"> 8: </span>  .variables( <span style="color: #008000;">'left, right, width, top, bottom, height, aspect'</span>,
<span class="linenr"> 9: </span>              {left: 0, right: 100, top: 60, bottom: 140}
<span class="linenr">10: </span>  )
<span class="linenr">11: </span>
<span class="linenr">12: </span>  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Constraint: width == right - left</span>
<span class="linenr">13: </span>  .c( <span style="color: #008000;">'left, right, width'</span> )
<span class="linenr">14: </span>  .m( <span style="color: #008000;">'left, width -&gt; right'</span>, sum  )
<span class="linenr">15: </span>  .m( <span style="color: #008000;">'right, left -&gt; width'</span>, diff )
<span class="linenr">16: </span>  .m( <span style="color: #008000;">'right, width -&gt; left'</span>, diff )
<span class="linenr">17: </span>
<span class="linenr">18: </span>  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Constraint: height == bottom - top</span>
<span class="linenr">19: </span>  .c( <span style="color: #008000;">'top, bottom, height'</span> )
<span class="linenr">20: </span>  .m( <span style="color: #008000;">'top, height -&gt; bottom'</span>, sum  )
<span class="linenr">21: </span>  .m( <span style="color: #008000;">'bottom, top -&gt; height'</span>, diff )
<span class="linenr">22: </span>  .m( <span style="color: #008000;">'bottom, height -&gt; top'</span>, diff )
<span class="linenr">23: </span>
<span class="linenr">24: </span>  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Constraint: aspect == width / height</span>
<span class="linenr">25: </span>  .c( <span style="color: #008000;">'width, height, aspect'</span> )
<span class="linenr">26: </span>  .m( <span style="color: #008000;">'height, aspect -&gt; width'</span>, prod )
<span class="linenr">27: </span>  .m( <span style="color: #008000;">'width, height -&gt; aspect'</span>, quot )
<span class="linenr">28: </span>  .m( <span style="color: #008000;">'width, aspect -&gt; height'</span>, quot )
<span class="linenr">29: </span>
<span class="linenr">30: </span>  .component();
<span class="linenr">31: </span>
<span class="linenr">32: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">pm</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.PropertyModel</span>();
<span class="linenr">33: </span>pm.addComponent( model );
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><i>Binding</i> (show/hide)</label>
<pre class="src src-js"><span class="linenr">1: </span>window.addEventListener( <span style="color: #008000;">'load'</span>, <span style="color: #0000FF;">function</span>() {
<span class="linenr">2: </span>  hd.createDeclaredBindings( model, document.getElementById( <span style="color: #008000;">'ex5'</span> ) );
<span class="linenr">3: </span>} );
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> Updating the constraint system</h3>
<div class="outline-text-3" id="text-5-2">
<p>
Whenever you modify any of the variables of the property model, HotDrink
assumes any constraints which use those variables are no longer satisfied.  It
then performs two tasks.  The first is to decide which variable (or variables)
should be updated.  The second is to use a method (or methods) you provided to
calculate a new value for that variable (or variables).
</p>

<p>
Deciding which variables to update is not a trivial task.  Consider the
following scenario:  the variable <code>left</code> is modified, so HotDrink decides to
update the <code>width</code> variable so that <code>width == right - left</code>.  But now the
constraint <code>aspect == width / height</code> is no longer satisfied, so HotDrink must
update one of those variables as well.  Thus, the effects of a single edit can
cascade to multiple variables.  HotDrink must consider the entire constraint
system and decide which variables will be used to update which other
variables.  This plan for updating is called a <i>dataflow</i>.
</p>

<p>
Often there is more than one possible dataflow which could work.  In this
case, HotDrink will <i>generally</i> select the dataflow which preserves variables
that have been more recently edited by the user.  (In certain unusual cases
the behavior is slightly more complicated, but this rule of thumb is close
enough for now.)  We believe this is generally what the user wants, as the
values more recently edited are more likely to reflect the user's current
intent.
</p>
</div>
</div>

<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3"><span class="section-number-3">5.3</span> Declaring multiple variables at once</h3>
<div class="outline-text-3" id="text-5-3">
<p>
This example uses the <code>variables</code> function of the component builder to declare
multiple variables at once.  This function takes two parameters.  The first is
a string containing a comma-delimited list of variables to create.  The second
is an object used as a map to provide initial values for variables.  If a
variable does not contain an entry in the map, it is treated as uninitialized,
and therefore given the value <code>undefined</code>.
</p>

<div class="org-src-container">

<pre class="src src-js" id="variables">  .variables( <span style="color: #008000;">'left, right, width, top, bottom, height, aspect'</span>,
              {left: 0, right: 100, top: 60, bottom: 140}
  )
</pre>
</div>

<p>
Note that the variables are created in the order in which they appear in the
string.  This is significant as the order in which variables are created
determines the initial editing order for the variables, and thus affects the
initial dataflow selected by the system.  Initializing a variable is treated
as an edit; creating an uninitialized variable is not treated as an edit.
Thus, the system will initially pick a dataflow that writes to uninitialized
variables; If any initialized variables need to be overwritten, the system
will choose to overwrite the variables created <i>earlier</i>, since those will be
considered less-recently edited.
</p>

<p>
The <code>variables</code> member function returns the builder.  The abbreviation for
<code>variables</code> is <code>vs</code>; we will use this abbreviation in the remainder of the
examples.
</p>
</div>
</div>

<div id="outline-container-sec-5-4" class="outline-3">
<h3 id="sec-5-4"><span class="section-number-3">5.4</span> Reusing functions</h3>
<div class="outline-text-3" id="text-5-4">
<p>
Notice that we can reuse the same function for multiple methods.  In this
example, we defined four simple mathematical functions at the top, then simply
used the appropriate function for each method.  Again, the values passed as
arguments will come from the variables specified in the signature.
</p>

<p>
In fact, if your constraints really are trivial equations such as this, there
is an even easier way to specify them.  We'll discuss that in the section
<a href="#sec-8">Shortcut: equations</a>.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Input/output variables</h2>
<div class="outline-text-2" id="text-6">
<p>
When solving the constraint system, HotDrink must ensure that any variables
needing to be updated are given a new value before they are read by any
methods.  This creates a challenge for methods that want to look at the old
value of a variable as they update it.  Fortunately, HotDrink has a method of
providing the previous value of a variable to a method.
</p>
</div>

<div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1"><span class="section-number-3">6.1</span> The example</h3>
<div class="outline-text-3" id="text-6-1">
<p>
The constraint here is actually an inequality: \(begin\le{}end+1\).  If you set one
variable so that the inequality holds, then the other variable is not
modified.  However, if you make the inequality false, then the other variable
is changed just enough to make it true.
</p>

<div class="results">
<div id="ex6" style="display:inline-block; text-align:right">
  Begin: <input type="text" data-bind="bd.num( begin )"/><br/>
  End:   <input type="text" data-bind="bd.num( end )"/>
</div>
</div>
<script type="text/javascript">
(function() {
var model = new hd.ComponentBuilder()
  .v( 'begin', 10 ).v( 'end', 20 )

   // Constraint: begin < end
  .c( 'begin, end' )
  .m( 'begin, !end -> end',
      function( begin, end ) {
        return end < begin + 1 ? begin + 1 : end;
      } )
  .m( '!begin, end -> begin',
      function( begin, end ) {
        return begin > end - 1 ? end - 1 : begin;
      } )

  .component();

var pm = new hd.PropertyModel;
pm.addComponent( model );
window.addEventListener( 'load', function() {
  hd.createDeclaredBindings( model, document.getElementById( 'ex6' ) );
} );
})();
</script>

<p>
<b>Source Code</b>
</p>

<div class="org-src-container">
<label class="org-src-name"><i>View</i> (show/hide)</label>
<pre class="src src-html"><span class="linenr">1: </span>&lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"ex6"</span> <span style="color: #BA36A5;">style</span>=<span style="color: #008000;">"display:inline-block; text-align:right"</span>&gt;
<span class="linenr">2: </span>  Begin: &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.num( begin )"</span>/&gt;&lt;<span style="color: #006699;">br</span>/&gt;
<span class="linenr">3: </span>  End:   &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.num( end )"</span>/&gt;
<span class="linenr">4: </span>&lt;/<span style="color: #006699;">div</span>&gt;
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><i>View-Model</i> (show/hide)</label>
<pre class="src src-js"><span class="linenr"> 1: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">model</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.ComponentBuilder</span>()
<span class="linenr"> 2: </span>  .v( <span style="color: #008000;">'begin'</span>, 10 ).v( <span style="color: #008000;">'end'</span>, 20 )
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span>   <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Constraint: begin &lt; end</span>
<span class="linenr"> 5: </span>  .c( <span style="color: #008000;">'begin, end'</span> )
<span class="linenr"> 6: </span>  .m( <span style="color: #008000;">'begin, !end -&gt; end'</span>,
<span class="linenr"> 7: </span>      <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">begin</span>, <span style="color: #BA36A5;">end</span> ) {
<span class="linenr"> 8: </span>        <span style="color: #0000FF;">return</span> end &lt; begin + 1 ? begin + 1 : end;
<span class="linenr"> 9: </span>      } )
<span class="linenr">10: </span>  .m( <span style="color: #008000;">'!begin, end -&gt; begin'</span>,
<span class="linenr">11: </span>      <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">begin</span>, <span style="color: #BA36A5;">end</span> ) {
<span class="linenr">12: </span>        <span style="color: #0000FF;">return</span> begin &gt; end - 1 ? end - 1 : begin;
<span class="linenr">13: </span>      } )
<span class="linenr">14: </span>
<span class="linenr">15: </span>  .component();
<span class="linenr">16: </span>
<span class="linenr">17: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">pm</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.PropertyModel</span>;
<span class="linenr">18: </span>pm.addComponent( model );
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><i>Binding</i> (show/hide)</label>
<pre class="src src-js"><span class="linenr">1: </span>window.addEventListener( <span style="color: #008000;">'load'</span>, <span style="color: #0000FF;">function</span>() {
<span class="linenr">2: </span>  hd.createDeclaredBindings( model, document.getElementById( <span style="color: #008000;">'ex6'</span> ) );
<span class="linenr">3: </span>} );
</pre>
</div>

<div class="notes">
</div>
</div>
</div>

<div id="outline-container-sec-6-2" class="outline-3">
<h3 id="sec-6-2"><span class="section-number-3">6.2</span> Previous variable values</h3>
<div class="outline-text-3" id="text-6-2">
<p>
Technically a method cannot use the same variable as input and output: it
would require the method to produce its output before it read its parameters.
However, we allow a method to access the <i>previous</i> value of a variable&#x2014;the
value it had before we began solving the constraint system.
</p>

<p>
In fact, a method may access the previous value of <i>any</i> variable, not just
its outputs.  For this reason, when a method wants the previous value of a
variable as an input, we require that it be indicated in the method's
signature.  This is done by putting an exclamation point (&ldquo;!&rdquo;) in front of the
variable name.  For example, the following method uses the previous value of
<code>begin</code> and the updated value of <code>end</code> to calculate the updated value of
<code>begin</code>.
</p>

<div class="org-src-container">

<pre class="src src-js" id="previous">  .m( <span style="color: #008000;">'begin, !end -&gt; end'</span>,
      <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">begin</span>, <span style="color: #BA36A5;">end</span> ) {
        <span style="color: #0000FF;">return</span> end &lt; begin + 1 ? begin + 1 : end;
      } )
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-3" class="outline-3">
<h3 id="sec-6-3"><span class="section-number-3">6.3</span> Caveat</h3>
<div class="outline-text-3" id="text-6-3">
<p>
In general, it is unwise to make assumptions about when HotDrink will run your
method, including how often your method will be run.  Thus, you should avoid
methods like the following.
</p>

<div class="org-src-container">

<pre class="src src-js">.m( <span style="color: #008000;">"!n, x -&gt; n"</span>,
    <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">n</span> ) {
      <span style="color: #0000FF;">return</span> n + x;
    } )
</pre>
</div>

<p>
Such a method may lead to poorly defined behavior, since its effect depends on
how frequently it is run.  Furthermore, it is unclear what constraint such a
method enforces; the relation \(n=n+x\) seems nonsensical.
</p>

<p>
If you need some sort of incremental behavior, it is better to use a separate
variable to represent the increment since the previous iteration.  For
example, one might use a variable \(t\) to represent time.  Then we could write
the method as follows:
</p>

<div class="org-src-container">

<pre class="src src-js">.method( <span style="color: #008000;">"!t, t, !n, x -&gt; n"</span>, <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">t1</span>, <span style="color: #BA36A5;">t2</span>, <span style="color: #BA36A5;">n</span>, <span style="color: #BA36A5;">x</span> ) {
  <span style="color: #0000FF;">return</span> n + (t2 - t1)*x;
}
</pre>
</div>

<p>
Such a method would define \(n\) as the integral of \(x\) over \(t\).  Each change
in \(t\) would cause the method to update the value of \(n\) accordingly.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Multiple output variables</h2>
<div class="outline-text-2" id="text-7">
<p>
In many cases it is desirable to have a method with multiple output variables.
Of course, a function can only return a single value; however, we allow that
value to be an array.  The different elements of that array can then be
assigned to variables by pattern matching against the signature.
</p>
</div>

<div id="outline-container-sec-7-1" class="outline-3">
<h3 id="sec-7-1"><span class="section-number-3">7.1</span> The example</h3>
<div class="outline-text-3" id="text-7-1">
<p>
This is a straightforward constraint: the value for the year is the sum of the
values for the four quarters.  However, data can only flow two ways in this
constraint.  If any one of the quarters is modified, then the year is updated.
If the year is modified, then we take the difference and distribute it evenly
among the four quarters, thus satisfying the constraint.
</p>

<div class="results">
<div id="ex7" style="display:inline-block; text-align:right">
  First Quarter:  <input type="text" data-bind="bd.num( q1 )"/><br/>
  Second Quarter: <input type="text" data-bind="bd.num( q2 )"/><br/>
  Third Quarter:  <input type="text" data-bind="bd.num( q3 )"/><br/>
  Fourth Quarter: <input type="text" data-bind="bd.num( q4 )"/><br/>
  <hr/>
  Full Year:      <input type="text" data-bind="bd.num( year )"/><br/>
</div>
</div>
<script type="text/javascript">
(function() {
var model = new hd.ComponentBuilder()
  .vs( 'q1, q2, q3, q4, year', {q1: 10, q2: 30, q3: 60, q4: 100} )

  .c( 'q1, q2, q3, q4, year' )
  .m( 'q1, q2, q3, q4 -> year',
      function( q1, q2, q3, q4 ) {
        return q1 + q2 + q3 + q4;
      } )
  .m( 'year, !q1, !q2, !q3, !q4 -> q1, q2, q3, q4',
      function( year, q1, q2, q3, q4 ) {
        var diff = (year - q1 - q2 - q3 - q4) / 4;
        return [q1 + diff, q2 + diff, q3 + diff, q4 + diff ];
      }
  )

  .component();

var pm = new hd.PropertyModel();
pm.addComponent( model );
window.addEventListener( 'load', function() {
  hd.createDeclaredBindings( model, document.getElementById( "ex7" ) );
} );
})();
</script>

<p>
<b>Source Code</b>
</p>

<div class="org-src-container">
<label class="org-src-name"><i>View</i> (show/hide)</label>
<pre class="src src-html"><span class="linenr">1: </span>&lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"ex7"</span> <span style="color: #BA36A5;">style</span>=<span style="color: #008000;">"display:inline-block; text-align:right"</span>&gt;
<span class="linenr">2: </span>  First Quarter:  &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.num( q1 )"</span>/&gt;&lt;<span style="color: #006699;">br</span>/&gt;
<span class="linenr">3: </span>  Second Quarter: &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.num( q2 )"</span>/&gt;&lt;<span style="color: #006699;">br</span>/&gt;
<span class="linenr">4: </span>  Third Quarter:  &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.num( q3 )"</span>/&gt;&lt;<span style="color: #006699;">br</span>/&gt;
<span class="linenr">5: </span>  Fourth Quarter: &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.num( q4 )"</span>/&gt;&lt;<span style="color: #006699;">br</span>/&gt;
<span class="linenr">6: </span>  &lt;<span style="color: #006699;">hr</span>/&gt;
<span class="linenr">7: </span>  Full Year:      &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.num( year )"</span>/&gt;&lt;<span style="color: #006699;">br</span>/&gt;
<span class="linenr">8: </span>&lt;/<span style="color: #006699;">div</span>&gt;
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><i>View-Model</i> (show/hide)</label>
<pre class="src src-js"><span class="linenr"> 1: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">model</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.ComponentBuilder</span>()
<span class="linenr"> 2: </span>  .vs( <span style="color: #008000;">'q1, q2, q3, q4, year'</span>, {q1: 10, q2: 30, q3: 60, q4: 100} )
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span>  .c( <span style="color: #008000;">'q1, q2, q3, q4, year'</span> )
<span class="linenr"> 5: </span>  .m( <span style="color: #008000;">'q1, q2, q3, q4 -&gt; year'</span>,
<span class="linenr"> 6: </span>      <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">q1</span>, <span style="color: #BA36A5;">q2</span>, <span style="color: #BA36A5;">q3</span>, <span style="color: #BA36A5;">q4</span> ) {
<span class="linenr"> 7: </span>        <span style="color: #0000FF;">return</span> q1 + q2 + q3 + q4;
<span class="linenr"> 8: </span>      } )
<span class="linenr"> 9: </span>  .m( <span style="color: #008000;">'year, !q1, !q2, !q3, !q4 -&gt; q1, q2, q3, q4'</span>,
<span class="linenr">10: </span>      <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">year</span>, <span style="color: #BA36A5;">q1</span>, <span style="color: #BA36A5;">q2</span>, <span style="color: #BA36A5;">q3</span>, <span style="color: #BA36A5;">q4</span> ) {
<span class="linenr">11: </span>        <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">diff</span> = (year - q1 - q2 - q3 - q4) / 4;
<span class="linenr">12: </span>        <span style="color: #0000FF;">return</span> [q1 + diff, q2 + diff, q3 + diff, q4 + diff ];
<span class="linenr">13: </span>      }
<span class="linenr">14: </span>  )
<span class="linenr">15: </span>
<span class="linenr">16: </span>  .component();
<span class="linenr">17: </span>
<span class="linenr">18: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">pm</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.PropertyModel</span>();
<span class="linenr">19: </span>pm.addComponent( model );
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><i>Binding</i> (show/hide)</label>
<pre class="src src-js"><span class="linenr">1: </span>window.addEventListener( <span style="color: #008000;">'load'</span>, <span style="color: #0000FF;">function</span>() {
<span class="linenr">2: </span>  hd.createDeclaredBindings( model, document.getElementById( <span style="color: #008000;">"ex7"</span> ) );
<span class="linenr">3: </span>} );
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-7-2" class="outline-3">
<h3 id="sec-7-2"><span class="section-number-3">7.2</span> Multiple return values</h3>
<div class="outline-text-3" id="text-7-2">
<p>
The signature of the following method designates that it will return an array,
and that the elements of that array are the values of <code>q1</code>, <code>q2</code>, <code>q3</code>, and
<code>q4</code> respectively.  When the value is returned, it is matched against the
signature, and values are assigned to the corresponding variables.
</p>

<div class="org-src-container">

<pre class="src src-js" id="multiout">  .m( <span style="color: #008000;">'year, !q1, !q2, !q3, !q4 -&gt; q1, q2, q3, q4'</span>,
      <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">year</span>, <span style="color: #BA36A5;">q1</span>, <span style="color: #BA36A5;">q2</span>, <span style="color: #BA36A5;">q3</span>, <span style="color: #BA36A5;">q4</span> ) {
        <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">diff</span> = (year - q1 - q2 - q3 - q4) / 4;
        <span style="color: #0000FF;">return</span> [q1 + diff, q2 + diff, q3 + diff, q4 + diff ];
      }
  )
</pre>
</div>

<p>
Note that this form of pattern matching works for inputs as well.  For
example, we could indicate that we wanted to receive the old values of <code>p1</code>,
<code>p2</code>, <code>p3</code>, and <code>p4</code> as an array, like so.
</p>

<div class="org-src-container">

<pre class="src src-js">  .m( <span style="color: #008000;">'year, [!q1, !q2, !q3, !q4] -&gt; [q1, q2, q3, q4]'</span>,
      <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">year</span>, <span style="color: #BA36A5;">qs</span> ) {
        <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">diff</span> = (year - qs[0] - qs[1] - qs[2] - qs[3]) / 4;
        <span style="color: #0000FF;">return</span> qs.map( <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">qi</span> ) { <span style="color: #0000FF;">return</span> qi + diff; }
      }
  )
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> Shortcut: equations</h2>
<div class="outline-text-2" id="text-8">
<p>
HotDrink does not inherently know how to solve any type of constraint; it
relies on the programmer to provide constraint satisfaction methods.  That
being said, because many constraints can be represented as very simple
mathematical equations, HotDrink includes a very basic equation parser which
can translate simple equations into a set of constraint satisfaction methods.
You are welcome to use this parser to avoid writing certain types of trivial
methods.
</p>
</div>

<div id="outline-container-sec-8-1" class="outline-3">
<h3 id="sec-8-1"><span class="section-number-3">8.1</span> The example</h3>
<div class="outline-text-3" id="text-8-1">
<p>
In this example we can calculate the minimum payment required on an account
balance based on a given percentage of the balance.  We can also specify the
actual payment made, though it must be higher than the minimum.
</p>

<div class="results">
<table style="text-align: right" id="ex8">
  <tr><td>
    Account Balance: <input type="text" data-bind="bd.num( balance, 2 )"/><br/>
    Minimum Percentage: <input type="text" data-bind="bd.num( min_rate, 3 )"/><br/>
    Minimum Payment: <input type="text" data-bind="bd.num( min_pay, 2 )"/><br/>
    <hr/>
    Payment Made: <input type="text" data-bind="bd.num( pay, 2 )"/>
  </td></tr>
</table>
</div>
<script type="text/javascript">
(function() {
var model = new hd.ComponentBuilder()
  .vs( 'balance, min_rate, min_pay, pay', {balance: 4000, min_rate: 6.125} )
  .equation( "min_pay == balance * min_rate / 100" )
  .equation( "pay >= min_pay" )
  .component();

var pm = new hd.PropertyModel();
pm.addComponent( model );

window.addEventListener( 'load', function() {
  hd.createDeclaredBindings( model, document.getElementById( 'ex8' ) );
} );
})();
</script>

<div class="org-src-container">

<pre class="src src-html"><span class="linenr">1: </span>&lt;<span style="color: #006699;">table</span> <span style="color: #BA36A5;">style</span>=<span style="color: #008000;">"text-align: right"</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"ex8"</span>&gt;
<span class="linenr">2: </span>  &lt;<span style="color: #006699;">tr</span>&gt;&lt;<span style="color: #006699;">td</span>&gt;
<span class="linenr">3: </span>    Account Balance: &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.num( balance, 2 )"</span>/&gt;&lt;<span style="color: #006699;">br</span>/&gt;
<span class="linenr">4: </span>    Minimum Percentage: &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.num( min_rate, 3 )"</span>/&gt;&lt;<span style="color: #006699;">br</span>/&gt;
<span class="linenr">5: </span>    Minimum Payment: &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.num( min_pay, 2 )"</span>/&gt;&lt;<span style="color: #006699;">br</span>/&gt;
<span class="linenr">6: </span>    &lt;<span style="color: #006699;">hr</span>/&gt;
<span class="linenr">7: </span>    Payment Made: &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.num( pay, 2 )"</span>/&gt;
<span class="linenr">8: </span>  &lt;/<span style="color: #006699;">td</span>&gt;&lt;/<span style="color: #006699;">tr</span>&gt;
<span class="linenr">9: </span>&lt;/<span style="color: #006699;">table</span>&gt;
</pre>
</div>

<div class="org-src-container">

<pre class="src src-js"><span class="linenr"> 1: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">model</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.ComponentBuilder</span>()
<span class="linenr"> 2: </span>  .vs( <span style="color: #008000;">'balance, min_rate, min_pay, pay'</span>, {balance: 4000, min_rate: 6.125} )
<span class="linenr"> 3: </span>  .equation( <span style="color: #008000;">"min_pay == balance * min_rate / 100"</span> )
<span class="linenr"> 4: </span>  .equation( <span style="color: #008000;">"pay &gt;= min_pay"</span> )
<span class="linenr"> 5: </span>  .component();
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">pm</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.PropertyModel</span>();
<span class="linenr"> 8: </span>pm.addComponent( model );
<span class="linenr"> 9: </span>
<span class="linenr">10: </span>window.addEventListener( <span style="color: #008000;">'load'</span>, <span style="color: #0000FF;">function</span>() {
<span class="linenr">11: </span>  hd.createDeclaredBindings( model, document.getElementById( <span style="color: #008000;">'ex8'</span> ) );
<span class="linenr">12: </span>} );
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-8-2" class="outline-3">
<h3 id="sec-8-2"><span class="section-number-3">8.2</span> Allowable equations</h3>
<div class="outline-text-3" id="text-8-2">
<p>
HotDrink is <i>not</i> a program for solving mathematical equations.  However,
simple equations like the ones in this example are common and are not hard to
solve.  Therefore, as a convenience, HotDrink provides this shortcut method
for creating constraints from <i>simple</i> equations.
</p>

<p>
The equations which HotDrink can enforce are those in which (1) no variable
appears in the equation more than once, and (2) the only operations are add
(<code>+</code>), subtract (<code>-</code>), multiply (<code>*</code>), and divide (<code>/</code>).  This means, e.g., no
exponents, no square roots, etc.
</p>

<p>
Note that, despite the name, the <code>equation</code> member function can also parse
inequalities.  Thus, the allowable comparison operators in an equation are
<code>==</code>, <code>&lt;=</code>, and <code>&gt;=</code>.
</p>

<p>
Examples of valid equations:
</p>

<ul class="org-ul">
<li><code>width == right - left</code>
</li>
<li><code>aspect == width / height</code>
</li>
<li><code>surface == (2*width + 2*length) * height</code>
</li>
</ul>

<p>
Examples of invalid equations:
</p>

<ul class="org-ul">
<li><code>perimeter = width + height + width + height</code>
</li>
<li><code>area == 3.14*radius^2</code>
</li>
<li><code>side == sqrt(area)</code>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-8-3" class="outline-3">
<h3 id="sec-8-3"><span class="section-number-3">8.3</span> Implementation</h3>
<div class="outline-text-3" id="text-8-3">
<p>
HotDrink implements these equations by parsing them and then, for each
variable, constructing a function which solves for that variable.  Each of
these functions then becomes a method.  Thus, the constraint will have as many
methods as there are variables, with each method updating exactly one
variable.
</p>

<p>
To be clear, the <code>equation</code> function's only advantage is that it saves you
some typing; in the end you still get a normal constraint, the same as if you
had written the methods yourself.
</p>

<p>
As you probably expect by now, the <code>equation</code> member function returns the
builder.  It can be abbreviated <code>eq</code>.
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2015-10-29 Thu 10:13</p>
<p class="validation"></p>
</div>
</body>
</html>
