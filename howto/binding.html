<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Advanced Binding Concepts</title>
<!-- 2015-10-29 Thu 10:02 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript" src="hotdrink.min.js"></script>
<script type="text/javascript" src="collapse.js"></script>
<link rel="stylesheet" type="text/css" href="style.css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript" src="http://orgmode.org/mathjax/MathJax.js"></script>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
        //  config: ["MMLorHTML.js"], jax: ["input/TeX"],
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Advanced Binding Concepts</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Declarative binding</a>
<ul>
<li><a href="#sec-1-1">1.1. The example</a></li>
<li><a href="#sec-1-2">1.2. Automatic binding function</a></li>
</ul>
</li>
<li><a href="#sec-2">2. Shortcut: binding specification factories</a>
<ul>
<li><a href="#sec-2-1">2.1. The example</a></li>
<li><a href="#sec-2-2">2.2. Factory functions</a></li>
</ul>
</li>
<li><a href="#sec-3">3. Binding to variables</a>
<ul>
<li><a href="#sec-3-1">3.1. The example</a></li>
<li><a href="#sec-3-2">3.2. The Observer pattern</a></li>
<li><a href="#sec-3-3">3.3. The Observable pattern</a></li>
<li><a href="#sec-3-4">3.4. The <code>BasicObservable</code> type</a></li>
</ul>
</li>
<li><a href="#sec-4">4. Adapters and translators</a>
<ul>
<li><a href="#sec-4-1">4.1. The example</a></li>
<li><a href="#sec-4-2">4.2. View adapters</a></li>
<li><a href="#sec-4-3">4.3. Translators</a></li>
<li><a href="#sec-4-4">4.4. Connections</a></li>
</ul>
</li>
<li><a href="#sec-5">5. The <code>bind</code> function and binding descriptions</a>
<ul>
<li><a href="#sec-5-1">5.1. The example</a></li>
<li><a href="#sec-5-2">5.2. Translator factories</a></li>
<li><a href="#sec-5-3">5.3. Binding descriptions</a></li>
</ul>
</li>
<li><a href="#sec-6">6. Translators</a>
<ul>
<li><a href="#sec-6-1">6.1. The example</a></li>
<li><a href="#sec-6-2">6.2. What translators do</a></li>
<li><a href="#sec-6-3">6.3. Combining translators</a></li>
<li><a href="#sec-6-4">6.4. When translators fail</a></li>
<li><a href="#sec-6-5">6.5. List of translators</a></li>
</ul>
</li>
<li><a href="#sec-7">7. Creating translators from functions</a>
<ul>
<li><a href="#sec-7-1">7.1. The <code>fn</code> translator</a></li>
<li><a href="#sec-7-2">7.2. Extra function parameters</a></li>
</ul>
</li>
<li><a href="#sec-8">8. View adapters</a>
<ul>
<li><a href="#sec-8-1">8.1. The example</a></li>
<li><a href="#sec-8-2">8.2. What view adapters do</a></li>
<li><a href="#sec-8-3">8.3. List of adapters</a></li>
<li><a href="#sec-8-4">8.4. Factory functions</a></li>
<li><a href="#sec-8-5">8.5. List of factories</a></li>
</ul>
</li>
<li><a href="#sec-9">9. Binding to variable properties</a>
<ul>
<li><a href="#sec-9-1">9.1. Variable properties</a></li>
<li><a href="#sec-9-2">9.2. List of variable properties</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div style="border: 1px solid #600; background: #fee; color: #600; padding: 1em">
!!! This tutorial is still being updated for version 2.1.  Please check back later.
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Declarative binding</h2>
<div class="outline-text-2" id="text-1">
<p>
We return to the topic of binding, this time to see how we may embed binding
specifications into tags.  Doing so allows us to iterate over the DOM and
automatically perform any bindings we encounter.
</p>
</div>

<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> The example</h3>
<div class="outline-text-3" id="text-1-1">
<p>
This example uses no constraints; it simply illustrates a new binding
technique.  Editing the text boxes modifies the value displayed to the right.
</p>

<div class="results">
<div id="ex8">
  X: <input type="text" data-bind="{mkview: hd.Edit, model: x}"/>
           &rArr; <span data-bind="{mkview: hd.Text, model: x}"></span><br/>
  Y: <input type="text" data-bind="{mkview: hd.Edit, model: y, toModel: hd.toNum()}"/>
           &rArr; <span data-bind="{mkview: hd.Text, model: y}"></span>
</div>
</div>
<script type="text/javascript">
(function() {
var component = new hd.ComponentBuilder()
    .v( 'x', 'Hello, again!' ).v( 'y', 3 ).component();

var pm = new hd.PropertyModel();
pm.addComponent( component );
window.addEventListener( 'load', function() {
  hd.createDeclaredBindings( component, document.getElementById( 'ex8' ) );
} );
})();
</script>

<p>
<b>Source code</b>
</p>

<div class="org-src-container">
<label class="org-src-name"><i>View</i> (show/hide)</label>
<pre class="src src-html"><span class="linenr">1: </span>&lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"ex8"</span>&gt;
<span class="linenr">2: </span>  X: &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"{mkview: hd.Edit, model: x}"</span>/&gt;
<span class="linenr">3: </span>           <span style="color: #BA36A5;">&amp;rArr;</span> &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"{mkview: hd.Text, model: x}"</span>&gt;&lt;/<span style="color: #006699;">span</span>&gt;&lt;<span style="color: #006699;">br</span>/&gt;
<span class="linenr">4: </span>  Y: &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"{mkview: hd.Edit, model: y, toModel: hd.toNum()}"</span>/&gt;
<span class="linenr">5: </span>           <span style="color: #BA36A5;">&amp;rArr;</span> &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"{mkview: hd.Text, model: y}"</span>&gt;&lt;/<span style="color: #006699;">span</span>&gt;
<span class="linenr">6: </span>&lt;/<span style="color: #006699;">div</span>&gt;
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><i>View-Model</i> (show/hide)</label>
<pre class="src src-js"><span class="linenr">1: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">component</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.ComponentBuilder</span>()
<span class="linenr">2: </span>    .v( <span style="color: #008000;">'x'</span>, <span style="color: #008000;">'Hello, again!'</span> ).v( <span style="color: #008000;">'y'</span>, 3 ).component();
<span class="linenr">3: </span>
<span class="linenr">4: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">pm</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.PropertyModel</span>();
<span class="linenr">5: </span>pm.addComponent( component );
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><i>Binding</i> (show/hide)</label>
<pre class="src src-js"><span class="linenr">1: </span>window.addEventListener( <span style="color: #008000;">'load'</span>, <span style="color: #0000FF;">function</span>() {
<span class="linenr">2: </span>  hd.createDeclaredBindings( component, document.getElementById( <span style="color: #008000;">'ex8'</span> ) );
<span class="linenr">3: </span>} );
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> Automatic binding function</h3>
<div class="outline-text-3" id="text-1-2">
<p>
By now you've probably noticed that the binding section tends to be repetitive
and boring.  HotDrink offers two shortcuts to help alleviate this.  The first,
shown here, is allowing binding specifications to be embedded in the HTML.
There are two steps required for this.
</p>
</div>

<ol class="org-ol"><li><a id="sec-1-2-1"></a>Add binding specifications<br  /><div class="outline-text-4" id="text-1-2-1">
<p>
The first step is to add markup in the HTML to describe how elements should be
bound.  To indicate that you wish to bind a variable to the node for an HTML
tag, simply add a <code>data-bind</code> attribute to the tag with the code for the
binding specification.  At run-time, HotDrink will evaluate this attribute
string as JavaScript code to take the result as the binding specification
object.
</p>

<div class="org-src-container">

<pre class="src src-js" id="data-bind">  X: &lt;input type=<span style="color: #008000;">"text"</span> data-bind=<span style="color: #008000;">"{mkview: hd.Edit, model: x}"</span>/&gt;
</pre>
</div>

<p>
Note, however, one slight change to this binding specification.  In previous
examples our view object was a view adapter which encapsulated some DOM node
in the tree.  When you embed a binding specification in the HTML, HotDrink
assumes that a view adapter needs to be created for the DOM node.  Thus, it
looks for an attribute named "<code>mkview</code>".  This should be a constructor or
factory function which takes a single DOM node parameter.  HotDrink will use
this constructor or factory to create the view object, like so.
</p>

<div class="org-src-container">

<pre class="src src-js">specification.view = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">specification.mkview</span>( domNode );
</pre>
</div>

<p>
Also notice that, in the binding specification, you may refer to the variable
by it's name in the model.  For example, above we simply wrote <code>model: x</code>
instead of <code>model: component.x</code>.  When evaluating your binding specification,
HotDrink will first try to find any names in the component you provided to the
binding function (see below); if it cannot find it in the component, it will
treat the name as a global identifier.
</p>
</div>
</li>

<li><a id="sec-1-2-2"></a>Call the binding function<br  /><div class="outline-text-4" id="text-1-2-2">
<p>
The second step is to call the HotDrink function to performs the binding.  You
can do this as follows.
</p>

<div class="org-src-container">

<pre class="src src-js" id="bind">  hd.createDeclaredBindings( component, document.getElementById( <span style="color: #008000;">'ex8'</span> ) );
</pre>
</div>

<p>
This function takes two parameters: a model to use, and a DOM node at which to
start searching.  This function will search the DOM node passed to it and any
DOM nodes under it for elements with a <code>data-bind</code> attribute.  When it finds
one, it evaluate the binding specification as described above and then pass it
to <code>hd.createDeclaredBindings</code>.
</p>

<p>
In the example above, HotDrink would examine all tags contained by the <code>&lt;div&gt;</code>
tag which has the id ="ex8"=.  It would evaluate the binding specifications
for each of the four tags with <code>data-bind</code> attributes.  Then it will attempt
to bind according to each of those specifications.
</p>

<p>
The second parameter is optional; it defaults to <code>document.body</code> so that the
entire document will be searched.  Note, however, that this could cause
problems if you are binding different models to different parts of the
document (for example, as we are in this document).
</p>

<p>
As with manual binding, you must ensure that the nodes involved have been
added to the DOM <i>before</i> calling <code>createDeclaredBindings</code>; therefore, it is
advised to use the <code>window.onload</code> event or some alternative method of
executing code after the DOM is fully ready.
</p>
</div>
</li></ol>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Shortcut: binding specification factories</h2>
<div class="outline-text-2" id="text-2">
<p>
The binding specifications in a <code>data-bind</code> attribute are evaluated as JavaScript
code.  This means it can contain any JavaScript code which produces a binding
object.  Thus, HotDrink provides several factory functions that create common
binding specifications.
</p>
</div>

<div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> The example</h3>
<div class="outline-text-3" id="text-2-1">
<p>
This is the same as the previous example, except the binding specification
objects are created using factory functions.
</p>

<div class="results">
<div id="ex7">
  X: <input type="text" data-bind="hd.edit( x )"/>
           &rArr; <span data-bind="hd.text( x )"></span><br/>
  Y: <input type="text" data-bind="hd.num( y )"/>
           &rArr; <span data-bind="hd.text( y )"></span>
</div>
</div>
<script type="text/javascript">
(function() {
var component = new hd.ComponentBuilder()
    .v( 'x', 'Hello, again!' ).v( 'y', 3 ).component();

var pm = new hd.PropertyModel();
pm.addComponent( component );
window.addEventListener( 'load', function() {
  hd.createDeclaredBindings( component, document.getElementById( 'ex7' ) );
} );
})()
</script>

<div class="org-src-container">
<label class="org-src-name"><i>View</i> (show/hide)</label>
<pre class="src src-html"><span class="linenr">1: </span>&lt;<span style="color: #006699;">div</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"ex7"</span>&gt;
<span class="linenr">2: </span>  X: &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"hd.edit( x )"</span>/&gt;
<span class="linenr">3: </span>           <span style="color: #BA36A5;">&amp;rArr;</span> &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"hd.text( x )"</span>&gt;&lt;/<span style="color: #006699;">span</span>&gt;&lt;<span style="color: #006699;">br</span>/&gt;
<span class="linenr">4: </span>  Y: &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"hd.num( y )"</span>/&gt;
<span class="linenr">5: </span>           <span style="color: #BA36A5;">&amp;rArr;</span> &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"hd.text( y )"</span>&gt;&lt;/<span style="color: #006699;">span</span>&gt;
<span class="linenr">6: </span>&lt;/<span style="color: #006699;">div</span>&gt;
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><i>View-Model</i> (show/hide)</label>
<pre class="src src-js"><span class="linenr">1: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">component</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.ComponentBuilder</span>()
<span class="linenr">2: </span>    .v( <span style="color: #008000;">'x'</span>, <span style="color: #008000;">'Hello, again!'</span> ).v( <span style="color: #008000;">'y'</span>, 3 ).component();
<span class="linenr">3: </span>
<span class="linenr">4: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">pm</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.PropertyModel</span>();
<span class="linenr">5: </span>pm.addComponent( component );
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><i>Binding</i> (show/hide)</label>
<pre class="src src-js"><span class="linenr">1: </span>window.addEventListener( <span style="color: #008000;">'load'</span>, <span style="color: #0000FF;">function</span>() {
<span class="linenr">2: </span>  hd.createDeclaredBindings( component, document.getElementById( <span style="color: #008000;">'ex7'</span> ) );
<span class="linenr">3: </span>} );
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> Factory functions</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Binding specification objects tend to be lengthy and follow the same basic
patterns.  Since the <code>data-bind</code> attribute is simply evaluated as JavaScript
code, we can use any JavaScript code we want to create these objects&#x2014;e.g.,
call a factory function to create the object for us.
</p>

<p>
HotDrink provides several factory functions for creating these objects.  There
is nothing special about these factory functions, and you are encouraged to
make your own.  For example, the function <code>hd.edit</code> looks basically like the
following:
</p>

<div class="org-src-container">

<pre class="src src-js">hd.edit = <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">model</span>, <span style="color: #BA36A5;">toView</span>, <span style="color: #BA36A5;">toModel</span> ) {
  <span style="color: #0000FF;">return</span> {mkview:  hd.Edit,
          model:   model,
          toView:  toView,
          toModel: toModel
         };
}
</pre>
</div>

<p>
A full list of the factory functions can be found in the <a href="binding.html">Advanced Binding
Concepts</a> how-to, but for now we point out the following three:
</p>

<ol class="org-ol">
<li>The <code>hd.edit</code> factory creates the binding specification for a text edit
box.
</li>
<li>The <code>hd.num</code> factory also creates a specification for a text edit box,
but the value is converted to a number before passing it to the model.
Note that this factory takes a second optional argument which is used to
specify the number of digits after the decimal point.
</li>
<li>The <code>hd.text</code> factory creates the binding specification for replacing the
contents of a tag with the value of a variable.
</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Binding to variables</h2>
<div class="outline-text-2" id="text-3">
<p>
The previous example interacted with the property model using only the <code>get</code>
and <code>set</code> functions for variables.  In actuality, this is not the best way to
interact with variables of the property model because the property model
updates <i>asynchronously</i>.  This means that calling <code>pm.update()</code> does not
actually force the property model to update, but rather requests that it
update itself at the next available time.  Thus, you cannot be sure when a
variable's value will be updated.
</p>

<p>
A better way to interact with variables of the property model is by letting
them tell <i>you</i> when they have updated.  A variable has an event that is
triggered every time its value changes.  We can register a callback function
for this event so that we update the web page every time the variable changes.
Similarly, most HTML input elements have an event that is triggered every time
their value changes.  We can register a callback function for this event so
that every time its.  Together, these callback functions represent a
<i>binding</i>&#x2014;a connection between an element of the View and an element of the
View-Model.
</p>
</div>

<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> The example</h3>
<div class="outline-text-3" id="text-3-1">
<p>
This example is very similar to the previous:  a list of email addresses which
is filtered by a string.  The difference is in the way we interact with the
property model.  In this example, the <code>emails</code> and <code>filter</code> variables are
represented by text boxes: editing the text boxes changes the variables.
Also, the value of the <code>result</code> variable is shown in the web page and updated
automatically.
</p>

<div class="results">
<table>
  <style type="text/css" scoped>
    th { padding-right: 1ex; text-align: left; font-weight: bold; }
    input.long { width: 100ex; }
  </style>
  <tr>
    <th>Emails:</th>
    <td><input type="text" id="emailsEdit" class="long"/></td>
  </tr>
  <tr>
    <th>Filter:</th>
    <td><input type="text" id="filterEdit" class="long"/></td>
  </tr>
  <tr>
    <th>Result:</th>
    <td><span id="resultSpan"></span></td>
  </tr>
</table>
</div>
<script type="text/javascript">
(function() {
// Define the context
var context = new hd.ContextBuilder()
    .v( 'emails', 'joe@foo.com, sue@fum.edu, eve@foo.com, bob@baz.org' )
    .v( 'filter', 'foo.com' )
    .v( 'result' )

    .c( 'emails, filter, result' )
    .m( 'emails, filter -> result', function( emails, filter ) {
      var words = emails.trim().split( /\s*,\s*/ );
      var filteredWords = words.filter( function( word ) {
        return word.indexOf( filter ) > -1;
      } );
      return filteredWords.join( ', ' );
    } )

    .context();

// Create the property model
var pm = new hd.PropertyModel();
pm.addComponent( context );
// To be done when the document has loaded...
window.addEventListener( 'load', function() {
  // Initialize email text box with variable value
  var emailsEdit = document.getElementById( 'emailsEdit' );
  emailsEdit.value = context.emails.get();

  // Make an observable for every time the text box is edited
  var emailsObservable = new hd.BasicObservable();
  emailsEdit.addEventListener( 'input', function() {
    emailsObservable.sendNext( emailsEdit.value );
  } );

  // Subscribe the variable to the observable
  emailsObservable.addObserver( context.emails );

  // Initialize filter text box with variable value
  var filterEdit = document.getElementById( 'filterEdit' );
  filterEdit.value = context.filter.get();

  // Make an observable for every time the text box is edited
  var filterObservable = new hd.BasicObservable();
  filterEdit.addEventListener( 'input', function() {
    filterObservable.sendNext( filterEdit.value );
  } );

  // Subscribe the variable to the observable
  filterObservable.addObserver( context.filter );

  // An observer for the result variable
  var resultObserver = {
    onNext: function( v ) { setSpan( 'resultSpan', v ) },
    onError: function( e ) { },
    onCompleted: function() { }
  };

  // Subscribe the observer to the variable
  context.result.addObserver( resultObserver );
})();
</script>

<p>
<b>Source Code</b>
</p>

<p>
In this example we use HotDrink's binding interfaces, but write our own
binding objects.  In fact, HotDrink comes with several built-in binding
objects; however, writing our own makes it clear what is happening.
</p>

<p>
Note that the View-Model of this example is identical to the previous example;
only the View and Binding have changed.
</p>

<div class="org-src-container">
<label class="org-src-name"><i>View</i> (show/hide)</label>
<pre class="src src-html"><span class="linenr"> 1: </span>&lt;<span style="color: #006699;">table</span>&gt;
<span class="linenr"> 2: </span>  &lt;<span style="color: #006699;">style</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text/css"</span> scoped&gt;
<span class="linenr"> 3: </span>    th { padding-right: 1ex; text-align: left; font-weight: bold; }
<span class="linenr"> 4: </span>    input.long { width: 100ex; }
<span class="linenr"> 5: </span>  &lt;/<span style="color: #006699;">style</span>&gt;
<span class="linenr"> 6: </span>  &lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr"> 7: </span>    &lt;<span style="color: #006699;">th</span>&gt;Emails:&lt;/<span style="color: #006699;">th</span>&gt;
<span class="linenr"> 8: </span>    &lt;<span style="color: #006699;">td</span>&gt;&lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"emailsEdit"</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"long"</span>/&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr"> 9: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;
<span class="linenr">10: </span>  &lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">11: </span>    &lt;<span style="color: #006699;">th</span>&gt;Filter:&lt;/<span style="color: #006699;">th</span>&gt;
<span class="linenr">12: </span>    &lt;<span style="color: #006699;">td</span>&gt;&lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"filterEdit"</span> <span style="color: #BA36A5;">class</span>=<span style="color: #008000;">"long"</span>/&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">13: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;
<span class="linenr">14: </span>  &lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">15: </span>    &lt;<span style="color: #006699;">th</span>&gt;Result:&lt;/<span style="color: #006699;">th</span>&gt;
<span class="linenr">16: </span>    &lt;<span style="color: #006699;">td</span>&gt;&lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"resultSpan"</span>&gt;&lt;/<span style="color: #006699;">span</span>&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">17: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;
<span class="linenr">18: </span>&lt;/<span style="color: #006699;">table</span>&gt;
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><i>View-Model</i> (show/hide)</label>
<pre class="src src-js"><span class="linenr"> 1: </span><span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Define the context</span>
<span class="linenr"> 2: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">context</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.ContextBuilder</span>()
<span class="linenr"> 3: </span>    .v( <span style="color: #008000;">'emails'</span>, <span style="color: #008000;">'joe@foo.com, sue@fum.edu, eve@foo.com, bob@baz.org'</span> )
<span class="linenr"> 4: </span>    .v( <span style="color: #008000;">'filter'</span>, <span style="color: #008000;">'foo.com'</span> )
<span class="linenr"> 5: </span>    .v( <span style="color: #008000;">'result'</span> )
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span>    .c( <span style="color: #008000;">'emails, filter, result'</span> )
<span class="linenr"> 8: </span>    .m( <span style="color: #008000;">'emails, filter -&gt; result'</span>, <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">emails</span>, <span style="color: #BA36A5;">filter</span> ) {
<span class="linenr"> 9: </span>      <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">words</span> = emails.trim().split( <span style="color: #008000;">/\s*,\s*/</span> );
<span class="linenr">10: </span>      <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">filteredWords</span> = words.filter( <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">word</span> ) {
<span class="linenr">11: </span>        <span style="color: #0000FF;">return</span> word.indexOf( filter ) &gt; -1;
<span class="linenr">12: </span>      } );
<span class="linenr">13: </span>      <span style="color: #0000FF;">return</span> filteredWords.join( <span style="color: #008000;">', '</span> );
<span class="linenr">14: </span>    } )
<span class="linenr">15: </span>
<span class="linenr">16: </span>    .context();
<span class="linenr">17: </span>
<span class="linenr">18: </span><span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Create the property model</span>
<span class="linenr">19: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">pm</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.PropertyModel</span>();
<span class="linenr">20: </span>pm.addComponent( context );
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><i>Binding</i> (show/hide)</label>
<pre class="src src-js"><span class="linenr"> 1: </span><span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">To be done when the document has loaded...</span>
<span class="linenr"> 2: </span>window.addEventListener( <span style="color: #008000;">'load'</span>, <span style="color: #0000FF;">function</span>() {
<span class="linenr"> 3: </span>  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Initialize email text box with variable value</span>
<span class="linenr"> 4: </span>  <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">emailsEdit</span> = document.getElementById( <span style="color: #008000;">'emailsEdit'</span> );
<span class="linenr"> 5: </span>  emailsEdit.value = context.emails.get();
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span>  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Make an observable for every time the text box is edited</span>
<span class="linenr"> 8: </span>  <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">emailsObservable</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.BasicObservable</span>();
<span class="linenr"> 9: </span>  emailsEdit.addEventListener( <span style="color: #008000;">'input'</span>, <span style="color: #0000FF;">function</span>() {
<span class="linenr">10: </span>    emailsObservable.sendNext( emailsEdit.value );
<span class="linenr">11: </span>  } );
<span class="linenr">12: </span>
<span class="linenr">13: </span>  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Subscribe the variable to the observable</span>
<span class="linenr">14: </span>  emailsObservable.addObserver( context.emails );
<span class="linenr">15: </span>
<span class="linenr">16: </span>  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Initialize filter text box with variable value</span>
<span class="linenr">17: </span>  <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">filterEdit</span> = document.getElementById( <span style="color: #008000;">'filterEdit'</span> );
<span class="linenr">18: </span>  filterEdit.value = context.filter.get();
<span class="linenr">19: </span>
<span class="linenr">20: </span>  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Make an observable for every time the text box is edited</span>
<span class="linenr">21: </span>  <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">filterObservable</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.BasicObservable</span>();
<span class="linenr">22: </span>  filterEdit.addEventListener( <span style="color: #008000;">'input'</span>, <span style="color: #0000FF;">function</span>() {
<span class="linenr">23: </span>    filterObservable.sendNext( filterEdit.value );
<span class="linenr">24: </span>  } );
<span class="linenr">25: </span>
<span class="linenr">26: </span>  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Subscribe the variable to the observable</span>
<span class="linenr">27: </span>  filterObservable.addObserver( context.filter );
<span class="linenr">28: </span>
<span class="linenr">29: </span>  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">An observer for the result variable</span>
<span class="linenr">30: </span>  <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">resultObserver</span> = {
<span class="linenr">31: </span>    <span style="color: #006699;">onNext</span>: <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">v</span> ) { setSpan( <span style="color: #008000;">'resultSpan'</span>, v ) },
<span class="linenr">32: </span>    <span style="color: #006699;">onError</span>: <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">e</span> ) { },
<span class="linenr">33: </span>    <span style="color: #006699;">onCompleted</span>: <span style="color: #0000FF;">function</span>() { }
<span class="linenr">34: </span>  };
<span class="linenr">35: </span>
<span class="linenr">36: </span>  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Subscribe the observer to the variable</span>
<span class="linenr">37: </span>  context.result.addObserver( resultObserver );
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> The Observer pattern</h3>
<div class="outline-text-3" id="text-3-2">
<p>
You may have noticed that, in the previous example, we waited for the user to
click the &ldquo;Get Result&rdquo; button before reading the value of the <i>result</i>
variable.  That was done intentionally.  The reason is that property models
execute <i>asynchronously</i>.  This means that, when you update the property model
by calling <code>update</code>, it does not immediately do all the work of solving the
constraint system.  Instead, it does some of the work right away, and then
<i>schedules</i> the rest to be completed later.  The ability of a property model
to run asynchronously means it cooperates well with other asynchronous
programming techniques, such as Ajax calls and web workers.  However, it also
means that, had we tried to read the value of <code>result</code> immediately after
calling <code>update</code>, we would have read the old value of <code>result</code>.
</p>

<p>
Rather than asking the <code>result</code> variable for its value, the correct approach
is to ask it to tell us whenever a new value becomes available.  Typically we
might do this by registering a callback function to be executed as soon as the
value was ready.  This technique is sometimes known as the <i>observer pattern</i>
&#x2014; the observer provides a function, and the object being observed calls the
function whenever an event occurs.  In HotDrink, we use a variation of the
observer pattern inspired by Microsoft's <a href="https://rx.codeplex.com/">reactive extensions</a>.  In this
pattern, an observer has three associated callbacks: one to be called for
normal event values, one for erroneous event values, and one without a value
indicating that no more events will occur.  Thus, in HotDrink, an <i>observer</i>
is any object which has the following three properties:
</p>

<dl class="org-dl">
<dt><code>onNext( value )</code></dt><dd>function called on normal event; takes value associated
with the event
</dd>

<dt><code>onError( error )</code></dt><dd>function called when error occurs; takes value
associated with the error
</dd>

<dt><code>onCompleted()</code></dt><dd>function called when no more events can occur
</dd>
</dl>

<p>
It does not matter what type of object it is, nor what other properties it
has; only that it has these three properties.  Here's an example of an
observer for the result variable.  Whenever the variable takes a new value, it
will call <code>onNext</code>, which will update the web page with the new value.
</p>

<div class="org-src-container">

<pre class="src src-js" id="resultobserver">  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">An observer for the result variable</span>
  <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">resultObserver</span> = {
    <span style="color: #006699;">onNext</span>: <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">v</span> ) { setSpan( <span style="color: #008000;">'resultSpan'</span>, v ) },
    <span style="color: #006699;">onError</span>: <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">e</span> ) { },
    <span style="color: #006699;">onCompleted</span>: <span style="color: #0000FF;">function</span>() { }
  };
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> The Observable pattern</h3>
<div class="outline-text-3" id="text-3-3">
<p>
The counterpart to an observer is an <i>observable</i>.  An observable is an object
which publishes values an observer would want to know about.  An observer may
<i>subscribe</i> to an observable, in which case the observable will notify it of
each new value by calling the observer's <code>onNext</code> callback.  In HotDrink, an
observable is any object which has the following two properties:
</p>

<dl class="org-dl">
<dt><code>addObserver( observer )</code></dt><dd>Subscribe the observer to the observable so
that it will receive notifications
</dd>

<dt><code>removeObserver( observer )</code></dt><dd>Unsubsribe the observer so that it will no
longer receive notifiactions.
</dd>
</dl>

<p>
As you have probably guessed, variables of the property model are observable.
Thus, we may subscribe our observer to the result variable like so:
</p>

<div class="org-src-container">

<pre class="src src-js" id="addobserver">  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Subscribe the observer to the variable</span>
  context.result.addObserver( resultObserver );
</pre>
</div>

<p>
Now, as soon as the property model updates the result variable, our callback
will be executed and the web page will be updated.
</p>
</div>
</div>

<div id="outline-container-sec-3-4" class="outline-3">
<h3 id="sec-3-4"><span class="section-number-3">3.4</span> The <code>BasicObservable</code> type</h3>
<div class="outline-text-3" id="text-3-4">
<p>
Variables of the property model are not only observable, they are observers as
well.  When a variable observes some other observable, every value produced by
that observable is treated as a <code>set</code> of the variable.  (In fact, a variable's
<code>onNext</code> and <code>set</code> functions do the exact same thing.)  Thus, if we want
changes to a text box to be reflected in a variable of the property model, we
can create an observable that represents the value of the text box.
</p>

<p>
Creating an observable object is not hard, but it does tend to involve a lot
of boiler-plate code.  For this reason, HotDrink provides a simple
implementation of an observable object called <code>BasicObservable</code>.  You may
create instances of this type, or use it as a prototype for your own
JavaScript types.  A <code>BasicObservable</code> keeps a list of observers in a property
named <code>observers</code>.  It also provides three functions, <code>sendNext</code>, <code>sendError</code>,
and <code>sendCompleted</code>, for invoking callbacks of all subscribed observers.
</p>

<p>
The code below creates a <code>BasicObservable</code> to represent the text box for the
<code>email</code> variable.  An event listener is created for the text box so that every
time it is edited, the observable will notify any subscribers of the new
value.  Then we subscribe the <code>emails</code> variable to this new observable.  In
this way, any changes to the text box will be relayed to the variable.
</p>

<div class="org-src-container">

<pre class="src src-js" id="emailobservable">  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Initialize email text box with variable value</span>
  <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">emailsEdit</span> = document.getElementById( <span style="color: #008000;">'emailsEdit'</span> );
  emailsEdit.value = context.emails.get();

  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Make an observable for every time the text box is edited</span>
  <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">emailsObservable</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.BasicObservable</span>();
  emailsEdit.addEventListener( <span style="color: #008000;">'input'</span>, <span style="color: #0000FF;">function</span>() {
    emailsObservable.sendNext( emailsEdit.value );
  } );

  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Subscribe the variable to the observable</span>
  emailsObservable.addObserver( context.emails );
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Adapters and translators</h2>
<div class="outline-text-2" id="text-4">
<p>
If we were to combine the observable and observer objects of the previous
example, we would get a single object, both observable and an observer, which
representing a text edit box of the View: when the object observes a value, it
updates the text box to contain that value, and when the user edits the text
box, it notifies any observers with the new value.  This object is called a
<i>view adapter</i> because it converts the interface of the View&#x2014;i.e., an HTML
DOM node&#x2014;into the observable/observer interface used by HotDrink.
</p>

<p>
Often when a variable is bound to the view, the value contained in the View
will be slightly different than the value contained in the property model.  A
good example of this is a variable whose value is a number bound to a text box
whose value is a string.  While it is possible for an adapter to make such
data conversions, creating a separate object specifically to do this
conversion, called a <i>translator</i>, allows more flexibility by making it easy
to combine different adapters with different translators.
</p>
</div>

<div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> The example</h3>
<div class="outline-text-3" id="text-4-1">
<p>
This example also contains a single constraint.  This time, the constraint
represents the mathematical equation, \(income - expenses = profit\).  As with
the previous example, updating the text boxes will cause the result to update
automatically.
</p>

<p>
This example utilizes some new binding techniques, including the ability to
convert between string values in the View and numeric values in the View-Model.
</p>

<div class="results">
<table>
  <style type="text/css" scoped>
    th { padding-right: 1ex; text-align: left; font-weight: bold; }
  </style>
  <tr>
    <th>Income:</th>
    <td><input type="text" id="incomeEdit"/></td>
  </tr>
  <tr>
    <th>Expenses:</th>
    <td><input type="text" id="expensesEdit"/></td>
  </tr>
  <tr>
    <th>Profit:</th>
    <td><span id="profitSpan"></span></td>
  </tr>
</table>
</div>
<script type="text/javascript">
(function() {
// Define the context
var context = new hd.ContextBuilder()
    .v( 'income', 2000 )
    .v( 'expenses', 480 )
    .v( 'profit' )

    .c( 'income, expenses, profit' )
    .m( 'income, expenses -> profit', function( income, expenses ) {
      return income - expenses;
    } )

    .context();

// Create the constraint system
var pm = new hd.PropertyModel();
pm.addComponent( context );
// To be done when the document has loaded...
window.addEventListener( 'load', function() {

  // An adapter for the <input> element for income
  var incomeAdapter = new hd.Edit( document.getElementById( 'incomeEdit' ) );
  // A translator from string to number
  var incomeTranslator = new hd.Translator();
  incomeTranslator.onNext = stringToNumber;
  // Connect observables to observers
  incomeAdapter.addObserver( incomeTranslator );
  incomeTranslator.addObserver( context.income );
  context.income.addObserver( incomeAdapter );

  // An adapter for the <input> element for expenses
  var expensesAdapter = new hd.Edit( document.getElementById( 'expensesEdit' ) );
  // A translator from string to number
  var expensesTranslator = new hd.Translator();
  expensesTranslator.onNext = stringToNumber;
  // Connect observables to observers
  expensesTranslator.addObserver( context.expenses )
  expensesAdapter.addObserver( expensesTranslator );
  context.expenses.addObserver( expensesAdapter );

  // An adapter for the <span> element for profit
  var profitAdapter = new hd.Text( document.getElementById( 'profitSpan' ) );
  // A translator from number to string
  var profitTranslator = new hd.Translator();
  profitTranslator.onNext = fix2;
  // Connect observables to observers
  context.profit.addObserver( profitTranslator );
  profitTranslator.addObserver( profitAdapter );
} )

// Helper function for translator:  convert string to number
function stringToNumber( s ) {
  var n = Number( s );
  if (s == '' || isNaN( n )) {
    this.sendError( "Invalid number" );
  }
  else {
    this.sendNext( n );
  }
}

// Helper function for translator:  convert number to string
function fix2( n ) {
  this.sendNext( n.toFixed( 2 ) );
}
})();
</script>

<p>
<b>Source Code</b>
</p>

<div class="org-src-container">
<label class="org-src-name"><i>View</i> (show/hide)</label>
<pre class="src src-html"><span class="linenr"> 1: </span>&lt;<span style="color: #006699;">table</span>&gt;
<span class="linenr"> 2: </span>  &lt;<span style="color: #006699;">style</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text/css"</span> scoped&gt;
<span class="linenr"> 3: </span>    th { padding-right: 1ex; text-align: left; font-weight: bold; }
<span class="linenr"> 4: </span>  &lt;/<span style="color: #006699;">style</span>&gt;
<span class="linenr"> 5: </span>  &lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr"> 6: </span>    &lt;<span style="color: #006699;">th</span>&gt;Income:&lt;/<span style="color: #006699;">th</span>&gt;
<span class="linenr"> 7: </span>    &lt;<span style="color: #006699;">td</span>&gt;&lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"incomeEdit"</span>/&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr"> 8: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;
<span class="linenr"> 9: </span>  &lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">10: </span>    &lt;<span style="color: #006699;">th</span>&gt;Expenses:&lt;/<span style="color: #006699;">th</span>&gt;
<span class="linenr">11: </span>    &lt;<span style="color: #006699;">td</span>&gt;&lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"expensesEdit"</span>/&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">12: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;
<span class="linenr">13: </span>  &lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">14: </span>    &lt;<span style="color: #006699;">th</span>&gt;Profit:&lt;/<span style="color: #006699;">th</span>&gt;
<span class="linenr">15: </span>    &lt;<span style="color: #006699;">td</span>&gt;&lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"profitSpan"</span>&gt;&lt;/<span style="color: #006699;">span</span>&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">16: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;
<span class="linenr">17: </span>&lt;/<span style="color: #006699;">table</span>&gt;
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><i>View-Model</i> (show/hide)</label>
<pre class="src src-js"><span class="linenr"> 1: </span><span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Define the context</span>
<span class="linenr"> 2: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">context</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.ContextBuilder</span>()
<span class="linenr"> 3: </span>    .v( <span style="color: #008000;">'income'</span>, 2000 )
<span class="linenr"> 4: </span>    .v( <span style="color: #008000;">'expenses'</span>, 480 )
<span class="linenr"> 5: </span>    .v( <span style="color: #008000;">'profit'</span> )
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span>    .c( <span style="color: #008000;">'income, expenses, profit'</span> )
<span class="linenr"> 8: </span>    .m( <span style="color: #008000;">'income, expenses -&gt; profit'</span>, <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">income</span>, <span style="color: #BA36A5;">expenses</span> ) {
<span class="linenr"> 9: </span>      <span style="color: #0000FF;">return</span> income - expenses;
<span class="linenr">10: </span>    } )
<span class="linenr">11: </span>
<span class="linenr">12: </span>    .context();
<span class="linenr">13: </span>
<span class="linenr">14: </span><span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Create the constraint system</span>
<span class="linenr">15: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">pm</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.PropertyModel</span>();
<span class="linenr">16: </span>pm.addComponent( context );
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><i>Binding</i> (show/hide)</label>
<pre class="src src-js"><span class="linenr"> 1: </span><span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">To be done when the document has loaded...</span>
<span class="linenr"> 2: </span>window.addEventListener( <span style="color: #008000;">'load'</span>, <span style="color: #0000FF;">function</span>() {
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span>  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">An adapter for the &lt;input&gt; element for income</span>
<span class="linenr"> 5: </span>  <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">incomeAdapter</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Edit</span>( document.getElementById( <span style="color: #008000;">'incomeEdit'</span> ) );
<span class="linenr"> 6: </span>  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">A translator from string to number</span>
<span class="linenr"> 7: </span>  <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">incomeTranslator</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Translator</span>();
<span class="linenr"> 8: </span>  incomeTranslator.onNext = stringToNumber;
<span class="linenr"> 9: </span>  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Connect observables to observers</span>
<span class="linenr">10: </span>  incomeAdapter.addObserver( incomeTranslator );
<span class="linenr">11: </span>  incomeTranslator.addObserver( context.income );
<span class="linenr">12: </span>  context.income.addObserver( incomeAdapter );
<span class="linenr">13: </span>
<span class="linenr">14: </span>  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">An adapter for the &lt;input&gt; element for expenses</span>
<span class="linenr">15: </span>  <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">expensesAdapter</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Edit</span>( document.getElementById( <span style="color: #008000;">'expensesEdit'</span> ) );
<span class="linenr">16: </span>  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">A translator from string to number</span>
<span class="linenr">17: </span>  <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">expensesTranslator</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Translator</span>();
<span class="linenr">18: </span>  expensesTranslator.onNext = stringToNumber;
<span class="linenr">19: </span>  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Connect observables to observers</span>
<span class="linenr">20: </span>  expensesTranslator.addObserver( context.expenses )
<span class="linenr">21: </span>  expensesAdapter.addObserver( expensesTranslator );
<span class="linenr">22: </span>  context.expenses.addObserver( expensesAdapter );
<span class="linenr">23: </span>
<span class="linenr">24: </span>  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">An adapter for the &lt;span&gt; element for profit</span>
<span class="linenr">25: </span>  <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">profitAdapter</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Text</span>( document.getElementById( <span style="color: #008000;">'profitSpan'</span> ) );
<span class="linenr">26: </span>  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">A translator from number to string</span>
<span class="linenr">27: </span>  <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">profitTranslator</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Translator</span>();
<span class="linenr">28: </span>  profitTranslator.onNext = fix2;
<span class="linenr">29: </span>  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Connect observables to observers</span>
<span class="linenr">30: </span>  context.profit.addObserver( profitTranslator );
<span class="linenr">31: </span>  profitTranslator.addObserver( profitAdapter );
<span class="linenr">32: </span>} )
<span class="linenr">33: </span>
<span class="linenr">34: </span><span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Helper function for translator:  convert string to number</span>
<span class="linenr">35: </span><span style="color: #0000FF;">function</span> <span style="color: #006699;">stringToNumber</span>( <span style="color: #BA36A5;">s</span> ) {
<span class="linenr">36: </span>  <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">n</span> = Number( s );
<span class="linenr">37: </span>  <span style="color: #0000FF;">if</span> (s == <span style="color: #008000;">''</span> || isNaN( n )) {
<span class="linenr">38: </span>    <span style="color: #8b1a1a;">this</span>.sendError( <span style="color: #008000;">"Invalid number"</span> );
<span class="linenr">39: </span>  }
<span class="linenr">40: </span>  <span style="color: #0000FF;">else</span> {
<span class="linenr">41: </span>    <span style="color: #8b1a1a;">this</span>.sendNext( n );
<span class="linenr">42: </span>  }
<span class="linenr">43: </span>}
<span class="linenr">44: </span>
<span class="linenr">45: </span><span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Helper function for translator:  convert number to string</span>
<span class="linenr">46: </span><span style="color: #0000FF;">function</span> <span style="color: #006699;">fix2</span>( <span style="color: #BA36A5;">n</span> ) {
<span class="linenr">47: </span>  <span style="color: #8b1a1a;">this</span>.sendNext( n.toFixed( 2 ) );
<span class="linenr">48: </span>}
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> View adapters</h3>
<div class="outline-text-3" id="text-4-2">
<p>
A <i>view adapter</i> is an object which represents some element of the view which
can be bound to a property model.  It is called an <i>adapter</i> because it adapts
the view element's interface to the observable/observer interface expected by
HotDrink.  A view adapter may be read-only (i.e., observable-only), read-write
(i.e., observable-observer), or write-only (i.e., observer-only).  For
example, an adapter for the mouse cursor position would be read-only; an
adapter for a text box would be read-write; and an adapter for a &lt;span&gt; tag
would be write-only.
</p>

<p>
HotDrink provides several types of view adapters for common input elements.
We describe them in detail in the <a href="binding.html">Advanced Binding Concepts</a> how-to.  For now,
however, we introduce two adapters for use in the remainder of this how-to.
</p>

<p>
The first adapter type is the <code>Edit</code> adapter: a read-write adapter that
represents the value of a text box.  As an observable, the <code>Edit</code> adapter
reports every time the value of the text box changes.  As an observer, the
<code>Edit</code> adapter updates the value of the text box every time the value of the
variable being observed changes.  To create an <code>Edit</code> adapter, simply create a
new <code>hd.Edit</code> object passing the DOM node for the text box to the constructor.
</p>

<div class="org-src-container">

<pre class="src src-js" id="edit-adapter">  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">An adapter for the &lt;input&gt; element for income</span>
  <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">incomeAdapter</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Edit</span>( document.getElementById( <span style="color: #008000;">'incomeEdit'</span> ) );
</pre>
</div>

<p>
Adapters can be creative in the way they choose to read or write values.  For
example, the <code>Edit</code> adapter does not report a new value with every keystroke;
it waits for either a half-second pause in the typing, or for an event that
indicates that the edit is complete, such as the user pressing the Enter key
or the text box losing focus.  Furthermore, if the adapter receives a new
value while the user is editing, the adapter waits until the text box loses
focus before updating its value.
</p>

<p>
The second adapter type is the <code>Text</code> adapter: a read-only adapter that
represents the text contents of a tag.  As an observer, the <code>Text</code> adapter
update the contents of its tag every time the value of the variable being
observed changes.  To create a <code>Text</code> adapter, simply create a new <code>hd.Text</code>
object passing the DOM node for the tag to the constructor.
</p>

<div class="org-src-container">

<pre class="src src-js" id="text-adapter">  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">An adapter for the &lt;span&gt; element for profit</span>
  <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">profitAdapter</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Text</span>( document.getElementById( <span style="color: #008000;">'profitSpan'</span> ) );
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> Translators</h3>
<div class="outline-text-3" id="text-4-3">
<p>
The purpose of a translator is to convert a value between the format expected
by the View to the format expected by the View-Model.  A translator is both an
observable and an observer:  it observes the value of the View (or View-Model)
and produces a value for the View-Model (or the View).
</p>

<p>
Creating a translator is not hard, but it does tend to involve a lot of
boiler-plate code.  For this reason, HotDrink provides a simple implementation
of a translator called <code>Translator</code>.  You may create instances of this type,
or use it as a prototype for your own JavaScript types.  As it is written,
this translator performs no translation; it simply takes the value it was
given and passes it on.  However, by assigning the translator a new <code>onNext</code>
method, we can cause it to modify the values it is given.
</p>

<div class="org-src-container">

<pre class="src src-js" id="number-translator">  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">A translator from string to number</span>
  <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">incomeTranslator</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Translator</span>();
  incomeTranslator.onNext = stringToNumber;
</pre>
</div>

<p>
The prototype for the <code>Translator</code> type is a <code>BasicObservable</code>.  Thus, after
you have translated your value, you can use <code>sendNext</code> to pass on the
translated value.  Alternatively, you can use <code>sendError</code> to signal an error.
</p>

<div class="org-src-container">

<pre class="src src-js" id="string-to-number"><span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Helper function for translator:  convert string to number</span>
<span style="color: #0000FF;">function</span> <span style="color: #006699;">stringToNumber</span>( <span style="color: #BA36A5;">s</span> ) {
  <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">n</span> = Number( s );
  <span style="color: #0000FF;">if</span> (s == <span style="color: #008000;">''</span> || isNaN( n )) {
    <span style="color: #8b1a1a;">this</span>.sendError( <span style="color: #008000;">"Invalid number"</span> );
  }
  <span style="color: #0000FF;">else</span> {
    <span style="color: #8b1a1a;">this</span>.sendNext( n );
  }
}
</pre>
</div>

<p>
Note that, while we could create an adapter to convert the number of the
View-Model to a string for the View, it is not strictly necessary.  JavaScript
will automatically convert our number to a string using <code>toString</code> when it is
assigned as the value of a text box.  This is sufficient for our text boxes.
However, in the case of our <code>&lt;span&gt;</code> tag, we would prefer to use
<code>toFixedString</code> instead.  Thus, we define a translator for this tag.
</p>

<div class="org-src-container">

<pre class="src src-js" id="fixed-translator">  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">A translator from number to string</span>
  <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">profitTranslator</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Translator</span>();
  profitTranslator.onNext = fix2;
</pre>
</div>
<div class="org-src-container">

<pre class="src src-js" id="fix2"><span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Helper function for translator:  convert number to string</span>
<span style="color: #0000FF;">function</span> <span style="color: #006699;">fix2</span>( <span style="color: #BA36A5;">n</span> ) {
  <span style="color: #8b1a1a;">this</span>.sendNext( n.toFixed( 2 ) );
}
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4-4" class="outline-3">
<h3 id="sec-4-4"><span class="section-number-3">4.4</span> Connections</h3>
<div class="outline-text-3" id="text-4-4">
<p>
Once we have created an adapter and translator, all that is left is to connect
them by subscribing observers to observables.  To support values going from
the View to the View-Model, the translator subscribes to the adapter, and the
variable subscribes to the translator.  To support values going from the
View-Model to the View, the adapter subscribes directly to the variable.
</p>

<div class="org-src-container">

<pre class="src src-js" id="connections">  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Connect observables to observers</span>
  incomeAdapter.addObserver( incomeTranslator );
  incomeTranslator.addObserver( context.income );
  context.income.addObserver( incomeAdapter );
</pre>
</div>

<p>
At this point, the variable is bound to the View.  Any changes to the variable
will go directly to the View.  Any changes to the View will first go through
the translator, then to the variable.
</p>

<p>
Note that it is <i>not</i> possible to reuse translators.  If you were to try, you
would have to subscribe the same translator to two view adapters, and two
variables to the same translator.  This would mean that every time either view
adapter sent a value, <i>both</i> variables would receive the value.  Thus, e.g.,
we must create a second string-to-number translator for the <code>expenses</code>
variable; we cannot reuse the one for <code>income</code>.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> The <code>bind</code> function and binding descriptions</h2>
<div class="outline-text-2" id="text-5">
<p>
The code required to connect adapters, translators, and variables tends to be
somewhat repetitive.  To help avoid boilerplate code, HotDrink provides the
<code>bind</code> function which can make these connections for you.
</p>
</div>

<div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> The example</h3>
<div class="outline-text-3" id="text-5-1">
<p>
This example also contains a single constraint.  This time the constraint
represents the mathematical equation \(subtotal*(1+tax/100)=total\).  As with
previous examples, updating the text box will cause the result to update
automatically.
</p>

<p>
This example performs all binding using the <code>bind</code> function with built-in
adapters and translators.
</p>

<div class="results">
<table>
  <style type="text/css" scoped>
    th { padding-right: 1ex; text-align: left; font-weight: bold; }
  </style>
  <tr>
    <th>Subtotal:</th>
    <td><input type="text" id="subtotalEdit"/></td>
  </tr>
  <tr>
    <th>Tax:</th>
    <td><input type="text" id="taxEdit"/>%</td>
  </tr>
  <tr>
    <th>Total:</th>
    <td>$<span id="totalSpan"></span></td>
  </tr>
</table>
</div>
<script type="text/javascript">
(function() {
// Define the context
var context = new hd.ContextBuilder()
    .v( 'subtotal', 39.99 )
    .v( 'tax', 8 )
    .v( 'total' )

    .c( 'subtotal, tax, total' )
    .m( 'subtotal, tax -> total', function( subtotal, tax ) {
      return Math.round( subtotal * (100+tax) ) / 100;
    } )

    .context();

// Create the constraint system
var pm = new hd.PropertyModel();
pm.addComponent( context );
window.addEventListener( 'load', function() {
  hd.bind( {view:    new hd.Edit( document.getElementById( 'subtotalEdit' ) ),
            model:   context.subtotal,
            toModel: [hd.toNum(), hd.round( 2 )],
            toView:  hd.fix( 2 )
           }
         );
  hd.bind( {view:    new hd.Edit( document.getElementById( 'taxEdit' ) ),
            model:   context.tax,
            toModel: [hd.toNum(), hd.round( 0 )],
            toView:  hd.fix( 0 )
           }
         );
  hd.bind( {view:    new hd.Text( document.getElementById( 'totalSpan' ) ),
            model:   context.total,
            toModel: hd.fix( 2 )
           }
         );
} );
})();
</script>

<p>
<b>Source Code</b>
</p>

<div class="org-src-container">
<label class="org-src-name"><i>View</i> (show/hide)</label>
<pre class="src src-html"><span class="linenr"> 1: </span>&lt;<span style="color: #006699;">table</span>&gt;
<span class="linenr"> 2: </span>  &lt;<span style="color: #006699;">style</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text/css"</span> scoped&gt;
<span class="linenr"> 3: </span>    th { padding-right: 1ex; text-align: left; font-weight: bold; }
<span class="linenr"> 4: </span>  &lt;/<span style="color: #006699;">style</span>&gt;
<span class="linenr"> 5: </span>  &lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr"> 6: </span>    &lt;<span style="color: #006699;">th</span>&gt;Subtotal:&lt;/<span style="color: #006699;">th</span>&gt;
<span class="linenr"> 7: </span>    &lt;<span style="color: #006699;">td</span>&gt;&lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"subtotalEdit"</span>/&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr"> 8: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;
<span class="linenr"> 9: </span>  &lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">10: </span>    &lt;<span style="color: #006699;">th</span>&gt;Tax:&lt;/<span style="color: #006699;">th</span>&gt;
<span class="linenr">11: </span>    &lt;<span style="color: #006699;">td</span>&gt;&lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"taxEdit"</span>/&gt;%&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">12: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;
<span class="linenr">13: </span>  &lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">14: </span>    &lt;<span style="color: #006699;">th</span>&gt;Total:&lt;/<span style="color: #006699;">th</span>&gt;
<span class="linenr">15: </span>    &lt;<span style="color: #006699;">td</span>&gt;$&lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"totalSpan"</span>&gt;&lt;/<span style="color: #006699;">span</span>&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">16: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;
<span class="linenr">17: </span>&lt;/<span style="color: #006699;">table</span>&gt;
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><i>View-Model</i> (show/hide)</label>
<pre class="src src-js"><span class="linenr"> 1: </span><span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Define the context</span>
<span class="linenr"> 2: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">context</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.ContextBuilder</span>()
<span class="linenr"> 3: </span>    .v( <span style="color: #008000;">'subtotal'</span>, 39.99 )
<span class="linenr"> 4: </span>    .v( <span style="color: #008000;">'tax'</span>, 8 )
<span class="linenr"> 5: </span>    .v( <span style="color: #008000;">'total'</span> )
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span>    .c( <span style="color: #008000;">'subtotal, tax, total'</span> )
<span class="linenr"> 8: </span>    .m( <span style="color: #008000;">'subtotal, tax -&gt; total'</span>, <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">subtotal</span>, <span style="color: #BA36A5;">tax</span> ) {
<span class="linenr"> 9: </span>      <span style="color: #0000FF;">return</span> Math.round( subtotal * (100+tax) ) / 100;
<span class="linenr">10: </span>    } )
<span class="linenr">11: </span>
<span class="linenr">12: </span>    .context();
<span class="linenr">13: </span>
<span class="linenr">14: </span><span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Create the constraint system</span>
<span class="linenr">15: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">pm</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.PropertyModel</span>();
<span class="linenr">16: </span>pm.addComponent( context );
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><i>Binding</i> (show/hide)</label>
<pre class="src src-js"><span class="linenr"> 1: </span>window.addEventListener( <span style="color: #008000;">'load'</span>, <span style="color: #0000FF;">function</span>() {
<span class="linenr"> 2: </span>  hd.bind( {view:    <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Edit</span>( document.getElementById( <span style="color: #008000;">'subtotalEdit'</span> ) ),
<span class="linenr"> 3: </span>            model:   context.subtotal,
<span class="linenr"> 4: </span>            toModel: [hd.toNum(), hd.round( 2 )],
<span class="linenr"> 5: </span>            toView:  hd.fix( 2 )
<span class="linenr"> 6: </span>           }
<span class="linenr"> 7: </span>         );
<span class="linenr"> 8: </span>  hd.bind( {view:    <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Edit</span>( document.getElementById( <span style="color: #008000;">'taxEdit'</span> ) ),
<span class="linenr"> 9: </span>            model:   context.tax,
<span class="linenr">10: </span>            toModel: [hd.toNum(), hd.round( 0 )],
<span class="linenr">11: </span>            toView:  hd.fix( 0 )
<span class="linenr">12: </span>           }
<span class="linenr">13: </span>         );
<span class="linenr">14: </span>  hd.bind( {view:    <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Text</span>( document.getElementById( <span style="color: #008000;">'totalSpan'</span> ) ),
<span class="linenr">15: </span>            model:   context.total,
<span class="linenr">16: </span>            toModel: hd.fix( 2 )
<span class="linenr">17: </span>           }
<span class="linenr">18: </span>         );
<span class="linenr">19: </span>} );
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> Translator factories</h3>
<div class="outline-text-3" id="text-5-2">
<p>
Just as HotDrink provides several common adapter types, so too it provides
several common translator types.  While it is possible to create instances of
these types yourself using the <code>new</code> operator, HotDrink provides factory
functions for creating new instances of these translator types.  We describe
these functions in detail in the <a href="binding.html">Advanced Binding Concepts</a> how-to.  For now,
however, we introduce three translators for use in the remainder of this
how-to.
</p>

<p>
The <code>hd.toNum</code> factory function creates a translator that converts a string to
a number, just like the translators created in the previous example.
</p>

<div class="org-src-container">

<pre class="src src-js">  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Using built-in translator</span>
  <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">toNumTranslator</span> = hd.toNum();
</pre>
</div>

<p>
The <code>hd.fix</code> factory function creates a translator that converts a number to a
string.  This factory function takes a parameter indicating how many digits
should be present after the decimal point.
</p>

<div class="org-src-container">

<pre class="src src-js">  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Using built-in translator</span>
  <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">fix2Translator</span> = hd.fix( 2 );
</pre>
</div>

<p>
Note that using a <code>hd.fix</code> translator only modifies how the value is <i>seen</i> by
the View; it does not change the value in the View-Model.  For example, if a
variable was connected to an <code>Edit</code> adapter using the above translator, the
user could enter as many digits of precision as he desired; the extra digits
would be stored in the View-Model, but would not be displayed by the View.
</p>

<p>
We can improve this scheme by changing the value which is given to the
View-Model using the <code>hd.round</code> translator.  This translator takes a number
and rounds it to a certain number of digits of precision.
</p>

<div class="org-src-container">

<pre class="src src-js">  <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">A rounding translator</span>
  <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">roundTranslator</span> = hd.round( 2 );
</pre>
</div>

<p>
Note that this translator does <i>not</i> change the data-type of a value; instead
it modifies the value.  If a change in data-type is required, this translator
can be used in conjunction with another, such as <code>hd.toNum</code>.  We demonstrate
this below.
</p>
</div>
</div>


<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3"><span class="section-number-3">5.3</span> Binding descriptions</h3>
<div class="outline-text-3" id="text-5-3">
<p>
The function <code>hd.bind</code> takes a single parameter: an object referred to as the
<i>binding description</i>.  A binding description is any object which has the
following four properties:
</p>

<dl class="org-dl">
<dt><code>view</code></dt><dd>observable/observer representing a value of the View
</dd>
<dt><code>model</code></dt><dd>observable/observer representing a value of the View-Model
</dd>
<dt><code>toView</code></dt><dd>translator(s) for going from View-Model to View
</dd>
<dt><code>toModel</code></dt><dd>translator(s) for going from View to View-Model
</dd>
</dl>

<p>
The <code>toView</code> and <code>toModel</code> properties are optional; the only required
properties are <code>view</code> and <code>model</code>.  If present, the <code>toView</code> and <code>toModel</code>
properties should hold either a single translator, or an array of
translators.  Consider, for example, the binding description in the following
call to <code>hd.bind</code>.
</p>

<div class="org-src-container">

<pre class="src src-js" id="binding-description">  hd.bind( {view:    <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Edit</span>( document.getElementById( <span style="color: #008000;">'subtotalEdit'</span> ) ),
            model:   context.subtotal,
            toModel: [hd.toNum(), hd.round( 2 )],
            toView:  hd.fix( 2 )
           }
         );
</pre>
</div>

<p>
Here, the <i>view</i> object is an <code>Edit</code> view adapter, and the <i>model</i> object is
the <code>subtotal</code> variable.  When going from the View to the View-Model, we first
translate the string to a number, then round the number to two digits.  Going
the other way, we convert the number to a fixed-point string with two digits
of precision.
</p>
</div>
</div>
</div>


<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Translators</h2>
<div class="outline-text-2" id="text-6">
</div><div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1"><span class="section-number-3">6.1</span> The example</h3>
<div class="outline-text-3" id="text-6-1">
<p>
This example uses several different translators to convert between the values
edited by the user in the text box and the values stored in the view-model.
The text next to the edit boxes is meant to give a better view of what is
actually stored in the model.
</p>

<div class="results">
<div>
  <input type="text" id="a_edit"/> &rArr; <span id="a_view"></span><br/>
  <input type="text" id="b_edit"/> &rArr; <span id="b_view"></span><br/>
  <input type="text" id="c_edit"/> &rArr; <span id="c_view"></span><br/>
  <input type="text" id="d_edit"/> &rArr; <span id="d_view"></span><br/>
  <input type="text" id="e_edit"/> &rArr; <span id="e_view"></span><br/>
  <input type="text" id="f_edit"/> &rArr; <span id="f_view"></span><br/>
  <input type="text" id="g_edit"/> &rArr; <span id="g_err" style="color:red"></span><br/>
</div>
</div>
<script type="text/javascript">
(function () {
var context = new hd.ContextBuilder()
    .v( 'a', 3.14159 )
    .v( 'b', 0.15 )
    .v( 'c', new Date() )
    .v( 'd', new Date().getTime() )
    .v( 'e', 'John Doe' )
    .v( 'f', 7 )
    .v( 'g', 'delete me' )
    .context();

var pm = new hd.PropertyModel();
pm.addComponent( context );
pm.update();
window.addEventListener( 'load', function() {
  hd.bind( {view: new hd.Edit( document.getElementById( 'a_edit' ) ),
            model: context.a,
            toModel: hd.toNum(),
            toView: hd.fix( 2 )
           }
         );

  hd.bind( {view: new hd.Text( document.getElementById( 'a_view' ) ),
            model: context.a
           }
         );

  hd.bind( {view: new hd.Edit( document.getElementById( 'b_edit' ) ),
            model: context.b,
            toModel: hd.chain( hd.toNum(),
                               hd.round( 0 ),
                               hd.scale( 0.01 ) ),
            toView: hd.chain( hd.scale( 100 ),
                              hd.fix( 0 )      ),
           }
         );

  hd.bind( {view: new hd.Text( document.getElementById( 'b_view' ) ),
            model: context.b
           } );

  hd.bind( {view: new hd.Edit( document.getElementById( 'c_edit' ) ),
            model: context.c,
            toModel: hd.toDate(),
            toView: hd.dateToString()
           }
         );

  hd.bind( {view: new hd.Text( document.getElementById( 'c_view' ) ),
            model: context.c
           }
         );

  hd.bind( {view: new hd.Edit( document.getElementById( 'd_edit' ) ),
            model: context.d,
            toModel: [hd.toDate(), hd.dateToMilliseconds()],
            toView: [hd.toDate(), hd.dateToDateString()]
           }
         );

  hd.bind( {view: new hd.Text( document.getElementById( 'd_view' ) ),
            model: context.d
           }
         );

  hd.bind( {view: new hd.Edit( document.getElementById( 'e_edit' ) ),
            model: context.e,
            toModel: hd.def( 'Unknown' )
           }
         );

  hd.bind( {view: new hd.Text( document.getElementById( 'e_view' ) ),
            model: context.e
           }
         );

  hd.bind( {view: new hd.Edit( document.getElementById( 'f_edit' ) ),
            model: context.f,
            toModel: [hd.toNum(), hd.def( 1 )]
           }
         );

  hd.bind( {view: new hd.Text( document.getElementById( 'f_view' ) ),
            model: context.f
           }
         );

  hd.bind( {view: new hd.Edit( document.getElementById( 'g_edit' ) ),
            model: context.g,
            toModel: [hd.req(), hd.msg( "Don't forget me!" )]
           }
         );

  hd.bind( {view: new hd.Text( document.getElementById( 'g_err' ) ),
            model: context.g.error
           }
         );
} );
})();
</script>

<p>
<b>Source Code</b>
</p>

<div class="org-src-container">
<label class="org-src-name"><i>View</i> (show/hide)</label>
<pre class="src src-html"><span class="linenr">1: </span>&lt;<span style="color: #006699;">div</span>&gt;
<span class="linenr">2: </span>  &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"a_edit"</span>/&gt; <span style="color: #BA36A5;">&amp;rArr;</span> &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"a_view"</span>&gt;&lt;/<span style="color: #006699;">span</span>&gt;&lt;<span style="color: #006699;">br</span>/&gt;
<span class="linenr">3: </span>  &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"b_edit"</span>/&gt; <span style="color: #BA36A5;">&amp;rArr;</span> &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"b_view"</span>&gt;&lt;/<span style="color: #006699;">span</span>&gt;&lt;<span style="color: #006699;">br</span>/&gt;
<span class="linenr">4: </span>  &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"c_edit"</span>/&gt; <span style="color: #BA36A5;">&amp;rArr;</span> &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"c_view"</span>&gt;&lt;/<span style="color: #006699;">span</span>&gt;&lt;<span style="color: #006699;">br</span>/&gt;
<span class="linenr">5: </span>  &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"d_edit"</span>/&gt; <span style="color: #BA36A5;">&amp;rArr;</span> &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"d_view"</span>&gt;&lt;/<span style="color: #006699;">span</span>&gt;&lt;<span style="color: #006699;">br</span>/&gt;
<span class="linenr">6: </span>  &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"e_edit"</span>/&gt; <span style="color: #BA36A5;">&amp;rArr;</span> &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"e_view"</span>&gt;&lt;/<span style="color: #006699;">span</span>&gt;&lt;<span style="color: #006699;">br</span>/&gt;
<span class="linenr">7: </span>  &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"f_edit"</span>/&gt; <span style="color: #BA36A5;">&amp;rArr;</span> &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"f_view"</span>&gt;&lt;/<span style="color: #006699;">span</span>&gt;&lt;<span style="color: #006699;">br</span>/&gt;
<span class="linenr">8: </span>  &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"g_edit"</span>/&gt; <span style="color: #BA36A5;">&amp;rArr;</span> &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"g_err"</span> <span style="color: #BA36A5;">style</span>=<span style="color: #008000;">"color:red"</span>&gt;&lt;/<span style="color: #006699;">span</span>&gt;&lt;<span style="color: #006699;">br</span>/&gt;
<span class="linenr">9: </span>&lt;/<span style="color: #006699;">div</span>&gt;
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><i>View-Model</i> (show/hide)</label>
<pre class="src src-js"><span class="linenr"> 1: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">context</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.ContextBuilder</span>()
<span class="linenr"> 2: </span>    .v( <span style="color: #008000;">'a'</span>, 3.14159 )
<span class="linenr"> 3: </span>    .v( <span style="color: #008000;">'b'</span>, 0.15 )
<span class="linenr"> 4: </span>    .v( <span style="color: #008000;">'c'</span>, <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">Date</span>() )
<span class="linenr"> 5: </span>    .v( <span style="color: #008000;">'d'</span>, <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">Date</span>().getTime() )
<span class="linenr"> 6: </span>    .v( <span style="color: #008000;">'e'</span>, <span style="color: #008000;">'John Doe'</span> )
<span class="linenr"> 7: </span>    .v( <span style="color: #008000;">'f'</span>, 7 )
<span class="linenr"> 8: </span>    .v( <span style="color: #008000;">'g'</span>, <span style="color: #008000;">'delete me'</span> )
<span class="linenr"> 9: </span>    .context();
<span class="linenr">10: </span>
<span class="linenr">11: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">pm</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.PropertyModel</span>();
<span class="linenr">12: </span>pm.addComponent( context );
<span class="linenr">13: </span>pm.update();
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><i>Model</i> (show/hide)</label>
<pre class="src src-js"><span class="linenr"> 1: </span>window.addEventListener( <span style="color: #008000;">'load'</span>, <span style="color: #0000FF;">function</span>() {
<span class="linenr"> 2: </span>  hd.bind( {view: <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Edit</span>( document.getElementById( <span style="color: #008000;">'a_edit'</span> ) ),
<span class="linenr"> 3: </span>            model: context.a,
<span class="linenr"> 4: </span>            toModel: hd.toNum(),
<span class="linenr"> 5: </span>            toView: hd.fix( 2 )
<span class="linenr"> 6: </span>           }
<span class="linenr"> 7: </span>         );
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span>  hd.bind( {view: <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Text</span>( document.getElementById( <span style="color: #008000;">'a_view'</span> ) ),
<span class="linenr">10: </span>            model: context.a
<span class="linenr">11: </span>           }
<span class="linenr">12: </span>         );
<span class="linenr">13: </span>
<span class="linenr">14: </span>  hd.bind( {view: <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Edit</span>( document.getElementById( <span style="color: #008000;">'b_edit'</span> ) ),
<span class="linenr">15: </span>            model: context.b,
<span class="linenr">16: </span>            toModel: hd.chain( hd.toNum(),
<span class="linenr">17: </span>                               hd.round( 0 ),
<span class="linenr">18: </span>                               hd.scale( 0.01 ) ),
<span class="linenr">19: </span>            toView: hd.chain( hd.scale( 100 ),
<span class="linenr">20: </span>                              hd.fix( 0 )      ),
<span class="linenr">21: </span>           }
<span class="linenr">22: </span>         );
<span class="linenr">23: </span>
<span class="linenr">24: </span>  hd.bind( {view: <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Text</span>( document.getElementById( <span style="color: #008000;">'b_view'</span> ) ),
<span class="linenr">25: </span>            model: context.b
<span class="linenr">26: </span>           } );
<span class="linenr">27: </span>
<span class="linenr">28: </span>  hd.bind( {view: <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Edit</span>( document.getElementById( <span style="color: #008000;">'c_edit'</span> ) ),
<span class="linenr">29: </span>            model: context.c,
<span class="linenr">30: </span>            toModel: hd.toDate(),
<span class="linenr">31: </span>            toView: hd.dateToString()
<span class="linenr">32: </span>           }
<span class="linenr">33: </span>         );
<span class="linenr">34: </span>
<span class="linenr">35: </span>  hd.bind( {view: <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Text</span>( document.getElementById( <span style="color: #008000;">'c_view'</span> ) ),
<span class="linenr">36: </span>            model: context.c
<span class="linenr">37: </span>           }
<span class="linenr">38: </span>         );
<span class="linenr">39: </span>
<span class="linenr">40: </span>  hd.bind( {view: <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Edit</span>( document.getElementById( <span style="color: #008000;">'d_edit'</span> ) ),
<span class="linenr">41: </span>            model: context.d,
<span class="linenr">42: </span>            toModel: [hd.toDate(), hd.dateToMilliseconds()],
<span class="linenr">43: </span>            toView: [hd.toDate(), hd.dateToDateString()]
<span class="linenr">44: </span>           }
<span class="linenr">45: </span>         );
<span class="linenr">46: </span>
<span class="linenr">47: </span>  hd.bind( {view: <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Text</span>( document.getElementById( <span style="color: #008000;">'d_view'</span> ) ),
<span class="linenr">48: </span>            model: context.d
<span class="linenr">49: </span>           }
<span class="linenr">50: </span>         );
<span class="linenr">51: </span>
<span class="linenr">52: </span>  hd.bind( {view: <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Edit</span>( document.getElementById( <span style="color: #008000;">'e_edit'</span> ) ),
<span class="linenr">53: </span>            model: context.e,
<span class="linenr">54: </span>            toModel: hd.def( <span style="color: #008000;">'Unknown'</span> )
<span class="linenr">55: </span>           }
<span class="linenr">56: </span>         );
<span class="linenr">57: </span>
<span class="linenr">58: </span>  hd.bind( {view: <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Text</span>( document.getElementById( <span style="color: #008000;">'e_view'</span> ) ),
<span class="linenr">59: </span>            model: context.e
<span class="linenr">60: </span>           }
<span class="linenr">61: </span>         );
<span class="linenr">62: </span>
<span class="linenr">63: </span>  hd.bind( {view: <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Edit</span>( document.getElementById( <span style="color: #008000;">'f_edit'</span> ) ),
<span class="linenr">64: </span>            model: context.f,
<span class="linenr">65: </span>            toModel: [hd.toNum(), hd.def( 1 )]
<span class="linenr">66: </span>           }
<span class="linenr">67: </span>         );
<span class="linenr">68: </span>
<span class="linenr">69: </span>  hd.bind( {view: <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Text</span>( document.getElementById( <span style="color: #008000;">'f_view'</span> ) ),
<span class="linenr">70: </span>            model: context.f
<span class="linenr">71: </span>           }
<span class="linenr">72: </span>         );
<span class="linenr">73: </span>
<span class="linenr">74: </span>  hd.bind( {view: <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Edit</span>( document.getElementById( <span style="color: #008000;">'g_edit'</span> ) ),
<span class="linenr">75: </span>            model: context.g,
<span class="linenr">76: </span>            toModel: [hd.req(), hd.msg( <span style="color: #008000;">"Don't forget me!"</span> )]
<span class="linenr">77: </span>           }
<span class="linenr">78: </span>         );
<span class="linenr">79: </span>
<span class="linenr">80: </span>  hd.bind( {view: <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Text</span>( document.getElementById( <span style="color: #008000;">'g_err'</span> ) ),
<span class="linenr">81: </span>            model: context.g.error
<span class="linenr">82: </span>           }
<span class="linenr">83: </span>         );
<span class="linenr">84: </span>} );
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-2" class="outline-3">
<h3 id="sec-6-2"><span class="section-number-3">6.2</span> What translators do</h3>
<div class="outline-text-3" id="text-6-2">
<p>
As described in <a href="basics.html">Basic HotDrink Usage</a>, translators are objects which are both
<i>observable</i> and <i>observers</i>.  Translators are used when one wishes to bind a
value in the View to a value in the View-Model, but each represents the value
differently.  A common example would be a text box in the View whose value is
a string bound to a variable in the View-Model whose value is a number.  A
translator sits between the View and the View-Model (or vice-versa) and
translates the values being sent from one to the other.
</p>

<p>
Every binding can potentially have two translators.  The translator labeled
<code>toView</code> in the binding specification is responsible for translating from the
value used by the model to the value used by the view; the translator labeled
<code>toModel</code> in the binding specification is responsible for translating from the
value used by the view to the value used by the model.
</p>
</div>
</div>

<div id="outline-container-sec-6-3" class="outline-3">
<h3 id="sec-6-3"><span class="section-number-3">6.3</span> Combining translators</h3>
<div class="outline-text-3" id="text-6-3">
<p>
In general, HotDrink assumes there will at most one translator from the view
to the view-model, and at most one translator from the view-model to the view.
However, you can easily combine multiple translators into one by wrapping them
in a <i>chain</i> translator.  A chain encapsulates a sequence of translators,
making them look like a single translator.  When it receives a value, it
translates it by running it through all the translators it contains.  The
value produced by the final translator becomes the value produced by the chain
itself.
</p>

<p>
You can see chains used in the following binding.
</p>

<div class="org-src-container">

<pre class="src src-js" id="chain">  hd.bind( {view: <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Edit</span>( document.getElementById( <span style="color: #008000;">'b_edit'</span> ) ),
            model: context.b,
            toModel: hd.chain( hd.toNum(),
                               hd.round( 0 ),
                               hd.scale( 0.01 ) ),
            toView: hd.chain( hd.scale( 100 ),
                              hd.fix( 0 )      ),
           }
         );
</pre>
</div>

<p>
However, as a convenience to you, if the <code>bind</code> function finds that you have
passed an array as either <code>toView</code> or <code>toModel</code>, it will use the contents of
the array to create a chain.  This is simply a shortcut to make binding
specifications a bit shorter.  You can see this shortcut is used in the
following binding.
</p>

<div class="org-src-container">

<pre class="src src-js" id="array">  hd.bind( {view: <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Edit</span>( document.getElementById( <span style="color: #008000;">'d_edit'</span> ) ),
            model: context.d,
            toModel: [hd.toDate(), hd.dateToMilliseconds()],
            toView: [hd.toDate(), hd.dateToDateString()]
           }
         );
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-4" class="outline-3">
<h3 id="sec-6-4"><span class="section-number-3">6.4</span> When translators fail</h3>
<div class="outline-text-3" id="text-6-4">
<p>
Translators convert a value from one representation to another.  It is
possible, however, for that conversion to fail.  For example, a translator
which translates a string to a number will fail if the string does not parse
as a valid number.  If an translator fails, then it produces an error value
which will be passed along in place of the value for the variable.  For
example, all translators provided by HotDrink produce a string containing an
error message.
</p>

<p>
Most translators simply pass along error values without modifying them.  It is
possible, however, for an translator to modify the error value, or even convert
the error value back into a variable value (see <a href="#msg">msg</a> and <a href="#def">def</a>.)  If an error
value reaches the variable, it will be stored in the variable's <code>error</code>
property, and the variable's value will not be changed.  If a valid value
reaches the variable, then the variable's <code>error</code> property will be set to
<code>null</code>.
</p>

<p>
The <code>error</code> property can be bound to the view, allowing the error to be
displayed.  For more information, see the section "<a href="#sec-9">Binding to variable
properties</a>").
</p>
</div>
</div>


<div id="outline-container-sec-6-5" class="outline-3">
<h3 id="sec-6-5"><span class="section-number-3">6.5</span> List of translators</h3>
<div class="outline-text-3" id="text-6-5">
<p>
Here are the translators provided by HotDrink.
</p>
</div>


<ol class="org-ol"><li><a id="sec-6-5-1"></a><code>toNum</code><br  /><div class="outline-text-4" id="text-6-5-1">
<p>
Converts a value to number using JavaScript's <code>Number</code> constructor.  Fails if the
result is <code>NaN</code>.
</p>
</div>
</li>

<li><a id="sec-6-5-2"></a><code>toDate</code><br  /><div class="outline-text-4" id="text-6-5-2">
<p>
Converts a value to a <code>Date</code> object using JavaScript's <code>Date</code> constructor.  Fails if
the resulting date's <code>getTime</code> method returns <code>NaN</code>.
</p>
</div>
</li>

<li><a id="sec-6-5-3"></a><code>toStr</code><br  /><div class="outline-text-4" id="text-6-5-3">
<p>
Converts any value to string by invoking its <code>toString</code> method.  Generally
not needed, as JavaScript will automatically do this any time it needs to
coerce a value to string.
</p>
</div>
</li>

<li><a id="sec-6-5-4"></a><code>toJson</code><br  /><div class="outline-text-4" id="text-6-5-4">
<p>
Converts any value to string by invoking <code>JSON.stringify</code>.
</p>
</div>
</li>

<li><a id="sec-6-5-5"></a><code>dateToString</code><br  /><div class="outline-text-4" id="text-6-5-5">
<p>
Converts a date object to a string using it's <code>toLocaleString</code> method.
</p>
</div>
</li>

<li><a id="sec-6-5-6"></a><code>dateToDateString</code><br  /><div class="outline-text-4" id="text-6-5-6">
<p>
Converts a date object to a string using it's <code>toLocaleDateString</code> method.
</p>
</div>
</li>


<li><a id="sec-6-5-7"></a><code>dateToTimeString</code><br  /><div class="outline-text-4" id="text-6-5-7">
<p>
Converts a date object to a string using it's <code>toLocaleTimeString</code> method.
</p>
</div>
</li>


<li><a id="sec-6-5-8"></a><code>dateToMilliseconds</code><br  /><div class="outline-text-4" id="text-6-5-8">
<p>
Converts a date object to a number of milliseconds using its <code>getTime</code> method.
</p>
</div>
</li>

<li><a id="sec-6-5-9"></a><code>fix( places )</code><br  /><div class="outline-text-4" id="text-6-5-9">
<p>
Converts a number to a string containing the specified number of places after
the decimal point using JavaScript's <code>Number.toFixed</code>.
</p>
</div>
</li>

<li><a id="sec-6-5-10"></a><code>prec( sigfigs )</code><br  /><div class="outline-text-4" id="text-6-5-10">
<p>
Converts a number to a string containing the specified number of significant
figures using JavaScript's <code>Number.toPrecision</code>.
</p>
</div>
</li>

<li><a id="sec-6-5-11"></a><code>exp( places )</code><br  /><div class="outline-text-4" id="text-6-5-11">
<p>
Converts a number to a string in scientific notation using the specified
number of digits after the decimal point using JavaScript's <code>Number.toExponential</code>.
</p>
</div>
</li>

<li><a id="sec-6-5-12"></a><code>round( places )</code><br  /><div class="outline-text-4" id="text-6-5-12">
<p>
Rounds a number to specified number of digits after the decimal point.  Note
that this is different from <code>fix</code> because it produces a number, not a string.
</p>
</div>
</li>

<li><a id="sec-6-5-13"></a><code>scale( factor )</code><br  /><div class="outline-text-4" id="text-6-5-13">
<p>
Scales a number by a constant factor.
</p>
</div>
</li>

<li><a id="sec-6-5-14"></a><code>stabilize( time_ms )</code><br  /><div class="outline-text-4" id="text-6-5-14">
<p>
Wait specified number of milliseconds before passing along value; only pass
along if no other value arrives in that time period.  Does not modify the
value.
</p>
</div>
</li>

<li><a id="sec-6-5-15"></a><code>req()</code><br  /><div class="outline-text-4" id="text-6-5-15">
<p>
Results in error if value is <code>undefined</code>, <code>null</code>, or empty string.
</p>
</div>
</li>

<li><a id="sec-6-5-16"></a><a id="def"></a> <code>def( value )</code><br  /><div class="outline-text-4" id="text-6-5-16">
<p>
Replaces <code>undefined</code>, <code>null</code>, empty string, or error with given value.
</p>
</div>
</li>

<li><a id="sec-6-5-17"></a><a id="msg"></a> <code>msg( value )</code><br  /><div class="outline-text-4" id="text-6-5-17">
<p>
Replaces error with given value; can be used to customize error messages.
</p>
</div>
</li>

<li><a id="sec-6-5-18"></a><code>chain( ext, ... )</code><br  /><div class="outline-text-4" id="text-6-5-18">
<p>
Creates a single translator from a list of translators.
</p>
</div>
</li>

<li><a id="sec-6-5-19"></a><code>fn( f )</code><br  /><div class="outline-text-4" id="text-6-5-19">
<p>
Creates an translator which calls function <code>f</code> on the value, then produces the
return value as a result.  Discussed in next section.
</p>
</div>
</li></ol>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Creating translators from functions</h2>
<div class="outline-text-2" id="text-7">
<p>
<i>View</i>
</p>

<div class="org-src-container">

<pre class="src src-html"><span class="linenr"> 1: </span>&lt;<span style="color: #006699;">table</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"ex2"</span>&gt;
<span class="linenr"> 2: </span>  &lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr"> 3: </span>    &lt;<span style="color: #006699;">td</span>&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr"> 4: </span>    &lt;<span style="color: #006699;">td</span>&gt;
<span class="linenr"> 5: </span>      &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"hd.num( x )"</span>/&gt; <span style="color: #BA36A5;">&amp;gt;</span> 10 <span style="color: #BA36A5;">&amp;rArr;</span>
<span id="coderef-usefn1" class="coderef-off"><span class="linenr"> 6: </span>      &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"hd.text( x, hd.fn( gt10 ) )"</span>&gt;&lt;/<span style="color: #006699;">span</span>&gt;</span>
<span class="linenr"> 7: </span>    &lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr"> 8: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;&lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr"> 9: </span>    &lt;<span style="color: #006699;">td</span>&gt;10 <span style="color: #BA36A5;">&amp;le;&amp;nbsp;</span>&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">10: </span>    &lt;<span style="color: #006699;">td</span>&gt;
<span class="linenr">11: </span>      &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"hd.num( y )"</span>/&gt; <span style="color: #BA36A5;">&amp;le;</span> 20 <span style="color: #BA36A5;">&amp;rArr;</span>
<span id="coderef-usefn2" class="coderef-off"><span class="linenr">12: </span>      &lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"y_view"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"hd.text( y, hd.fn( range, 10, 20 ) )"</span>&gt;&lt;<span style="color: #006699;">span</span>&gt;</span>
<span class="linenr">13: </span>    &lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">14: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;
<span class="linenr">15: </span>&lt;/<span style="color: #006699;">table</span>&gt;
</pre>
</div>

<p>
<i>View-Model</i>
</p>

<div class="org-src-container">

<pre class="src src-js"><span class="linenr">1: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">model</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.ModelBuilder</span>()
<span class="linenr">2: </span>    .v( <span style="color: #008000;">'x'</span>, 3 )
<span class="linenr">3: </span>    .v( <span style="color: #008000;">'y'</span>, 13 )
<span class="linenr">4: </span>    .end();
</pre>
</div>

<p>
<i>Binding</i>
</p>

<div class="org-src-container">

<pre class="src src-js"><span class="linenr"> 1: </span><span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Global function</span>
<span id="coderef-fn1" class="coderef-off"><span class="linenr"> 2: </span>gt10 = <span style="color: #0000FF;">function</span> gt10( <span style="color: #BA36A5;">x</span> ) {</span>
<span class="linenr"> 3: </span>  <span style="color: #0000FF;">return</span> x &gt; 10 ? <span style="color: #008000;">'Yes!'</span> : <span style="color: #008000;">'No!'</span>;
<span class="linenr"> 4: </span>}
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Global function</span>
<span id="coderef-fn2" class="coderef-off"><span class="linenr"> 7: </span>range = <span style="color: #0000FF;">function</span> range( <span style="color: #BA36A5;">begin</span>, <span style="color: #BA36A5;">end</span>, <span style="color: #BA36A5;">x</span> ) {</span>
<span class="linenr"> 8: </span>  <span style="color: #0000FF;">return</span> (x &gt;= begin &amp;&amp; x &lt;= end) ? <span style="color: #008000;">'Yes!'</span> : <span style="color: #008000;">'No!'</span>;
<span class="linenr"> 9: </span>}
<span class="linenr">10: </span>
<span class="linenr">11: </span>window.addEventListener( <span style="color: #008000;">'load'</span>, <span style="color: #0000FF;">function</span>() {
<span class="linenr">12: </span>  hd.performDeclaredBindings( model, document.getElementById( <span style="color: #008000;">'ex2'</span> ) );
<span class="linenr">13: </span>} )
</pre>
</div>

<p>
<i>Results</i>
</p>

<p>
##+HTML: &lt;div class="results"&gt;
##+INCLUDE: tangle/fnext.html html
##+HTML: &lt;/div&gt;
##+HTML: &lt;script type="text/javascript"&gt;
##+HTML: (function() {
##+INCLUDE: tangle/fnext.js html
##+HTML: })();
##+HTML: &lt;/script&gt;
</p>

<p>
<i>Notes</i>
</p>

<div class="notes">
<p>
This example creates two translators from functions in order to translate the
values displayed in the web page.
</p>
</div>
</div>

<div id="outline-container-sec-7-1" class="outline-3">
<h3 id="sec-7-1"><span class="section-number-3">7.1</span> The <code>fn</code> translator</h3>
<div class="outline-text-3" id="text-7-1">
<p>
Translators are actually objects which conform to a certain interface.  You can
define your own translator types as JavaScript objects.  However, in cases
where you need to do a simple translation, there's an easier way:
</p>
</div>

<ol class="org-ol"><li><a id="sec-7-1-1"></a>Write a translation function<br  /><div class="outline-text-4" id="text-7-1-1">
<p>
A translation function is a function which takes the incoming value as a
parameter, then returns the translated value as the result.  For example, the
function <code>gt10</code> on <a href="#coderef-fn1"class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-fn1');" onmouseout="CodeHighlightOff(this, 'coderef-fn1');">line 2</a> of the binding section takes a numeric value and
translates it to the string "<code>Yes!</code>" if it is greater than 10, and the string
"<code>No!</code>" otherwise.
</p>

<p>
If your translation fails, your translation function should throw an
error value as an exception.  This will be caught and passed on as an error
value.
</p>

<p>
Note that, if you want to, you can write an anonymous translation function
directly into the binding specification.  The
<a href="http://wiki.ecmascript.org/doku.php?id=harmony:specification_drafts">draft for EcmaScript 6</a> includes an arrow notation for anonymous functions,
which would allow such inline functions to be even more convenient.
</p>
</div>
</li>


<li><a id="sec-7-1-2"></a>Use it in a <code>fn</code> translator<br  /><div class="outline-text-4" id="text-7-1-2">
<p>
The <code>hd.fn</code> translator takes a translation function as a parameter.  Then,
when it receives a value, it invokes the translation function, and passes
the result on.  We used the <code>gt10</code> function in the binding specification found
in the view section on <a href="#coderef-usefn1"class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-usefn1');" onmouseout="CodeHighlightOff(this, 'coderef-usefn1');">line 6</a>.  Thus, the value displayed in the
<code>&lt;span&gt;</code> tag is not the numeric value of <code>x</code>, but the string returned by
passing that to <code>gt10</code>.
</p>
</div>
</li></ol>
</div>

<div id="outline-container-sec-7-2" class="outline-3">
<h3 id="sec-7-2"><span class="section-number-3">7.2</span> Extra function parameters</h3>
<div class="outline-text-3" id="text-7-2">
<p>
You may want your translation function to take some extra parameters that
configure its behavior.  For example, the function <code>range</code> in <a href="#coderef-fn2"class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-fn2');" onmouseout="CodeHighlightOff(this, 'coderef-fn2');">line 7</a> of
the binding section takes a <code>begin</code> and <code>end</code> parameter to specify the range
to test.  Any extra parameters passed to <code>hd.fn</code> (after the function itself)
will be passed directly to the function when it is called.  These extra
parameters should be the first parameters of the function, with the value to
be translated as the final parameter.  You can see this in <a href="#coderef-usefn2"class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-usefn2');" onmouseout="CodeHighlightOff(this, 'coderef-usefn2');">line 12</a> of
the view section.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> View adapters</h2>
<div class="outline-text-2" id="text-8">
</div><div id="outline-container-sec-8-1" class="outline-3">
<h3 id="sec-8-1"><span class="section-number-3">8.1</span> The example</h3>
<div class="outline-text-3" id="text-8-1">
<p>
<i>View</i>
</p>

<div class="org-src-container">

<pre class="src src-html"><span class="linenr"> 1: </span>&lt;<span style="color: #006699;">style</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text/css"</span>&gt;
<span class="linenr"> 2: </span>  td.fancy { color: #009; background: #9f9; }
<span class="linenr"> 3: </span>  td.plain { color: #666; background: #eee; }
<span class="linenr"> 4: </span>  td.assertive { font-weight: bold; text-transform: uppercase; }
<span class="linenr"> 5: </span>&lt;/<span style="color: #006699;">style</span>&gt;
<span class="linenr"> 6: </span>&lt;<span style="color: #006699;">table</span>&gt;
<span class="linenr"> 7: </span>  &lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr"> 8: </span>    &lt;<span style="color: #006699;">td</span>&gt;
<span id="coderef-select" class="coderef-off"><span class="linenr"> 9: </span>      &lt;<span style="color: #006699;">select</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"edit_dropdown"</span>&gt;</span>
<span class="linenr">10: </span>        &lt;<span style="color: #006699;">option</span>&gt;One&lt;/<span style="color: #006699;">option</span>&gt;&lt;<span style="color: #006699;">option</span>&gt;Two&lt;/<span style="color: #006699;">option</span>&gt;&lt;<span style="color: #006699;">option</span>&gt;Three&lt;/<span style="color: #006699;">option</span>&gt;
<span class="linenr">11: </span>      &lt;/<span style="color: #006699;">select</span>&gt;
<span class="linenr">12: </span>    &lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">13: </span>    &lt;<span style="color: #006699;">td</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"view_dropdown"</span>&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">14: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;&lt;<span style="color: #006699;">tr</span>&gt;
<span id="coderef-value" class="coderef-off"><span class="linenr">15: </span>    &lt;<span style="color: #006699;">td</span>&gt;&lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"edit_num1"</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"input"</span>/&gt;&lt;/<span style="color: #006699;">td</span>&gt;</span>
<span class="linenr">16: </span>    &lt;<span style="color: #006699;">td</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"view_num1"</span>&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">17: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;&lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">18: </span>    &lt;<span style="color: #006699;">td</span> <span style="color: #BA36A5;">colspan</span>=<span style="color: #008000;">"2"</span>&gt;<span style="color: #BA36A5;">&amp;nbsp;</span>&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">19: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;&lt;<span style="color: #006699;">tr</span>&gt;
<span id="coderef-edit" class="coderef-off"><span class="linenr">20: </span>    &lt;<span style="color: #006699;">td</span>&gt;&lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"edit_num2"</span>/&gt;&lt;/<span style="color: #006699;">td</span>&gt;</span>
<span class="linenr">21: </span>    &lt;<span style="color: #006699;">td</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"view_num2"</span>&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">22: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;&lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">23: </span>    &lt;<span style="color: #006699;">td</span>&gt;
<span id="coderef-checked" class="coderef-off"><span class="linenr">24: </span>      &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"edit_isenabled"</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"checkbox"</span>/&gt;</span>
<span class="linenr">25: </span>      &lt;<span style="color: #006699;">label</span> <span style="color: #BA36A5;">for</span>=<span style="color: #008000;">"edit_isenabled"</span>&gt;Enabled&lt;/<span style="color: #006699;">label</span>&gt;
<span class="linenr">26: </span>    &lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">27: </span>    &lt;<span style="color: #006699;">td</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"view_isenabled"</span>&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">28: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;&lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">29: </span>    &lt;<span style="color: #006699;">td</span> <span style="color: #BA36A5;">colspan</span>=<span style="color: #008000;">"2"</span>&gt;<span style="color: #BA36A5;">&amp;nbsp;</span>&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">30: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;&lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">31: </span>    &lt;<span style="color: #006699;">td</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"view_css"</span> <span style="color: #BA36A5;">colspan</span>=<span style="color: #008000;">"2"</span>&gt;How do I look?&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">32: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;&lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">33: </span>    &lt;<span style="color: #006699;">td</span>&gt;
<span class="linenr">34: </span>      &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"edit_isfancy"</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"checkbox"</span>/&gt;
<span class="linenr">35: </span>      &lt;<span style="color: #006699;">label</span> <span style="color: #BA36A5;">for</span>=<span style="color: #008000;">"edit_isfancy"</span>&gt;Fancy&lt;/<span style="color: #006699;">label</span>&gt;
<span class="linenr">36: </span>    &lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">37: </span>    &lt;<span style="color: #006699;">td</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"view_isfancy"</span>&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">38: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;&lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">39: </span>    &lt;<span style="color: #006699;">td</span>&gt;
<span class="linenr">40: </span>      &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"edit_isassertive"</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"checkbox"</span>/&gt;
<span class="linenr">41: </span>      &lt;<span style="color: #006699;">label</span> <span style="color: #BA36A5;">for</span>=<span style="color: #008000;">"edit_isassertive"</span>&gt;Assertive&lt;/<span style="color: #006699;">label</span>&gt;
<span class="linenr">42: </span>    &lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">43: </span>    &lt;<span style="color: #006699;">td</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"view_isassertive"</span>&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">44: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;&lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">45: </span>    &lt;<span style="color: #006699;">td</span> <span style="color: #BA36A5;">colspan</span>=<span style="color: #008000;">"2"</span>&gt;<span style="color: #BA36A5;">&amp;nbsp;</span>&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">46: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;&lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">47: </span>    &lt;<span style="color: #006699;">td</span>&gt;Time:&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">48: </span>    &lt;<span style="color: #006699;">td</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"view_time"</span>&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">49: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;&lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">50: </span>    &lt;<span style="color: #006699;">td</span>&gt;Mouse:&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">51: </span>    &lt;<span style="color: #006699;">td</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"view_mouse"</span>&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">52: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;
<span class="linenr">53: </span>&lt;/<span style="color: #006699;">table</span>&gt;
<span class="linenr">54: </span>&lt;/<span style="color: #006699;">table</span>&gt;
</pre>
</div>

<p>
<i>View-Model</i>
</p>

<div class="org-src-container">

<pre class="src src-js"><span class="linenr"> 1: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">model</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.ModelBuilder</span>()
<span class="linenr"> 2: </span>  .v( <span style="color: #008000;">'dropdown'</span>,    <span style="color: #008000;">'Two'</span>        )
<span class="linenr"> 3: </span>  .v( <span style="color: #008000;">'num1'</span>,        10           )
<span class="linenr"> 4: </span>  .v( <span style="color: #008000;">'num2'</span>,        20           )
<span class="linenr"> 5: </span>  .v( <span style="color: #008000;">'isenabled'</span>,   <span style="color: #8b1a1a;">true</span>         )
<span class="linenr"> 6: </span>  .v( <span style="color: #008000;">'isfancy'</span>,     <span style="color: #8b1a1a;">true</span>         )
<span class="linenr"> 7: </span>  .v( <span style="color: #008000;">'isassertive'</span>, <span style="color: #8b1a1a;">false</span>        )
<span class="linenr"> 8: </span>  .v( <span style="color: #008000;">'time'</span>,        <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">Date</span>()   )
<span class="linenr"> 9: </span>  .v( <span style="color: #008000;">'mouse'</span>,       {x: 0, y: 0} )
<span class="linenr">10: </span>  .end();
</pre>
</div>

<p>
<i>Binding</i>
</p>

<div class="org-src-container">

<pre class="src src-js"><span class="linenr">  1: </span>window.addEventListener( <span style="color: #008000;">'load'</span>, <span style="color: #0000FF;">function</span>() {
<span class="linenr">  2: </span>  hd.bind( {view:  <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Value</span>( document.getElementById( <span style="color: #008000;">'edit_dropdown'</span> ) ),
<span class="linenr">  3: </span>            model: model.dropdown
<span class="linenr">  4: </span>           }
<span class="linenr">  5: </span>         );
<span class="linenr">  6: </span>
<span class="linenr">  7: </span>  hd.bind( {view:    <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Value</span>( document.getElementById( <span style="color: #008000;">'edit_num1'</span> ) ),
<span class="linenr">  8: </span>            model:   model.num1,
<span class="linenr">  9: </span>            toModel: hd.toNum()
<span class="linenr"> 10: </span>           }
<span class="linenr"> 11: </span>         );
<span class="linenr"> 12: </span>
<span class="linenr"> 13: </span>  hd.bind( {view:    <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Edit</span>( document.getElementById( <span style="color: #008000;">'edit_num2'</span> ) ),
<span class="linenr"> 14: </span>            model:   model.num2,
<span class="linenr"> 15: </span>            toModel: hd.toNum()
<span class="linenr"> 16: </span>           }
<span class="linenr"> 17: </span>         );
<span class="linenr"> 18: </span>
<span class="linenr"> 19: </span>  hd.bind( {view:  <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Enabled</span>( document.getElementById( <span style="color: #008000;">'edit_num2'</span> ) ),
<span class="linenr"> 20: </span>            model: model.isenabled
<span class="linenr"> 21: </span>           }
<span class="linenr"> 22: </span>         );
<span class="linenr"> 23: </span>
<span class="linenr"> 24: </span>  hd.bind( {view:  <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Checked</span>( document.getElementById( <span style="color: #008000;">'edit_isenabled'</span> ) ),
<span class="linenr"> 25: </span>            model: model.isenabled
<span class="linenr"> 26: </span>           }
<span class="linenr"> 27: </span>         );
<span class="linenr"> 28: </span>
<span class="linenr"> 29: </span>  hd.bind( {view:  <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Checked</span>( document.getElementById( <span style="color: #008000;">'edit_isfancy'</span> ) ),
<span class="linenr"> 30: </span>            model: model.isfancy
<span class="linenr"> 31: </span>           }
<span class="linenr"> 32: </span>         );
<span class="linenr"> 33: </span>
<span class="linenr"> 34: </span>  hd.bind( {view:  <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Checked</span>( document.getElementById( <span style="color: #008000;">'edit_isassertive'</span> ) ),
<span class="linenr"> 35: </span>            model: model.isassertive
<span class="linenr"> 36: </span>           }
<span class="linenr"> 37: </span>         );
<span class="linenr"> 38: </span>
<span class="linenr"> 39: </span>  hd.bind( {view:  <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.CssClass</span>( <span style="color: #008000;">'fancy'</span>,
<span class="linenr"> 40: </span>                                    <span style="color: #008000;">'plain'</span>,
<span class="linenr"> 41: </span>                                    document.getElementById( <span style="color: #008000;">'view_css'</span> ) ),
<span class="linenr"> 42: </span>            model: model.isfancy
<span class="linenr"> 43: </span>           }
<span id="coderef-justtrue" class="coderef-off"><span class="linenr"> 44: </span>         );</span>
<span class="linenr"> 45: </span>
<span class="linenr"> 46: </span>  hd.bind( {view:  <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.CssClass</span>( <span style="color: #008000;">'assertive'</span>,
<span class="linenr"> 47: </span>                                    <span style="color: #8b1a1a;">null</span>,
<span class="linenr"> 48: </span>                                    document.getElementById( <span style="color: #008000;">'view_css'</span> ) ),
<span class="linenr"> 49: </span>            model: model.isassertive
<span class="linenr"> 50: </span>           }
<span id="coderef-truefalse" class="coderef-off"><span class="linenr"> 51: </span>         );</span>
<span class="linenr"> 52: </span>
<span class="linenr"> 53: </span>  hd.bind( {view:  <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Time</span>( 1000 ),
<span class="linenr"> 54: </span>            model: model.time
<span class="linenr"> 55: </span>           }
<span class="linenr"> 56: </span>         );
<span class="linenr"> 57: </span>
<span class="linenr"> 58: </span>  hd.bind( {view:  <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.MousePosition</span>(),
<span class="linenr"> 59: </span>            model: model.mouse
<span class="linenr"> 60: </span>           }
<span class="linenr"> 61: </span>         );
<span class="linenr"> 62: </span>
<span class="linenr"> 63: </span>  hd.bind( {view:  <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Text</span>( document.getElementById( <span style="color: #008000;">'view_dropdown'</span> ) ),
<span class="linenr"> 64: </span>            model: model.dropdown
<span class="linenr"> 65: </span>           }
<span class="linenr"> 66: </span>         );
<span class="linenr"> 67: </span>
<span class="linenr"> 68: </span>  hd.bind( {view:  <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Text</span>( document.getElementById( <span style="color: #008000;">'view_num1'</span> ) ),
<span class="linenr"> 69: </span>            model: model.num1
<span class="linenr"> 70: </span>           }
<span class="linenr"> 71: </span>         );
<span class="linenr"> 72: </span>
<span class="linenr"> 73: </span>  hd.bind( {view:  <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Text</span>( document.getElementById( <span style="color: #008000;">'view_num2'</span> ) ),
<span class="linenr"> 74: </span>            model: model.num2
<span class="linenr"> 75: </span>           }
<span class="linenr"> 76: </span>         );
<span class="linenr"> 77: </span>
<span class="linenr"> 78: </span>  hd.bind( {view:  <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Text</span>( document.getElementById( <span style="color: #008000;">'view_isenabled'</span> ) ),
<span class="linenr"> 79: </span>            model: model.isenabled
<span class="linenr"> 80: </span>           }
<span class="linenr"> 81: </span>         );
<span class="linenr"> 82: </span>
<span class="linenr"> 83: </span>  hd.bind( {view:  <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Text</span>( document.getElementById( <span style="color: #008000;">'view_isfancy'</span> ) ),
<span class="linenr"> 84: </span>            model: model.isfancy
<span class="linenr"> 85: </span>           }
<span class="linenr"> 86: </span>         );
<span class="linenr"> 87: </span>
<span class="linenr"> 88: </span>  hd.bind( {view:  <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Text</span>( document.getElementById( <span style="color: #008000;">'view_isassertive'</span> ) ),
<span class="linenr"> 89: </span>            model: model.isassertive
<span class="linenr"> 90: </span>           }
<span class="linenr"> 91: </span>         );
<span class="linenr"> 92: </span>
<span class="linenr"> 93: </span>  hd.bind( {view:   <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Text</span>( document.getElementById( <span style="color: #008000;">'view_time'</span> ) ),
<span class="linenr"> 94: </span>            model:  model.time,
<span class="linenr"> 95: </span>            toView: hd.dateToTimeString()
<span class="linenr"> 96: </span>           }
<span class="linenr"> 97: </span>         );
<span class="linenr"> 98: </span>
<span class="linenr"> 99: </span>  hd.bind( {view:   <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.Text</span>( document.getElementById( <span style="color: #008000;">'view_mouse'</span> ) ),
<span class="linenr">100: </span>            model:  model.mouse,
<span class="linenr">101: </span>            toView: hd.pointToString()
<span class="linenr">102: </span>           }
<span class="linenr">103: </span>         );
<span class="linenr">104: </span>
<span class="linenr">105: </span>} );
</pre>
</div>

<p>
<i>Result</i>
</p>

<p>
##+HTML: &lt;div class="results"&gt;
##+INCLUDE: tangle/allbind.html html
##+HTML: &lt;/div&gt;
##+HTML: &lt;script type="text/javascript"&gt;
##+HTML: (function() {
##+INCLUDE: tangle/allbind.js html
##+HTML: })();
##+HTML: &lt;/script&gt;
</p>

<p>
<i>Notes</i>
</p>

<div class="notes">
<p>
Variable values are displayed in the page so that you can see their values.
The "enabled" check-box controls whether the text box is enabled.  The "fancy"
and "assertive" check-boxes control the style of the preceding text.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-8-2" class="outline-3">
<h3 id="sec-8-2"><span class="section-number-3">8.2</span> What view adapters do</h3>
<div class="outline-text-3" id="text-8-2">
<p>
As described in the <a href="basics.html">Basic HotDrink Usage</a> document, a binding connects an
element of the view with an element of the model so that changes in one will
be reflected in the other.  In order to do this, we need an object that
represents the view and which supports the interface HotDrink expects.  This
object is called a view adapter.  We will define the interfaces used in the
<a href="program.html">Programming Guide</a>, but for now we simply list the adapters that we provide
with HotDrink.
</p>

<p>
There are two interfaces which a view adapter may use:  one for sending values
to the view-model, and one for receiving values from the model.  We say that a
adapter which only receives values is a <i>read-only</i> adapter, an adapter which
only sends values is a <i>write-only</i> adapter, and an adapter which does both is
a <i>read-write</i> adapter.
</p>

<p>
Most adapter types take a single parameter upon construction:  an HTML DOM
element node for the view element to be encapsulated.  There is currently only
one that takes additional parameters; there are two which don't require a DOM
element because they do not encapsulate a specific DOM node.
</p>

<p>
This example showcases the adapters that are currently available in HotDrink.
As the focus of HotDrink is on view-model behavior, the number of adapters we
have developed is relatively small.  We expect to add to this collection as
time goes on.  In the meantime, we have tried to make adding adapters to
HotDrink as simple as possible so that, if we don't have the adapter you need,
you can easily write it yourself.  For more information, see the HotDrink
<a href="program.html">Programming Guide</a>.
</p>
</div>
</div>

<div id="outline-container-sec-8-3" class="outline-3">
<h3 id="sec-8-3"><span class="section-number-3">8.3</span> List of adapters</h3>
<div class="outline-text-3" id="text-8-3">
<p>
Here are the adapters provided by HotDrink.
</p>
</div>

<ol class="org-ol"><li><a id="sec-8-3-1"></a><code>Value( el )</code><br  /><div class="outline-text-4" id="text-8-3-1">
<p>
This adapter uses the value of the variable as the <code>value</code> property of the
corresponding element.  This adapter is well suited for <code>&lt;select&gt;</code> tags, like
the one on <a href="#coderef-select"class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-select');" onmouseout="CodeHighlightOff(this, 'coderef-select');">line 9</a> of the view section.  You may also use it for
text-editing inputs, as on <a href="#coderef-value"class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-value');" onmouseout="CodeHighlightOff(this, 'coderef-value');">line 15</a> of the view section, though <code>bindEdit</code>
is probably a better choice.
</p>

<p>
This is a read-write adapter.
</p>
</div>
</li>

<li><a id="sec-8-3-2"></a><code>Edit( el )</code><br  /><div class="outline-text-4" id="text-8-3-2">
<p>
This adapter also uses the value of the variable as the <code>value</code> property
of the tag, but it has some additional behaviors to make it work well with text
editing.  In particular:
</p>

<ul class="org-ul">
<li>When the input is edited, the <code>edit</code> binding waits a fraction of a second
before changing its variable in case any more changes are made.  If so, the
binding discards the previous edit.  This is nice when the user is typing
something &#x2014; to update the GUI after every keystroke would be distracting.
</li>

<li>If the value of the variable changes while the user is editing, the <code>edit</code>
binding remembers the new value, but does not set it until the edit box
loses focus.  This might happen, for example, if the binding converts the
value to some canonical form.
</li>
</ul>

<p>
We used the edit binding for the text box in <a href="#coderef-edit"class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-edit');" onmouseout="CodeHighlightOff(this, 'coderef-edit');">line 20</a> of the view section.
Compare it's behavior to the value binding.  (Try typing "1e10" into both to
see what happens.)
</p>

<p>
This is a read-write adapter.
</p>
</div>
</li>

<li><a id="sec-8-3-3"></a><code>Checked( el )</code><br  /><div class="outline-text-4" id="text-8-3-3">
<p>
This adapter uses a Boolean value as the <code>checked</code> property on a check-box.
</p>

<p>
This is a read-write binding: checking or un-checking the check-box updates
the variable.
</p>
</div>
</li>

<li><a id="sec-8-3-4"></a><code>Enabled( el )</code><br  /><div class="outline-text-4" id="text-8-3-4">
<p>
This adapter uses a Boolean value to determine whether or not a widget is
enabled &#x2014; a <code>true</code> value means enabled, a <code>false</code> value means disabled.
Later on we'll show you how this can be used to automatically disable
variables which become irrelevant.
</p>

<p>
This is a read-only adapter: explicitly enabling or disabling the widget will
<i>not</i> affect the value of the variable.
</p>
</div>
</li>

<li><a id="sec-8-3-5"></a><code>CssClass( ontrue, onfalse, el )</code><br  /><div class="outline-text-4" id="text-8-3-5">
<p>
This adapter uses a Boolean value to determine whether or not the given CSS
class name should be applied to the view element.  Notice that this
constructor takes additional parameters.  If the boolean value is true, then
the <code>ontrue</code> class will be added to the element.  If it is false, then the
<code>onfalse</code> class will be added to the element.
</p>

<p>
Both <code>ontrue</code> and <code>onfalse</code> may be <code>null</code>; if so, then the adapter simply will
not add a class for the corresponding value.  You can see, the binding on <a href="#coderef-justtrue"class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-justtrue');" onmouseout="CodeHighlightOff(this, 'coderef-justtrue');">line
44</a> of the binding section specifies both, whereas the binding on <a href="#coderef-truefalse"class="coderef" onmouseover="CodeHighlightOn(this, 'coderef-truefalse');" onmouseout="CodeHighlightOff(this, 'coderef-truefalse');">line
51</a> of the binding section only specifies a class to add when the
value is true.
</p>

<p>
This is a read-only binding: explicitly setting the element's class name will
<i>not</i> update the variable.
</p>
</div>
</li>

<li><a id="sec-8-3-6"></a><code>Text( el )</code><br  /><div class="outline-text-4" id="text-8-3-6">
<p>
This adapter replaces the contents of the tag with the value of the variable.
Note that the value is treated as text, <i>not</i> as HTML; any HTML tags or
entities in the value will simply be displayed as text.
</p>

<p>
This is a read-only binding:  explicitly changing the contents of the tag will
<i>not</i> update the variable.
</p>
</div>
</li>

<li><a id="sec-8-3-7"></a><code>Time( update_ms )</code><br  /><div class="outline-text-4" id="text-8-3-7">
<p>
This adapter writes the current time to the variable every <code>update_ms</code>
milliseconds.  The time is given as a JavaScript <code>Date</code> object.
</p>

<p>
This is a write-only binding:  changing the contents of the variable will have
no effect on the time.
</p>
</div>
</li>

<li><a id="sec-8-3-8"></a><code>MousePosition()</code><br  /><div class="outline-text-4" id="text-8-3-8">
<p>
This adapter writes the current mouse position to the variable every time the
mouse moves.  The position is given as a JavaScript object with an <code>x</code> and <code>y</code>
property.
</p>

<p>
This is a write-only binding:  changing the contents of the variable will have
no effect on the mouse position.
</p>
</div>
</li>

<li><a id="sec-8-3-9"></a><code>Position( el )</code><br  /><div class="outline-text-4" id="text-8-3-9">
<p>
This adapter takes a point (an object with an <code>x</code> and <code>y</code> property) and uses
it to set the element's CSS <code>left</code> and <code>top</code> properties.  The adapter will
also set the element's CSS <code>position</code> property to <code>absolute</code>.
</p>

<p>
This is a read-only binding: changing the position or the style of the element
will <i>not</i> update the variable.
</p>
</div>
</li></ol>
</div>

<div id="outline-container-sec-8-4" class="outline-3">
<h3 id="sec-8-4"><span class="section-number-3">8.4</span> Factory functions</h3>
<div class="outline-text-3" id="text-8-4">
<p>
As described in the <a href="basics.html">Basic HotDrink Usage</a> document, factory functions are
simply helpers which generate binding specifications for you.  We have
included factories for the specifications we think will be most common.
However, you are encouraged to create and use your own if the provided
factories do not meet your needs.
</p>

<p>
When using declarative binding, the format of the <code>data-bind</code> attribute is a
comma-delimited list of binding specifications.  In order to allow factory
functions to generate multiple binding specifications, we make the following
accommodation: the list of specifications will be <i>flattened</i> &#x2014; that is, if
an array is found in the list, the contents of the array will be interpolated
into the list in place of the array.  This flattening is repeated until there
are no more arrays in the list; thus arrays can be arbitrarily nested.
</p>
</div>
</div>

<div id="outline-container-sec-8-5" class="outline-3">
<h3 id="sec-8-5"><span class="section-number-3">8.5</span> List of factories</h3>
<div class="outline-text-3" id="text-8-5">
</div><ol class="org-ol"><li><a id="sec-8-5-1"></a>value( model, toView?, toModel? )<br  /><div class="outline-text-4" id="text-8-5-1">
<p>
Use the <code>Value</code> adapter with optional <code>toView</code> and <code>toModel</code> arguments.
</p>

<pre class="results">
hd.value( <i>model</i>, <i>toView</i>, <i>toModel</i> )
  ==
{mkview:  hd.Value,
 model:   <i>model</i>,
 toView:  <i>toView</i>,
 toModel: <i>toModel</i>
}
</pre>
</div>
</li>

<li><a id="sec-8-5-2"></a>edit( model, toView?, toModel? )<br  /><div class="outline-text-4" id="text-8-5-2">
<p>
Use the <code>Edit</code> adapter with optional <code>toView</code> and <code>toModel</code> arguments.
</p>

<pre class="results">
hd.edit( <i>model</i>, <i>toView</i>, <i>toModel</i> )
  ==
{mkview:  hd.Edit,
 model:   <i>model</i>,
 toView:  <i>toView</i>,
 toModel: <i>toModel</i>
}
</pre>
</div>
</li>

<li><a id="sec-8-5-3"></a>number( model )<br  /><div class="outline-text-4" id="text-8-5-3">
<p>
Use the <code>Edit</code> adapter where the variable holds a number.  Note that no
<code>toView</code> is needed, as JavaScript will automatically convert a number to a
string when needed.
</p>

<pre class="results">
hd.num( <i>model</i> )
  ==
{mkview:  hd.Edit,
 model:   <i>model</i>,
 toModel: hd.toNum()
}
</pre>
</div>
</li>

<li><a id="sec-8-5-4"></a>number( model, places, toView?, toModel? )<br  /><div class="outline-text-4" id="text-8-5-4">
<p>
This overloaded form of <code>number</code> will round the number to a specified number
of digits after the decimal point.  Note that the <code>toView</code> and <code>toModel</code>
specified here should treat the view as if it is a number, not a string.  For
example, the following specification will round to two places after the
decimal point and the value showed in the view will be 100 times the value in
the model.
</p>

<pre class="results">
hd.num( <i>model</i>, 2, hd.scale( 100 ), hd.scale( 0.01 ) );
</pre>
</div>
</li>

<li><a id="sec-8-5-5"></a>date( model )<br  /><div class="outline-text-4" id="text-8-5-5">
<p>
Use the <code>Edit</code> adapter where the variable holds a <code>Date</code> object.
</p>

<pre class="results">
hd.date( <i>model</i> )
  ==
{mkview:  hd.Edit,
 model:   <i>model</i>,
 toView:  hd.dateToDateStr(),
 toModel: hd.toDate()
}
</pre>
</div>
</li>

<li><a id="sec-8-5-6"></a>date( model, toView, toModel )<br  /><div class="outline-text-4" id="text-8-5-6">
<p>
This overloaded form of <code>date</code> allows an additional <code>toView</code> and <code>toModel</code>
transformation.  Note that these transformations hsould treat the view as if
it is a date, not a string.  For example, the following specification will let
the user enter a date, but will store it in the model as the number of
milliseconds after the epoch.
</p>

<pre class="results">
hd.date( <i>model</i>, hd.dateToMilliseconds(), hd.toDate() );
</pre>
</div>
</li>

<li><a id="sec-8-5-7"></a>checked( model, toView?, toModel? )<br  /><div class="outline-text-4" id="text-8-5-7">
<p>
Use the <code>Checked</code> adapter with optional <code>toView</code> and <code>toModel</code> arguments.
</p>

<pre class="results">
hd.checked( <i>model</i>, <i>toView</i>, <i>toModel</i> )
  ==
{mkview:  hd.Checked,
 model:   <i>model</i>,
 toView:  <i>toView</i>,
 toModel: <i>toModel</i>
}
</pre>
</div>
</li>

<li><a id="sec-8-5-8"></a>enabled( model, toView? )<br  /><div class="outline-text-4" id="text-8-5-8">
<p>
Use the <code>Enabled</code> adapter with optional <code>toView</code> argument.
</p>

<pre class="results">
hd.enabled( <i>model</i>, <i>toView</i> )
  ==
{mkview:  hd.Enabled,
 model:   <i>model</i>,
 toView:  <i>toView</i>
}
</pre>
</div>
</li>

<li><a id="sec-8-5-9"></a>cssClass( model, ontrue, onfalse, toView? )<br  /><div class="outline-text-4" id="text-8-5-9">
<p>
Use the <code>CssClass</code> adapter with optional <code>toView</code> argument.
</p>

<p>
Note that the <code>ontrue</code> and <code>onfalse</code> values are bound to the <code>CssClass</code>
constructor to create a constructor requiring only a single argument.  If you
don't want to specify a class for <code>ontrue</code> (or <code>onfalse</code>) you may use the
empty string or <code>null</code>.
</p>

<pre class="results">
hd.cssClass( <i>model</i>, <i>ontrue</i>, <i>onfalse</i>, <i>toView</i> )
  ==
{mkview:  hd.CssClass.bind( null, <i>ontrue</i>, <i>onfalse</i> ),
 model:   <i>model</i>,
 toView:  <i>toView</i>
}
</pre>
</div>
</li>

<li><a id="sec-8-5-10"></a>cssClass( model )<br  /><div class="outline-text-4" id="text-8-5-10">
<p>
This overloaded form of <code>cssClass</code> takes a variable and generates multiple
binding specifications which bind several CSS classes to various variable
properties.  For more information on binding to variable properties, see the
section "<a href="#sec-9">Binding to variable properties</a>".
</p>

<pre class="results">
hd.cssClass( <i>variable</i> )
  ==
[cssClass( <i>variable</i>.source,        <span style="color: #a0522d;">'source'</span>,       <span style="color: #a0522d;">'derived'</span>         ),
 cssClass( <i>variable</i>.pending,       <span style="color: #a0522d;">'pending'</span>,      <span style="color: #a0522d;">'complete'</span>        ),
 cssClass( <i>variable</i>.constributing, <span style="color: #a0522d;">'contributing'</span>, <span style="color: #a0522d;">'noncontributing'</span> ),
 cssClass( <i>variable</i>.error,         <span style="color: #a0522d;">'error'</span>,         <span style="color: #8b1a1a;">null</span>             )
];
</pre>
</div>
</li>


<li><a id="sec-8-5-11"></a>text( model, toView? )<br  /><div class="outline-text-4" id="text-8-5-11">
<p>
Use the <code>Text</code> adapter with optional <code>toView</code> argument.
</p>

<pre class="results">
hd.text( <i>model</i>, <i>toView</i> )
  ==
{mkview:  hd.Edit,
 model:   <i>model</i>,
 toView:  <i>toView</i>
}
</pre>
</div>
</li>

<li><a id="sec-8-5-12"></a>editVar( model, toView?, toModel? )<br  /><div class="outline-text-4" id="text-8-5-12">
<p>
This single factory function is a shortcut for invoking three different
factories on a variable.
</p>

<pre class="results">
hd.editVar( <i>model</i>, <i>toView</i>, <i>toModel</i> )
 ==
[hd.edit( <i>model</i>, <i>toView</i>, <i>toModel</i> ),
 hd.cssClass( <i>model</i> ),
 hd.enabled( <i>model</i>.relevant )
]
</pre>
</div>
</li>

<li><a id="sec-8-5-13"></a>numVar( model, places?, toview?, toModel? )<br  /><div class="outline-text-4" id="text-8-5-13">
<p>
This single factory function is a shortcut for invoking three different
factories on a variable.
</p>

<pre class="results">
hd.numVar( <i>model</i>, <i>places</i>, <i>toView</i>, <i>toModel</i> )
 ==
[hd.num( <i>model</i>, <i>places</i>, <i>toView</i>, <i>toModel</i> ),
 hd.cssClass( <i>model</i> ),
 hd.enabled( <i>model</i>.relevant )
]
</pre>
</div>
</li>

<li><a id="sec-8-5-14"></a>dateVar( model, toView?, toModel? )<br  /><div class="outline-text-4" id="text-8-5-14">
<p>
This single factory function is a shortcut for invoking three different
factories on a variable.
</p>

<pre class="results">
hd.dateVar( <i>model</i>, <i>toView</i>, <i>toModel</i> )
 ==
[hd.edit( <i>model</i>, <i>toView</i>, <i>toModel</i> ),
 hd.cssClass( <i>model</i> ),
 hd.enabled( <i>model</i>.relevant )
]
</pre>
</div>
</li></ol>
</div>
</div>

<div id="outline-container-sec-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> Binding to variable properties</h2>
<div class="outline-text-2" id="text-9">
<p>
<i>View</i>
</p>

<div class="org-src-container">

<pre class="src src-html"><span class="linenr"> 1: </span>&lt;<span style="color: #006699;">style</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text/css"</span>&gt;
<span class="linenr"> 2: </span>  .source { background-color: #ffe; }
<span class="linenr"> 3: </span>  .derived { background-color: #eee; }
<span class="linenr"> 4: </span>  .error { border: 2px solid #f00; }
<span class="linenr"> 5: </span>&lt;/<span style="color: #006699;">style</span>&gt;
<span class="linenr"> 6: </span>&lt;<span style="color: #006699;">table</span> <span style="color: #BA36A5;">id</span>=<span style="color: #008000;">"ex4"</span> <span style="color: #BA36A5;">style</span>=<span style="color: #008000;">"text-align: right"</span>&gt;
<span class="linenr"> 7: </span>  &lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr"> 8: </span>    &lt;<span style="color: #006699;">td</span>&gt;Number:&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr"> 9: </span>    &lt;<span style="color: #006699;">td</span>&gt;&lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"hd.num( x ),</span>
<span class="linenr">10: </span><span style="color: #008000;">           hd.cssClass( x.error, 'error' )"</span>/&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">11: </span>    &lt;<span style="color: #006699;">td</span> <span style="color: #BA36A5;">style</span>=<span style="color: #008000;">"color: red"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"hd.text( x.error )"</span>&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">12: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;&lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">13: </span>    &lt;<span style="color: #006699;">td</span>&gt;<span style="color: #BA36A5;">&amp;nbsp;</span>&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">14: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;&lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">15: </span>    &lt;<span style="color: #006699;">td</span>&gt;Width:&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">16: </span>    &lt;<span style="color: #006699;">td</span>&gt;&lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"hd.num( width ),</span>
<span class="linenr">17: </span><span style="color: #008000;">           hd.cssClass( width.source, 'source', 'derived' )"</span>/&gt;&lt;<span style="color: #006699;">td</span>&gt;
<span class="linenr">18: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;&lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">19: </span>    &lt;<span style="color: #006699;">td</span>&gt;Height:&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">20: </span>    &lt;<span style="color: #006699;">td</span>&gt;&lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"hd.num( height ),</span>
<span class="linenr">21: </span><span style="color: #008000;">           hd.cssClass( height.source, 'source', 'derived' )"</span>/&gt;&lt;<span style="color: #006699;">td</span>&gt;
<span class="linenr">22: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;&lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">23: </span>    &lt;<span style="color: #006699;">td</span>&gt;Area:&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">24: </span>    &lt;<span style="color: #006699;">td</span>&gt;&lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"hd.num( area ),</span>
<span class="linenr">25: </span><span style="color: #008000;">           hd.cssClass( area.source, 'source', 'derived' )"</span>/&gt;&lt;<span style="color: #006699;">td</span>&gt;
<span class="linenr">26: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;
<span class="linenr">27: </span>&lt;/<span style="color: #006699;">table</span>&gt;
</pre>
</div>

<p>
<i>View-Model</i>
</p>

<div class="org-src-container">

<pre class="src src-js"><span class="linenr">1: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">model</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.ModelBuilder</span>()
<span class="linenr">2: </span>  .v( <span style="color: #008000;">'x'</span>, 10 ).v( <span style="color: #008000;">'width'</span>, 8 ).v( <span style="color: #008000;">'height'</span>, 6 ).v( <span style="color: #008000;">'area'</span> )
<span class="linenr">3: </span>  .eq( <span style="color: #008000;">'area == width * height'</span> )
<span class="linenr">4: </span>  .end();
<span class="linenr">5: </span>
<span class="linenr">6: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">system</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.ConstraintSystem</span>();
<span class="linenr">7: </span>system.addComponent( model );
</pre>
</div>

<p>
<i>Binding</i>
</p>

<div class="org-src-container">

<pre class="src src-js"><span class="linenr">1: </span>window.addEventListener( <span style="color: #008000;">'load'</span>, <span style="color: #0000FF;">function</span>() {
<span class="linenr">2: </span>  hd.performDeclaredBindings( model, document.getElementById( <span style="color: #008000;">'ex4'</span> ) );
<span class="linenr">3: </span>} )
</pre>
</div>

<p>
<i>Result</i>
</p>

<p>
##+HTML: &lt;div class="results"&gt;
###+INCLUDE: tangle/prop.html html
##+HTML: &lt;/div&gt;
##+HTML: &lt;script type="text/javascript"&gt;
##+INCLUDE: tangle/prop.js html
##+HTML: &lt;/script&gt;
</p>

<p>
<i>Notes</i>
</p>

<div class="notes">
<p>
Typing an invalid number into the first box gives it a red border and produces
an error message.  The variables <i>width</i>, <i>height</i>, and <i>area</i>, are related by
the constraint <code>area == width * height</code>.  Thus, data will always flow from two
of these variables into the third.  The two source variables will be yellow,
and the third &#x2014; which is derived from the other two &#x2014; will be gray.
</p>
</div>
</div>

<div id="outline-container-sec-9-1" class="outline-3">
<h3 id="sec-9-1"><span class="section-number-3">9.1</span> Variable properties</h3>
<div class="outline-text-3" id="text-9-1">
<p>
You can bind to more than just a variable in the view-model; any object
conforming to a certain interface can be bound to.  (We describe this
interface later in the <a href="program.html">Programming Guide</a>).  Each variable contains several
properties which conform to this interface, and thus can be bound to by the
view.
</p>

<p>
It is important to note that these properties are read-only.  Thus, they
should only be used with read-only adapters, such as <code>text</code> and <code>cssClass</code>, and
never with read-write adapters, such as <code>Edit</code>.
</p>
</div>
</div>

<div id="outline-container-sec-9-2" class="outline-3">
<h3 id="sec-9-2"><span class="section-number-3">9.2</span> List of variable properties</h3>
<div class="outline-text-3" id="text-9-2">
<p>
Although we list all properties here, some of them will not be fully explained
here.  They will be, however, in other documentation.
</p>
</div>

<ol class="org-ol"><li><a id="sec-9-2-1"></a>error<br  /><div class="outline-text-4" id="text-9-2-1">
<p>
This property contains any error that was generated the last time the variable
was set &#x2014; whether by the view or by a method.  In particular, note that any
exceptions thrown by translators will be stored in this property.
</p>

<p>
If no error was generated for the variable, the value of this property will be
<code>null</code>.  Note that, using normal JavaScript semantics, you may use this
property as a Boolean value: an object or non-empty string will naturally
evaluate to <code>true</code>, and <code>null</code> or the empty string will evaluate to <code>false</code>.
</p>
</div>
</li>

<li><a id="sec-9-2-2"></a>source<br  /><div class="outline-text-4" id="text-9-2-2">
<p>
This Boolean property is true if the variable was a <i>source</i> (kept its value)
during the last evaluation, and false if it was <i>derived</i> (received a new
value from a method).
</p>
</div>
</li>

<li><a id="sec-9-2-3"></a>pending<br  /><div class="outline-text-4" id="text-9-2-3">
<p>
This Boolean property is true if the variable is currently waiting for an
update from an asynchronous method, and false if it is not.  For more
information, see <a href="async.html">Asynchronous Methods</a>.
</p>
</div>
</li>

<li><a id="sec-9-2-4"></a>contributing<br  /><div class="outline-text-4" id="text-9-2-4">
<p>
This Boolean property is true if the value of the variable was used to compute
an output variable, and false if it was not.  For more information, see <a href="async.html">Asynchronous Methods</a>.
</p>
</div>
</li>

<li><a id="sec-9-2-5"></a>relevant<br  /><div class="outline-text-4" id="text-9-2-5">
<p>
This Boolean property is true if editing the variable may cause a change to an
output variable, and false if not.  For more information, see <a href="async.html">Asynchronous Methods</a>.
</p>
</div>
</li>

<li><a id="sec-9-2-6"></a>value<br  /><div class="outline-text-4" id="text-9-2-6">
<p>
This property contains the current value of the variable.  There should be no
reason to bind to this property, as it is the same as binding to the variable
itself, except that it is read-only.  It is listed only for completeness.
</p>
</div>
</li></ol>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2015-10-29 Thu 10:02</p>
<p class="validation"></p>
</div>
</body>
</html>
