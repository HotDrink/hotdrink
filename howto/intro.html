<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Introduction to HotDrink</title>
<!-- 2015-10-29 Thu 10:02 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript" src="../../../scripts/hotdrink.js"></script>
<script type="text/javascript" src="collapse.js"></script>
<link rel="stylesheet" type="text/css" href="style.css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript" src="http://orgmode.org/mathjax/MathJax.js"></script>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
        //  config: ["MMLorHTML.js"], jax: ["input/TeX"],
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Introduction to HotDrink</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Overview of basic concepts</a>
<ul>
<li><a href="#sec-1-1">1.1. Constraint systems</a></li>
<li><a href="#sec-1-2">1.2. Commands</a></li>
<li><a href="#sec-1-3">1.3. MVVM</a></li>
</ul>
</li>
<li><a href="#sec-2">2. Including HotDrink in your web page</a></li>
<li><a href="#sec-3">3. Important HotDrink objects</a></li>
<li><a href="#sec-4">4. An introductory example</a>
<ul>
<li><a href="#sec-4-1">4.1. The example</a></li>
<li><a href="#sec-4-2">4.2. The View</a></li>
<li><a href="#sec-4-3">4.3. The View-Model</a></li>
<li><a href="#sec-4-4">4.4. The Binding</a></li>
<li><a href="#sec-4-5">4.5. Commands</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Overview of basic concepts</h2>
<div class="outline-text-2" id="text-1">
<p>
HotDrink is a JavaScript library that assists with GUI implementation.
HotDrink allows you to program GUIs <i>declaratively</i>&#x2014;instead of writing event
handlers that control what should happen in a GUI and when, the programmer
specifies the relationships between various pieces of data, i.e., how changes
to one piece of data affect other pieces of data.  From this description,
HotDrink decides how and when to enforce relationships, and also implements
several GUI behaviors that can be reused with little effort.
</p>

<p>
Changes to GUI state are managed through <i>commands</i> written by the programmer.
HotDrink ensures that (1) commands are initiated only when all relationships
defined by the programmer have been enforced, and (2) commands will not
interfere with one another, at least with respect to the GUI state.  This
means that your program will behave correctly even if a new command is issued
before the previous command has finished.
</p>
</div>

<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> Constraint systems</h3>
<div class="outline-text-3" id="text-1-1">
<p>
The heart of the HotDrink library is a <i>constraint system</i>.  A
constraint system manages variables and <i>constraints</i> among the variables.  Each
constraint represents something that should be true concerning some of the
variables (i.e., a <i>relation</i> over those variables).
For example, given three variables, \(x\), \(y\), and \(z\), you
could create a constraint that \(x = y + z\), or that \(x \le y \le z\), or even that \(z\)
is the result of a database query using \(x\) and \(y\).  When the
constraint is true, we say it is <i>satisfied</i>.  HotDrink <i>enforces</i> a
constraint by modifying some of its variables so that the constraint is
satisfied.
</p>

<p>
In HotDrink's constraint system, constraints between variables are expressed
as sets of functions.  These functions are called <i>methods</i> (short for
<i>constraint satisfaction methods</i>) and are written by the programmer.  Each
method is responsible for calculating new values for some of the constraint's
variables so that the constraint will be satisfied.  To enforce all
constraints, HotDrink executes one method from each constraint.  Together, the
methods executed define a <i>dataflow</i>&#x2014;a branching path showing which
variables are used to update which other variables.  HotDrink has a
<i>multi-way dataflow constraint system</i>, meaning there are many possible
dataflows depending on which methods are executed.  In general, HotDrink
selects a dataflow that preserves variables the user has edited more recently.
</p>

<p>
In a HotDrink &ldquo;powered&rdquo; user interface, GUI events are translated to changes
to constraint system variables.  These changes result
in constraints which are no longer satisfied.  HotDrink
responds by <i>solving</i> the constraint system&#x2014;that is, selecting which methods
to execute, and then executing them so that all constraints are again
satisfied.  Solving can change the values of the system's variables; the
changed values are then somehow
displayed or visualized to the user, as specified by the programmer.
</p>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> Commands</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Whereas the constraint system runs in the background to automatically enforce
constraints, a <i>command</i> is code that is run only when triggered by an event.
A command may be as simple as assigning a new value to a variable, or as
complex as making a server call using the value of some variables and updating
the GUI with the result.  After executing a command, HotDrink always solves
the constraint system to ensure that all relations between variables are
enforced.
</p>

<p>
HotDrink views the life of a GUI, not as a series of events, but as a sequence
of commands.  HotDrink manages these commands and coordinates their execution.
Commands may execute <i>asynchronously</i>, meaning that a command does not have to
wait for all previous commands to finish before it can begin.  HotDrink
manages the effects of all commands on GUI state so that the end result will
be the same as if those commands had executed synchronously.
</p>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> MVVM</h3>
<div class="outline-text-3" id="text-1-3">
<p>
Applications written with HotDrink follow the Model-View-ViewModel
(a.k.a. MVVM) design pattern.  This pattern divides the application as
follows:
</p>

<ul class="org-ul">
<li>The <i>View</i> is responsible for presentation and capturing
interactions with the user.  It arranges everything on the screen
and provides events that indicate user actions.  For our purposes,
the view is specified in HTML, along with JavaScript that
generates and modifies the HTML.  This tutorial shows bits and snippets of HTML, with
some commentary to help understand the examples, but in general we assume familiarity
with HTML, JavaScript, and constructing web pages.
</li>

<li>The <i>View-Model</i> is responsible for managing the data presented in
the view. This means supplying the data to be displayed by the view,
as well as responding to user actions.  The purpose of
HotDrink is to help in implementing the view-model.
</li>

<li>Another important part of an MVVM application are the <i>bindings</i>.  A
binding connects elements in the view with variables in the
view-model.  The bindings are sometimes treated as part of the
view&#x2014;that is why there is no &ldquo;B&rdquo; in &ldquo;MVVM&rdquo;&#x2014;but we treat them as
a distinct component of the pattern.  In HotDrink, bindings can be
specified in JavaScript, or as annotations in HTML as part of the
view specification.
</li>

<li>The <i>Model</i> is responsible for everything else&#x2014;whatever the
application is actually supposed to <i>do</i>.  The model does not need to
be aware of the user interface; therefore we will not discuss it further in
this documentation.
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Including HotDrink in your web page</h2>
<div class="outline-text-2" id="text-2">
<p>
To use HotDrink, your web page should include the file <a href="hotdrink.min.js"><code>hotdrink.min.js</code></a> that
came with this tutorial.  (Alternatively, if you downloaded the source tree,
follow the build instructions to compile your own <code>hotdrink.min.js</code>.)
More specifically, add the following <code>&lt;script&gt;</code> tag to the <code>&lt;head&gt;</code> section of
your HTML, with the appropriate path in the <code>src</code> attribute.  In order for the
examples in this tutorial to work, the file <code>hotdrink.min.js</code> must be located
in the same directory as this HTML file.
</p>

<div class="org-src-container">

<pre class="src src-html">&lt;<span style="color: #006699;">script</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text/javascript"</span> <span style="color: #BA36A5;">src</span>=<span style="color: #008000;">"hotdrink.min.js"</span>&gt;&lt;/<span style="color: #006699;">script</span>&gt;
</pre>
</div>

<p>
HotDrink does not rely on any other JavaScript frameworks, but neither should it
conflict with other frameworks (JQuery, Dojo, MooTools, etc.).
The only global symbol it exports is <code>hd</code>, and all of its interactions
with the DOM are via cooperative API functions, e.g.,
<a href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget.addEventListener"><code>addEventListener</code></a>, etc.
</p>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Important HotDrink objects</h2>
<div class="outline-text-2" id="text-3">
<p>
There are three important object types you will need to interact with when
using HotDrink.
</p>
</div>

<ol class="org-ol"><li><a id="sec-3-0-1"></a>The <code>PropertyModel</code> type<br  /><div class="outline-text-4" id="text-3-0-1">
<p>
A <i>property model</i> is the View-Model of a HotDrink &ldquo;powered&rdquo; application.
application.  It contains variables for holding the data used by your GUI, and
a constraint system for enforcing any constraints you define for those
variables (as described in Section <a href="#sec-1-1">1.1</a>.)  In general, your
application will always have a single property model, customized to contain
the variables and constraints needed for your GUI.  Variables and constraints
are created separately, then added to the property model.
</p>
</div>
</li>

<li><a id="sec-3-0-2"></a>The <code>Component</code> type<br  /><div class="outline-text-4" id="text-3-0-2">
<p>
A property model may be viewed as a type of container: it contains and manages
a set of elements.  The three types of property model elements we have
discussed so far are variables, constraints, and commands.  While it is
possible to create these elements individually and add them directly to a
property model, the recommended approach is to define a property model
<i>component</i>.  A component is also a collection of property model elements;
however, a component does not manage its elements, it merely holds them.
</p>

<p>
You, the programmer, are responsible for making sure all the property model
elements you are using are added to the property model.  By placing related
elements together in a component, it is easy to add them all to the property
model at the same time&#x2014;and to remove them later if they are no longer
needed.  You can also define your own component types so that you can reuse
them.
</p>
</div>
</li>

<li><a id="sec-3-0-3"></a>The <code>ComponentBuilder</code> type<br  /><div class="outline-text-4" id="text-3-0-3">
<p>
The task of building a component is somewhat complex.  To help, HotDrink
provides an object called the <i>component builder</i>.  This factory object
essentially defines its own language (i.e., an <i>embedded domain-specific
language</i>) for constructing components.  To use this language, create a new
component builder instance, then call its member functions to add elements to
the component.
</p>
</div>
</li></ol>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> An introductory example</h2>
<div class="outline-text-2" id="text-4">
<p>
We present here a simple example of using HotDrink.  Note that we will not
explain all the details of this example, only the most important points.  The
goal of this example is to define some basic concepts that you will need to
understand the other HotDrink tutorials; the other tutorials will provide a
more in-depth explanation of how HotDrink works.
</p>
</div>

<div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> The example</h3>
<div class="outline-text-3" id="text-4-1">
<p>
Below is an form from a hypothetical hotel reservation web page.  The user may
edit the check-in date, the check-out date, the number of nights to stay, and
the number of beds desired.  Notice that, as one text box is edited, other
elements of the web page are updated to be consistent with the changes.
</p>

<div class="results">
<table>
  <style type="text/css" scoped>
    th { padding-right: 1ex; text-align: left; font-weight: bold; }
  </style>
  <tr>
    <th>Check-In:</th>
    <td><input type="text" data-bind="bd.date( checkin )"/></td>
  </tr>
  <tr>
    <th>Check-Out:</th>
    <td><input type="text" data-bind="bd.date( checkout )"/></td>
  </tr>
  <tr>
    <th>Nights:</th>
    <td><input type="text" data-bind="bd.num( nights, 0 )"/></td>
  </tr>
  <tr>
    <th>Room Type:</th>
    <td>
      <select data-bind="bd.value( type )">
        <option value="1D">1 Double Bed</option>
        <option value="1Q">1 Queen Bed</option>
        <option value="1K">1 King Bed</option>
        <option value="2Q">2 Queen Beds</option>
      </select>
    </td>
  </tr>
  <tr>
    <th>Price:</th>
    <td>$<span data-bind="bd.text( price, bd.fix( 2 ) )"></span></td>
  </tr>
  <tr>
    <td colspan="2" align="right">
      <input type="button" value="Submit" data-bind="bd.click( reportPrice )"/>
    </td>
  </tr>
</table>
</div>
<script type="text/javascript">
(function() {
// Some constants to help us
var oneDayMs = 24*60*60*1000;
var today = new Date();
today.setHours( 0, 0, 0, 0 );

// Define variables and constraints in a component
var model = new hd.ComponentBuilder()

    // Variables
    .variable( "checkin", today)
    .variable( "checkout" )
    .variable( "nights", 2 )
    .variable( "type", "1Q" )
    .variable( "price" )

    // First constraint
    .constraint( 'checkin, checkout, nights' )
    .method( 'checkin, checkout -> nights', function( checkin, checkout ) {
      return (checkout.getTime() - checkin.getTime()) / oneDayMs;
    } )
    .method( 'nights, checkin -> checkout', function( nights, checkin ) {
      return new Date( checkin.getTime() + nights*oneDayMs );
    } )
    .method( 'nights, checkout -> checkin', function( nights, checkout ) {
      return new Date( checkout.getTime() - nights*oneDayMs );
    } )

    // Second constraint
    .constraint( 'nights, type, price' )
    .method( 'nights, type -> price', function( nights, type ) {
      var rate;
      switch(type) {
      case '1D':  rate = 80;  break;
      case '1Q':  rate = 95;  break;
      case '1K':  rate = 115; break;
      case '2!':  rate = 140; break;
      default:   throw "Invalid room type";
      }
      return nights * rate
    } )

    // Create a custom command named 'reportPrice'
    .command( 'reportPrice', 'price ->', function( price ) {
      alert( "The price of your room is $" + price.toFixed( 2 ) );
    } )

    .component();

// Define the property model
var pm = new hd.PropertyModel();
pm.addComponent( model );
window.addEventListener( 'load', function() {
  hd.createDeclaredBindings( model, document.body );
} );
})();
</script>

<p>
<b>Source Code</b>
</p>

<p>
The source code for this form is shown in its entirety below.  (Click the
"show" links to view the code.)  To clarify, we have broken the code into
three sections:  the HTML that defines the View, the JavaScript that defines
the View-Model, and the JavaScript that performs binding.  In the remainder of
this section we will reproduce and examine snippets of this code.
</p>

<div class="org-src-container">
<label class="org-src-name"><i>View</i> (show/hide)</label>
<pre class="src src-html"><span class="linenr"> 1: </span>&lt;<span style="color: #006699;">table</span>&gt;
<span class="linenr"> 2: </span>  &lt;<span style="color: #006699;">style</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text/css"</span> scoped&gt;
<span class="linenr"> 3: </span>    th { padding-right: 1ex; text-align: left; font-weight: bold; }
<span class="linenr"> 4: </span>  &lt;/<span style="color: #006699;">style</span>&gt;
<span class="linenr"> 5: </span>  &lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr"> 6: </span>    &lt;<span style="color: #006699;">th</span>&gt;Check-In:&lt;/<span style="color: #006699;">th</span>&gt;
<span class="linenr"> 7: </span>    &lt;<span style="color: #006699;">td</span>&gt;&lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.date( checkin )"</span>/&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr"> 8: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;
<span class="linenr"> 9: </span>  &lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">10: </span>    &lt;<span style="color: #006699;">th</span>&gt;Check-Out:&lt;/<span style="color: #006699;">th</span>&gt;
<span class="linenr">11: </span>    &lt;<span style="color: #006699;">td</span>&gt;&lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.date( checkout )"</span>/&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">12: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;
<span class="linenr">13: </span>  &lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">14: </span>    &lt;<span style="color: #006699;">th</span>&gt;Nights:&lt;/<span style="color: #006699;">th</span>&gt;
<span class="linenr">15: </span>    &lt;<span style="color: #006699;">td</span>&gt;&lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.num( nights, 0 )"</span>/&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">16: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;
<span class="linenr">17: </span>  &lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">18: </span>    &lt;<span style="color: #006699;">th</span>&gt;Room Type:&lt;/<span style="color: #006699;">th</span>&gt;
<span class="linenr">19: </span>    &lt;<span style="color: #006699;">td</span>&gt;
<span class="linenr">20: </span>      &lt;<span style="color: #006699;">select</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.value( type )"</span>&gt;
<span class="linenr">21: </span>        &lt;<span style="color: #006699;">option</span> <span style="color: #BA36A5;">value</span>=<span style="color: #008000;">"1D"</span>&gt;1 Double Bed&lt;/<span style="color: #006699;">option</span>&gt;
<span class="linenr">22: </span>        &lt;<span style="color: #006699;">option</span> <span style="color: #BA36A5;">value</span>=<span style="color: #008000;">"1Q"</span>&gt;1 Queen Bed&lt;/<span style="color: #006699;">option</span>&gt;
<span class="linenr">23: </span>        &lt;<span style="color: #006699;">option</span> <span style="color: #BA36A5;">value</span>=<span style="color: #008000;">"1K"</span>&gt;1 King Bed&lt;/<span style="color: #006699;">option</span>&gt;
<span class="linenr">24: </span>        &lt;<span style="color: #006699;">option</span> <span style="color: #BA36A5;">value</span>=<span style="color: #008000;">"2Q"</span>&gt;2 Queen Beds&lt;/<span style="color: #006699;">option</span>&gt;
<span class="linenr">25: </span>      &lt;/<span style="color: #006699;">select</span>&gt;
<span class="linenr">26: </span>    &lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">27: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;
<span class="linenr">28: </span>  &lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">29: </span>    &lt;<span style="color: #006699;">th</span>&gt;Price:&lt;/<span style="color: #006699;">th</span>&gt;
<span class="linenr">30: </span>    &lt;<span style="color: #006699;">td</span>&gt;$&lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.text( price, bd.fix( 2 ) )"</span>&gt;&lt;/<span style="color: #006699;">span</span>&gt;&lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">31: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;
<span class="linenr">32: </span>  &lt;<span style="color: #006699;">tr</span>&gt;
<span class="linenr">33: </span>    &lt;<span style="color: #006699;">td</span> <span style="color: #BA36A5;">colspan</span>=<span style="color: #008000;">"2"</span> <span style="color: #BA36A5;">align</span>=<span style="color: #008000;">"right"</span>&gt;
<span class="linenr">34: </span>      &lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"button"</span> <span style="color: #BA36A5;">value</span>=<span style="color: #008000;">"Submit"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.click( reportPrice )"</span>/&gt;
<span class="linenr">35: </span>    &lt;/<span style="color: #006699;">td</span>&gt;
<span class="linenr">36: </span>  &lt;/<span style="color: #006699;">tr</span>&gt;
<span class="linenr">37: </span>&lt;/<span style="color: #006699;">table</span>&gt;
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><i>View-Model</i> (show/hide)</label>
<pre class="src src-js"><span class="linenr"> 1: </span><span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Some constants to help us</span>
<span class="linenr"> 2: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">oneDayMs</span> = 24*60*60*1000;
<span class="linenr"> 3: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">today</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">Date</span>();
<span class="linenr"> 4: </span>today.setHours( 0, 0, 0, 0 );
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span><span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Define variables and constraints in a component</span>
<span class="linenr"> 7: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">model</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.ComponentBuilder</span>()
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span>    <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Variables</span>
<span class="linenr">10: </span>    .variable( <span style="color: #008000;">"checkin"</span>, today)
<span class="linenr">11: </span>    .variable( <span style="color: #008000;">"checkout"</span> )
<span class="linenr">12: </span>    .variable( <span style="color: #008000;">"nights"</span>, 2 )
<span class="linenr">13: </span>    .variable( <span style="color: #008000;">"type"</span>, <span style="color: #008000;">"1Q"</span> )
<span class="linenr">14: </span>    .variable( <span style="color: #008000;">"price"</span> )
<span class="linenr">15: </span>
<span class="linenr">16: </span>    <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">First constraint</span>
<span class="linenr">17: </span>    .constraint( <span style="color: #008000;">'checkin, checkout, nights'</span> )
<span class="linenr">18: </span>    .method( <span style="color: #008000;">'checkin, checkout -&gt; nights'</span>, <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">checkin</span>, <span style="color: #BA36A5;">checkout</span> ) {
<span class="linenr">19: </span>      <span style="color: #0000FF;">return</span> (checkout.getTime() - checkin.getTime()) / oneDayMs;
<span class="linenr">20: </span>    } )
<span class="linenr">21: </span>    .method( <span style="color: #008000;">'nights, checkin -&gt; checkout'</span>, <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">nights</span>, <span style="color: #BA36A5;">checkin</span> ) {
<span class="linenr">22: </span>      <span style="color: #0000FF;">return</span> <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">Date</span>( checkin.getTime() + nights*oneDayMs );
<span class="linenr">23: </span>    } )
<span class="linenr">24: </span>    .method( <span style="color: #008000;">'nights, checkout -&gt; checkin'</span>, <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">nights</span>, <span style="color: #BA36A5;">checkout</span> ) {
<span class="linenr">25: </span>      <span style="color: #0000FF;">return</span> <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">Date</span>( checkout.getTime() - nights*oneDayMs );
<span class="linenr">26: </span>    } )
<span class="linenr">27: </span>
<span class="linenr">28: </span>    <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Second constraint</span>
<span class="linenr">29: </span>    .constraint( <span style="color: #008000;">'nights, type, price'</span> )
<span class="linenr">30: </span>    .method( <span style="color: #008000;">'nights, type -&gt; price'</span>, <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">nights</span>, <span style="color: #BA36A5;">type</span> ) {
<span class="linenr">31: </span>      <span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">rate</span>;
<span class="linenr">32: </span>      <span style="color: #0000FF;">switch</span>(type) {
<span class="linenr">33: </span>      <span style="color: #0000FF;">case</span> <span style="color: #008000;">'1D'</span>:  rate = 80;  <span style="color: #0000FF;">break</span>;
<span class="linenr">34: </span>      <span style="color: #0000FF;">case</span> <span style="color: #008000;">'1Q'</span>:  rate = 95;  <span style="color: #0000FF;">break</span>;
<span class="linenr">35: </span>      <span style="color: #0000FF;">case</span> <span style="color: #008000;">'1K'</span>:  rate = 115; <span style="color: #0000FF;">break</span>;
<span class="linenr">36: </span>      <span style="color: #0000FF;">case</span> <span style="color: #008000;">'2!'</span>:  rate = 140; <span style="color: #0000FF;">break</span>;
<span class="linenr">37: </span>      <span style="color: #0000FF;">default</span>:   <span style="color: #0000FF;">throw</span> <span style="color: #008000;">"Invalid room type"</span>;
<span class="linenr">38: </span>      }
<span class="linenr">39: </span>      <span style="color: #0000FF;">return</span> nights * rate
<span class="linenr">40: </span>    } )
<span class="linenr">41: </span>
<span class="linenr">42: </span>    <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Create a custom command named 'reportPrice'</span>
<span class="linenr">43: </span>    .command( <span style="color: #008000;">'reportPrice'</span>, <span style="color: #008000;">'price -&gt;'</span>, <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">price</span> ) {
<span class="linenr">44: </span>      alert( <span style="color: #008000;">"The price of your room is $"</span> + price.toFixed( 2 ) );
<span class="linenr">45: </span>    } )
<span class="linenr">46: </span>
<span class="linenr">47: </span>    .component();
<span class="linenr">48: </span>
<span class="linenr">49: </span><span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Define the property model</span>
<span class="linenr">50: </span><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">pm</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.PropertyModel</span>();
<span class="linenr">51: </span>pm.addComponent( model );
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><i>Binding</i> (show/hide)</label>
<pre class="src src-js"><span class="linenr">1: </span>window.addEventListener( <span style="color: #008000;">'load'</span>, <span style="color: #0000FF;">function</span>() {
<span class="linenr">2: </span>  hd.createDeclaredBindings( model, document.body );
<span class="linenr">3: </span>} );
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> The View</h3>
<div class="outline-text-3" id="text-4-2">
<p>
As mentioned above, the View is defined by the HTML used to construct the web
page (and any JavaScript used to dynamically generate web page content).  In
this example, our View is an HTML table containing input elements and their
labels.  Each input element is bound to a variable in the view-model; the
value of that variable is displayed by the element, and any changes made to
the element are propagated to the value of the variable.
</p>

<p>
In this example we use HotDrink's declarative bindings, in which each tag is
annotated with JavaScript code indicating how it is to be bound.  We call this
annotation a <i>binding specification</i>.  Binding specifications are found in the
<code>data-bind</code> attribute of an HTML tag.  For example, the following text input
tag contains a binding specification indicating that it is to be bound to the
<code>checkin</code> variable of the view-model, and that it is to be converted to a
JavaScript <code>Date</code> object in the view-model.  Thus, after each edit of the text
input, the string will be converted to a <code>Date</code> object, and&#x2014;if
successfully converted&#x2014;will be stored in the <code>checkin</code> variable.
</p>

<div class="org-src-container">

<pre class="src src-html" id="checkin">&lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.date( checkin )"</span>/&gt;
</pre>
</div>

<p>
Similarly, this text input tag contains a binding specification indicating
that it is to be bound to the <code>nights</code> variable of the view-model, and that it
is to be converted to a number in the view-model.  The second parameter to the
<code>bd.num</code> function indicates that the number is to have zero digits after the
decimal point&#x2014;i.e., it is to be an integer.
</p>

<div class="org-src-container">

<pre class="src src-html" id="nights">&lt;<span style="color: #006699;">input</span> <span style="color: #BA36A5;">type</span>=<span style="color: #008000;">"text"</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.num( nights, 0 )"</span>/&gt;
</pre>
</div>

<p>
The <code>&lt;select&gt;</code> tag for the drop-down list element indicates that it is to use
the <code>type</code> variable as the selected value.
</p>

<div class="org-src-container">

<pre class="src src-html" id="rate">&lt;<span style="color: #006699;">select</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.value( type )"</span>&gt;
</pre>
</div>

<p>
The view contains one other element bound to a variable.  The following
<code>&lt;span&gt;</code> tag contains a binding specification indicating the <code>price</code> variable
is to be the contents of the tag, and that it is to be interpreted simply as
text&#x2014;i.e., no HTML tags, etc.  The call to <code>bd.fix( 2 )</code> indicates that the
variable is to be converted from a number to a string containing two digits
after the decimal point.
</p>

<div class="org-src-container">

<pre class="src src-html" id="price">&lt;<span style="color: #006699;">span</span> <span style="color: #BA36A5;">data-bind</span>=<span style="color: #008000;">"bd.text( price, bd.fix( 2 ) )"</span>&gt;&lt;/<span style="color: #006699;">span</span>&gt;
</pre>
</div>

<p>
These binding specifications have no effect until you tell HotDrink to
automatically perform all bindings according to their specifications.  We do
that in the Binding section.
</p>

<p>
As a side-node, you may find this view to be very plain.  Let us emphasize
that the purpose of HotDrink is <i>not</i> to create a fancy View; it is to create
a fancy View-Model.  HotDrink focuses on the data underlying your web page,
enforcing constraints and orchestrating commands.  There are many existing
JavaScript toolkits which, for example, will help you create calendar widgets
to help the user select a date.  HotDrink aims to cooperate with those
toolkits, not replace them.
</p>
</div>
</div>

<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> The View-Model</h3>
<div class="outline-text-3" id="text-4-3">
<p>
As mentioned above, a property model represents the view-model of our
application.  Your job as the programmer, then, is to construct a property
model that correctly models your GUI.
</p>

<p>
The first thing we must do is create the variables and constraints that will
define our property model.  We create these as members of a component using a
component builder.  The general strategy for constructing a component is: (1.)
create a new builder object, (2.) use the builder member functions to create
variables, constraints, etc., and (3.) call the <code>component</code> builder member
function to retrieve the completed component.  The mock code below illustrates
how this might be done.
</p>

<div class="org-src-container">

<pre class="src src-js"><span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Create new builder object</span>
<span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">builder</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.ComponentBuilder</span>();

<span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Use methods to construct the model</span>
builder.variable( ... );
builder.constraint( ... );
builder.method( ... );
<span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">...and so on...</span>

<span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Retrieve the completed model</span>
<span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">component</span> = builder.component();
</pre>
</div>

<p>
However, most builder member functions return the same builder object with
which they were invoked.  This allows a succinct programming style known as
&ldquo;chaining&rdquo; in which the return value of one member function is used to
immediately invoke the next member function.  You can see this style in the
mock code below.
</p>

<div class="org-src-container">

<pre class="src src-js"><span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Create, use, and discard builder object</span>
<span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">component</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.ComponentBuilder</span>()
    .variable( ... )
    .constraint( ... )
    .method( ... )
    .component();
</pre>
</div>

<p>
First we create a new <code>ComponentBuilder</code> object.  Rather than storing this
builder in a variable, we simply begin invoking member functions on it.  Each
member function invoked returns the same anonymous builder.  This return value
is used to invoke the next member function, and so on.  This continues until
the end, where the <code>component</code> member function is invoked on the still-anonymous
builder to return the component that was constructed.  It is this component that
is assigned to the <code>component</code> variable.  This is the style we use in our
view-model code.
</p>

<p>
In general, you may have as many components as you like.  However, for small
interfaces, like the one in this example, we can represent the entire GUI with
a single component.  You can name this component whatever you would like, but
our convention is to name it <code>model</code>, as it represents the entirety of the
property model.  Once you have a component, you can add it to a property
model, like so:
</p>

<div class="org-src-container">

<pre class="src src-js" id="propmod"><span style="color: #0000FF;">var</span> <span style="color: #BA36A5;">pm</span> = <span style="color: #0000FF;">new</span> <span style="color: #6434A3;">hd.PropertyModel</span>();
pm.addComponent( model );
</pre>
</div>

<p>
When you add a component to a property model, it automatically adds to the
property model all the elements contained by the component.  Later, you may
remove those elements from the property model, like so:
</p>

<div class="org-src-container">

<pre class="src src-js">pm.removeComponent( model );
</pre>
</div>

<p>
As those function names suggest, the full property model for your application
can actually consist of several different components, and new components can be
added or removed at run-time.  For now we assume a single component defines the
entire property model.
</p>
</div>
</div>

<div id="outline-container-sec-4-4" class="outline-3">
<h3 id="sec-4-4"><span class="section-number-3">4.4</span> The Binding</h3>
<div class="outline-text-3" id="text-4-4">
<p>
As mentioned above, the <i>bindings</i> are the connections between variables of
the view-model and elements of the View.  We can generate bindings
programmatically with JavaScript code.  However, in the example we have
annotated elements of the View with binding specification, indicating how they
are to be bound.  We can perform all of these bindings in one fell swoop with
the following line of code.
</p>

<div class="org-src-container">

<pre class="src src-js" id="binding">  hd.createDeclaredBindings( model, document.body );
</pre>
</div>

<p>
The <code>createDeclaredBindings</code> function causes HotDrink to search a part of the
Document Object Model (DOM) for HTML elements which have a binding
specification.  It then performs those bindings according to their
specification.  The first parameter is a component used to look up any variable
names encountered in the binding specifications.  The second parameter is a
DOM node indicating which part of the DOM should be searched for binding
specifications.  HotDrink will only search the specified node and any of its
children when looking for binding specifications.  In this case, however,
we've passed <code>document.body</code>, indicating the entire body of the DOM is to be
searched.
</p>

<p>
There is a catch to performing binding&#x2014;one web developers should be very
familiar with.  Elements of the DOM are not available until the entire HTML
document has been parsed; thus, attempting to call <code>performDeclaredBindings</code>
in the header of the document will fail because the DOM is not yet ready.
In this example, we handle this by registering a callback function to be
executed when the entire document has finished loading; it is here that we
call <code>performDeclaredBindings</code>.  Many JavaScript toolkits and frameworks
provide alternative means of running code after the DOM is ready; any such
means would be suitable for this purpose.
</p>
</div>
</div>

<div id="outline-container-sec-4-5" class="outline-3">
<h3 id="sec-4-5"><span class="section-number-3">4.5</span> Commands</h3>
<div class="outline-text-3" id="text-4-5">
<p>
In many ways, a command is similar to an event handler.  However, whereas an
event handler represents something that happened in the View, a command
represents something that happened in the View-Model.  For example, a
key-press event is generated when the user presses a key.  That event is
translated by a binding into a variable-set command.
</p>

<p>
Most commands in this example are, in fact, variable-set commands issued by
bindings.  These commands are created automatically; no extra work is
required.  If you want to create your own custom commands, however, you may do
so using the component builder.
</p>

<div class="org-src-container">

<pre class="src src-js">    <span style="color: #8D8D84;">// </span><span style="color: #8D8D84; font-style: italic;">Create a custom command named 'reportPrice'</span>
    .command( <span style="color: #008000;">'reportPrice'</span>, <span style="color: #008000;">'price -&gt;'</span>, <span style="color: #0000FF;">function</span>( <span style="color: #BA36A5;">price</span> ) {
      alert( <span style="color: #008000;">"The price of your room is $"</span> + price.toFixed( 2 ) );
    } )
</pre>
</div>

<p>
This command can be bound to events, like button presses.  Commands can also
be used to modify variables of the property model, or event modify the
property model itself, adding or removing variables, constraints, etc.
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2015-10-29 Thu 10:02</p>
<p class="validation"></p>
</div>
</body>
</html>
