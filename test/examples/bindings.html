<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
  <script type="text/javascript" src="https://raw.github.com/kriskowal/es5-shim/master/es5-shim.min.js"></script>
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  <script type="text/javascript" src="../js/hotdrink.js"></script>
  <title>Default Binders | HotDrink Test Suite</title>
  <script type="text/javascript">
    function validColor(color) {
      if (color.match(/^\#[a-zA-Z0-9]{6}$/))
        return {};
      else
        return {error : 'Color must be in #xxxxxx format'};
    }

    function convertDate(datestr) {
      var milliseconds = Date.parse(datestr);
      if (isNaN(milliseconds))
        return {error : 'Invalid date format'};
      else
        return {value : new Date(milliseconds)};
    }

    function convertDateBack(date) {
      return {value : date.toLocaleDateString()};
    }

    var today = new Date();
    function validBirthday(date) {
      if (date.getTime() < today.getTime())
        return {};
      else
        return {error : 'Must already be born!'}
    }

    var Model = function () {
      this.cbox = hd.variable(false);

      this.many = hd.variable([]);
      this.one = hd.variable();

      this.num = hd.variable(3.14);

      this.numBind = hd.binding(this.num);

      this.color = hd.variable("#009900");

      this.colorBind = hd.binding({value: this.color,
                                   debounce: 1000,
                                   validate: validColor});

      this.style = hd.computed(function () {
        return "color: " + this.color();
      });

      this.name = hd.variable("World");
      this.hello = hd.computed(function () {
        return "Hello, " + this.name() + "!";
      });

      this.bday = hd.variable(new Date());
      this.bdayBind = hd.binding({value: this.bday,
                                  convert: convertDate,
                                  validate: validBirthday,
                                  convertBack: convertDateBack,
                                  debounce: 1000});


      this.ok = hd.command(function () {
        /* Access the other guys just so they'll be relevant. */
        ["cbox", "many", "one", "num", "style"].forEach(function (v) {
          this[v]();
        }, this);
        /* The real action. */
        return hd.fn(alert)(this.hello());
      });
    };

    var model = hd.model(new Model());

    $(document).ready(function () {
      hotdrink.bind(model);
    });
  </script>
  <style type="text/css">
    .error { font-size: 80%; color: red }
  </style>
</head>
<body>
  <p>
  <input type="checkbox" name="cbox" id="cbox" data-bind="checkbox: cbox" />
  <label for="cbox">I am checked.</label>
  (<span data-bind="label: cbox"></span>)
  </p>

  <p>
  <input type="checkbox" name="many" value="a" id="a" data-bind="checkboxGroup: many" />
  <label for="a">a</label>
  <input type="checkbox" name="many" value="b" id="b" />
  <label for="b">b</label>
  <input type="checkbox" name="many" value="c" id="c" />
  <label for="c">c</label>
  =
  <select id="smany" multiple="true" size="2" data-bind="selectMany: many">
    <option value="a">a</option>
    <option value="b">b</option>
    <option value="c">c</option>
  </select>
  =
  <span data-bind="label: many"></span>
  </p>

  <p>
  <input type="radio" name="one" value="x" id="x" data-bind="radioGroup: one" />
  <label for="x">x</label>
  <input type="radio" name="one" value="y" id="y" />
  <label for="y">y</label>
  <input type="radio" name="one" value="z" id="z" />
  <label for="z">z</label>
  =
  <select id="sone" size="2" data-bind="selectOne: one">
    <option value="x">x</option>
    <option value="y">y</option>
    <option value="z">z</option>
  </select>
  =
  <select id="dropdown" data-bind="selectOne: one">
    <option value="">Choose one...</option>
    <option value="x">x</option>
    <option value="y">y</option>
    <option value="z">z</option>
  </select>
  =
  <span id="onelbl" data-bind="label: one"></span>
  </p>

  <p>
  <input type="text" id="num" data-bind="number: numBind" />
  =
  <span id="numlbl" data-bind="label: num"></span><br />
  <span class="error" id="numerr" data-bind="error: {value: numBind}">&nbsp;</span>
  </p>

  <p>
  <label for="name">Who are you?</label>
  <input type="text" id="name" data-bind="text: name" /><br />
  <input type="text" id="color" data-bind="text: colorBind" />
  <span class="error" data-bind="error: {value: colorBind}"></span><br />
  <span id="hellolbl" data-bind="label: hello, attr: { value: {style: style} }"></span></br />
  <button id="ok" data-bind="command: ok">Ok</button>
  </p>

  <p>
    <label for="bday">When is your birthday?</label>
    <input type="text" id="bday" data-bind="text: bdayBind" size="40" /><br />
    <span class="error" data-bind="error: {value: bdayBind}">&nbsp;</span>
  </p>
</body>
</html>

